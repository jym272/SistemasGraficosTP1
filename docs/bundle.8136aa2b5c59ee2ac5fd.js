(()=>{"use strict";var e,t={},a={};function n(e){if(a[e])return a[e].exports;var i=a[e]={exports:{}};return t[e](i,i.exports,n),i.exports}n.m=t,n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,a)=>(n.f[a](e,t),t)),[])),n.u=e=>"bundle."+{67:"1979a912f9adac1f746e",103:"fa1c7c2bbe62117c91a4",122:"f90ebbb8db99e78e43d5",130:"25a8cf71eedae8af0461",172:"d7b34d9120dfd71ef353",548:"045c4c7c9915561fcd9c",624:"8118eb9f3bd6af38e1b5",634:"e16b643f50fc11ddb017",660:"12b9664f903b88055a1d",670:"a1726fd8c0518d9a6548",724:"495efae8e854425a6bb8",804:"8b7f2adbd2385698daeb",840:"2b41591943c53adcb38d",895:"0dd0d7c06f1c71e87baf",907:"c6c2ace839456163970e",943:"c93b7bc5d8d187a35088",954:"d5490e7397c7a84e322d",985:"57f6131137626ac6391c"}[e]+".js",n.miniCssF=e=>(179===e?"main":e)+".css",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},n.l=(t,a,i,o)=>{if(e[t])e[t].push(a);else{var r,s;if(void 0!==i)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var c=l[u];if(c.getAttribute("src")==t){r=c;break}}r||(s=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,n.nc&&r.setAttribute("nonce",n.nc),r.src=t),e[t]=[a];var d=(a,n)=>{r.onerror=r.onload=null,clearTimeout(h);var i=e[t];if(delete e[t],r.parentNode&&r.parentNode.removeChild(r),i&&i.forEach((e=>e(n))),a)return a(n)},h=setTimeout(d.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=d.bind(null,r.onerror),r.onload=d.bind(null,r.onload),s&&document.head.appendChild(r)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");a.length&&(e=a[a.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={179:0};n.f.j=(t,a)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)a.push(i[2]);else{var o=new Promise(((a,n)=>{i=e[t]=[a,n]}));a.push(i[2]=o);var r=n.p+n.u(t),s=new Error;n.l(r,(a=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",s.name="ChunkLoadError",s.type=o,s.request=r,i[1](s)}}),"chunk-"+t,t)}};var t=(t,a)=>{for(var i,o,[r,s,l]=a,u=0,c=[];u<r.length;u++)o=r[u],n.o(e,o)&&e[o]&&c.push(e[o][0]),e[o]=0;for(i in s)n.o(s,i)&&(n.m[i]=s[i]);for(l&&l(n),t&&t(a);c.length;)c.shift()()},a=self.webpackChunk=self.webpackChunk||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();const i={profundidadModuloVioleta:2,NucleoPS:{radio:2,altura:4},CilindroNucleoPS:{radioSuperior:1.6,radioInferior:2,altura:.7},anillo:{radio:15.2,radioInterior:.8,distanciaEntreTubos:.4,tubo:{radio:.05,altura:30.4},tuboInterior:{radio:.05,altura:.8*Math.sqrt(2)}},panelSolar:{tapa:{ancho:1.3,largo:6},filasDeTubosSecundarios:4,distanciaEntreTubosSecundarios:2,fc:2.15,tuboPrincipal:{radio:.15,altura:0},tuboSecundario:{radio:.05,altura:2},lado:{ancho:.1,largo:1.3}},pastillas:{cuerpo:{radio:2.5,altura:.8}},ajusteTierra:{radio:1,coordenadas:[0,0,0],rotacion:[0,0,0]},ajusteLuna:{radio:1,coordenadas:[0,0,0],rotacion:[0,0,0]},lightPosition:[[-2093,-1909,-440],[910,180,-2080],[24,-408,-2073]]};function o(e,t){var a=e.__state.conversionName.toString(),n=Math.round(e.r),i=Math.round(e.g),o=Math.round(e.b),r=e.a,s=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===a||"SIX_CHAR_HEX"===a){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===a?"rgb("+n+","+i+","+o+")":"CSS_RGBA"===a?"rgba("+n+","+i+","+o+","+r+")":"HEX"===a?"0x"+e.hex.toString(16):"RGB_ARRAY"===a?"["+n+","+i+","+o+"]":"RGBA_ARRAY"===a?"["+n+","+i+","+o+","+r+"]":"RGB_OBJ"===a?"{r:"+n+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===a?"{r:"+n+",g:"+i+",b:"+o+",a:"+r+"}":"HSV_OBJ"===a?"{h:"+s+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===a?"{h:"+s+",s:"+l+",v:"+u+",a:"+r+"}":"unknown format"}var r=Array.prototype.forEach,s=Array.prototype.slice,l={BREAK:{},extend:function(e){return this.each(s.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(a){this.isUndefined(t[a])||(e[a]=t[a])}.bind(this))}),this),e},defaults:function(e){return this.each(s.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(a){this.isUndefined(e[a])&&(e[a]=t[a])}.bind(this))}),this),e},compose:function(){var e=s.call(arguments);return function(){for(var t=s.call(arguments),a=e.length-1;a>=0;a--)t=[e[a].apply(this,t)];return t[0]}},each:function(e,t,a){if(e)if(r&&e.forEach&&e.forEach===r)e.forEach(t,a);else if(e.length===e.length+0){var n,i=void 0;for(i=0,n=e.length;i<n;i++)if(i in e&&t.call(a,e[i],i)===this.BREAK)return}else for(var o in e)if(t.call(a,e[o],o)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,a){var n=void 0;return function(){var i=this,o=arguments;function r(){n=null,a||e.apply(i,o)}var s=a||!n;clearTimeout(n),n=setTimeout(r,t),s&&e.apply(i,o)}},toArray:function(e){return e.toArray?e.toArray():s.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},u=[{litmus:l.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:o},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:o},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:o},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:o}}},{litmus:l.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:l.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:l.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(l.isNumber(e.r)&&l.isNumber(e.g)&&l.isNumber(e.b)&&l.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(l.isNumber(e.r)&&l.isNumber(e.g)&&l.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(l.isNumber(e.h)&&l.isNumber(e.s)&&l.isNumber(e.v)&&l.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(l.isNumber(e.h)&&l.isNumber(e.s)&&l.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],c=void 0,d=void 0,h=function(){d=!1;var e=arguments.length>1?l.toArray(arguments):arguments[0];return l.each(u,(function(t){if(t.litmus(e))return l.each(t.conversions,(function(t,a){if(c=t.read(e),!1===d&&!1!==c)return d=c,c.conversionName=a,c.conversion=t,l.BREAK})),l.BREAK})),d},p=void 0,f={hsv_to_rgb:function(e,t,a){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=a*(1-t),r=a*(1-i*t),s=a*(1-(1-i)*t),l=[[a,s,o],[r,a,o],[o,a,s],[o,r,a],[s,o,a],[a,o,r]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,a){var n=Math.min(e,t,a),i=Math.max(e,t,a),o=i-n,r=void 0;return 0===i?{h:NaN,s:0,v:0}:(r=e===i?(t-a)/o:t===i?2+(a-e)/o:4+(e-t)/o,(r/=6)<0&&(r+=1),{h:360*r,s:o/i,v:i/255})},rgb_to_hex:function(e,t,a){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),this.hex_with_component(n,0,a)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,a){return a<<(p=8*t)|e&~(255<<p)}},m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),b=function e(t,a,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,a);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,a,n)}if("value"in i)return i.value;var r=i.get;return void 0!==r?r.call(n):void 0},v=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},x=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},T=function(){function e(){if(g(this,e),this.__state=h.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return _(e,[{key:"toString",value:function(){return o(this)}},{key:"toHexString",value:function(){return o(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function E(e,t,a){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||T.recalculateRGB(this,t,a),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(T.recalculateRGB(this,t,a),this.__state.space="RGB"),this.__state[t]=e}})}function y(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||T.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(T.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}T.recalculateRGB=function(e,t,a){if("HEX"===e.__state.space)e.__state[t]=f.component_from_hex(e.__state.hex,a);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");l.extend(e.__state,f.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},T.recalculateHSV=function(e){var t=f.rgb_to_hsv(e.r,e.g,e.b);l.extend(e.__state,{s:t.s,v:t.v}),l.isNaN(t.h)?l.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},T.COMPONENTS=["r","g","b","h","s","v","hex","a"],E(T.prototype,"r",2),E(T.prototype,"g",1),E(T.prototype,"b",0),y(T.prototype,"h"),y(T.prototype,"s"),y(T.prototype,"v"),Object.defineProperty(T.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(T.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=f.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var w=function(){function e(t,a){g(this,e),this.initialValue=t[a],this.domElement=document.createElement("div"),this.object=t,this.property=a,this.__onChange=void 0,this.__onFinishChange=void 0}return _(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),C={};l.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){l.each(e,(function(e){C[e]=t}))}));var A=/(\d+(\.\d+)?)px/;function S(e){if("0"===e||l.isUndefined(e))return 0;var t=e.match(A);return l.isNull(t)?0:parseFloat(t[1])}var M={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,a){var n=a,i=t;l.isUndefined(i)&&(i=!0),l.isUndefined(n)&&(n=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,a,n){var i=a||{},o=C[t];if(!o)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(o);switch(o){case"MouseEvents":var s=i.x||i.clientX||0,u=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,s,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=r.initKeyboardEvent||r.initKeyEvent;l.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}l.defaults(r,n),e.dispatchEvent(r)},bind:function(e,t,a,n){var i=n||!1;return e.addEventListener?e.addEventListener(t,a,i):e.attachEvent&&e.attachEvent("on"+t,a),M},unbind:function(e,t,a,n){var i=n||!1;return e.removeEventListener?e.removeEventListener(t,a,i):e.detachEvent&&e.detachEvent("on"+t,a),M},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var a=e.className.split(/ +/);-1===a.indexOf(t)&&(a.push(t),e.className=a.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return M},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var a=e.className.split(/ +/),n=a.indexOf(t);-1!==n&&(a.splice(n,1),e.className=a.join(" "))}else e.className=void 0;return M},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return S(t["border-left-width"])+S(t["border-right-width"])+S(t["padding-left"])+S(t["padding-right"])+S(t.width)},getHeight:function(e){var t=getComputedStyle(e);return S(t["border-top-width"])+S(t["border-bottom-width"])+S(t["padding-top"])+S(t["padding-bottom"])+S(t.height)},getOffset:function(e){var t=e,a={left:0,top:0};if(t.offsetParent)do{a.left+=t.offsetLeft,a.top+=t.offsetTop,t=t.offsetParent}while(t);return a},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},P=function(e){function t(e,a){g(this,t);var n=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a)),i=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),M.bind(n.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return v(t,e),_(t,[{key:"setValue",value:function(e){var a=b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),a}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(w),R=function(e){function t(e,a,n){g(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a)),o=n,r=i;if(i.__select=document.createElement("select"),l.isArray(o)){var s={};l.each(o,(function(e){s[e]=e})),o=s}return l.each(o,(function(e,t){var a=document.createElement("option");a.innerHTML=t,a.setAttribute("value",e),r.__select.appendChild(a)})),i.updateDisplay(),M.bind(i.__select,"change",(function(){var e=this.options[this.selectedIndex].value;r.setValue(e)})),i.domElement.appendChild(i.__select),i}return v(t,e),_(t,[{key:"setValue",value:function(e){var a=b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),a}},{key:"updateDisplay",value:function(){return M.isActive(this.__select)?this:(this.__select.value=this.getValue(),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(w),I=function(e){function t(e,a){g(this,t);var n=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a)),i=n;function o(){i.setValue(i.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),M.bind(n.__input,"keyup",o),M.bind(n.__input,"change",o),M.bind(n.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),M.bind(n.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return v(t,e),_(t,[{key:"updateDisplay",value:function(){return M.isActive(this.__input)||(this.__input.value=this.getValue()),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(w);function V(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var O=function(e){function t(e,a,n){g(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a)),o=n||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,l.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=V(i.__impliedStep),i}return v(t,e),_(t,[{key:"setValue",value:function(e){var a=e;return void 0!==this.__min&&a<this.__min?a=this.__min:void 0!==this.__max&&a>this.__max&&(a=this.__max),void 0!==this.__step&&a%this.__step!=0&&(a=Math.round(a/this.__step)*this.__step),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,a)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=V(e),this}}]),t}(w),L=function(e){function t(e,a,n){g(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,n));i.__truncationSuspended=!1;var o=i,r=void 0;function s(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function u(e){var t=r-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),r=e.clientY}function c(){M.unbind(window,"mousemove",u),M.unbind(window,"mouseup",c),s()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),M.bind(i.__input,"change",(function(){var e=parseFloat(o.__input.value);l.isNaN(e)||o.setValue(e)})),M.bind(i.__input,"blur",(function(){s()})),M.bind(i.__input,"mousedown",(function(e){M.bind(window,"mousemove",u),M.bind(window,"mouseup",c),r=e.clientY})),M.bind(i.__input,"keydown",(function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,s())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return v(t,e),_(t,[{key:"updateDisplay",value:function(){var e,a,n;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),a=this.__precision,n=Math.pow(10,a),Math.round(e*n)/n),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(O);function k(e,t,a,n,i){return n+(e-t)/(a-t)*(i-n)}var B=function(e){function t(e,a,n,i,o){g(this,t);var r=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,{min:n,max:i,step:o})),s=r;function l(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(k(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function u(){M.unbind(window,"mousemove",l),M.unbind(window,"mouseup",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,a=s.__background.getBoundingClientRect();s.setValue(k(t,a.left,a.right,s.__min,s.__max))}function d(){M.unbind(window,"touchmove",c),M.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return r.__background=document.createElement("div"),r.__foreground=document.createElement("div"),M.bind(r.__background,"mousedown",(function(e){document.activeElement.blur(),M.bind(window,"mousemove",l),M.bind(window,"mouseup",u),l(e)})),M.bind(r.__background,"touchstart",(function(e){1===e.touches.length&&(M.bind(window,"touchmove",c),M.bind(window,"touchend",d),c(e))})),M.addClass(r.__background,"slider"),M.addClass(r.__foreground,"slider-fg"),r.updateDisplay(),r.__background.appendChild(r.__foreground),r.domElement.appendChild(r.__background),r}return v(t,e),_(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(O),N=function(e){function t(e,a,n){g(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===n?"Fire":n,M.bind(i.__button,"click",(function(e){return e.preventDefault(),o.fire(),!1})),M.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return v(t,e),_(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(w),z=function(e){function t(e,a){g(this,t);var n=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));n.__color=new T(n.getValue()),n.__temp=new T(0);var i=n;n.domElement=document.createElement("div"),M.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",M.bind(n.__input,"keydown",(function(e){13===e.keyCode&&p.call(this)})),M.bind(n.__input,"blur",p),M.bind(n.__selector,"mousedown",(function(){M.addClass(this,"drag").bind(window,"mouseup",(function(){M.removeClass(i.__selector,"drag")}))})),M.bind(n.__selector,"touchstart",(function(){M.addClass(this,"drag").bind(window,"touchend",(function(){M.removeClass(i.__selector,"drag")}))}));var o,r=document.createElement("div");function s(e){m(e),M.bind(window,"mousemove",m),M.bind(window,"touchmove",m),M.bind(window,"mouseup",c),M.bind(window,"touchend",c)}function u(e){_(e),M.bind(window,"mousemove",_),M.bind(window,"touchmove",_),M.bind(window,"mouseup",d),M.bind(window,"touchend",d)}function c(){M.unbind(window,"mousemove",m),M.unbind(window,"touchmove",m),M.unbind(window,"mouseup",c),M.unbind(window,"touchend",c),f()}function d(){M.unbind(window,"mousemove",_),M.unbind(window,"touchmove",_),M.unbind(window,"mouseup",d),M.unbind(window,"touchend",d),f()}function p(){var e=h(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function f(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),a=e.touches&&e.touches[0]||e,n=a.clientX,o=a.clientY,r=(n-t.left)/(t.right-t.left),s=1-(o-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),r>1?r=1:r<0&&(r=0),i.__color.v=s,i.__color.s=r,i.setValue(i.__color.toOriginal()),!1}function _(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),a=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return a>1?a=1:a<0&&(a=0),i.__color.h=360*a,i.setValue(i.__color.toOriginal()),!1}return l.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),l.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),l.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),l.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),l.extend(r.style,{width:"100%",height:"100%",background:"none"}),F(r,"top","rgba(0,0,0,0)","#000"),l.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=n.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",l.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),M.bind(n.__saturation_field,"mousedown",s),M.bind(n.__saturation_field,"touchstart",s),M.bind(n.__field_knob,"mousedown",s),M.bind(n.__field_knob,"touchstart",s),M.bind(n.__hue_field,"mousedown",u),M.bind(n.__hue_field,"touchstart",u),n.__saturation_field.appendChild(r),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return v(t,e),_(t,[{key:"updateDisplay",value:function(){var e=h(this.getValue());if(!1!==e){var t=!1;l.each(T.COMPONENTS,(function(a){if(!l.isUndefined(e[a])&&!l.isUndefined(this.__color.__state[a])&&e[a]!==this.__color.__state[a])return t=!0,{}}),this),t&&l.extend(this.__color.__state,e)}l.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var a=this.__color.v<.5||this.__color.s>.5?255:0,n=255-a;l.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+a+","+a+","+a+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,F(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),l.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+a+","+a+","+a+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),t}(w),D=["-moz-","-o-","-webkit-","-ms-",""];function F(e,t,a,n){e.style.background="",l.each(D,(function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+a+" 0%, "+n+" 100%); "}))}var U='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',j=function(e,t){var a=e[t];return l.isArray(arguments[2])||l.isObject(arguments[2])?new R(e,t,arguments[2]):l.isNumber(a)?l.isNumber(arguments[2])&&l.isNumber(arguments[3])?l.isNumber(arguments[4])?new B(e,t,arguments[2],arguments[3],arguments[4]):new B(e,t,arguments[2],arguments[3]):l.isNumber(arguments[4])?new L(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new L(e,t,{min:arguments[2],max:arguments[3]}):l.isString(a)?new I(e,t):l.isFunction(a)?new N(e,t,""):l.isBoolean(a)?new P(e,t):null},H=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},G=function(){function e(){g(this,e),this.backgroundElement=document.createElement("div"),l.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),M.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),l.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;M.bind(this.backgroundElement,"click",(function(){t.hide()}))}return _(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),l.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",M.unbind(e.domElement,"webkitTransitionEnd",t),M.unbind(e.domElement,"transitionend",t),M.unbind(e.domElement,"oTransitionEnd",t)};M.bind(this.domElement,"webkitTransitionEnd",t),M.bind(this.domElement,"transitionend",t),M.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-M.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-M.getHeight(this.domElement)/2+"px"}}]),e}();!function(e,t){var a=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var i=a.getElementsByTagName("head")[0];try{i.appendChild(n)}catch(e){}}(function(e){if("undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var X="Default",Y=function(){try{return!!window.localStorage}catch(e){return!1}}(),q=void 0,K=!0,Q=void 0,W=!1,$=[],J=function e(t){var a=this,n=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),M.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=l.defaults(n,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),n=l.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),l.isUndefined(n.load)?n.load={preset:X}:n.preset&&(n.load.preset=n.preset),l.isUndefined(n.parent)&&n.hideable&&$.push(this),n.resizable=l.isUndefined(n.parent)&&n.resizable,n.autoPlace&&l.isUndefined(n.scrollable)&&(n.scrollable=!0);var i,o=Y&&"true"===localStorage.getItem(ie(0,"isLocal")),r=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return a.parent?a.getRoot().preset:n.load.preset},set:function(e){a.parent?a.getRoot().preset=e:n.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),a.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,ue(a,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,s&&(s.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(t){n.closed=t,n.closed?M.addClass(a.__ul,e.CLASS_CLOSED):M.removeClass(a.__ul,e.CLASS_CLOSED),this.onResize(),a.__closeButton&&(a.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return o},set:function(e){Y&&(o=e,e?M.bind(window,"unload",r):M.unbind(window,"unload",r),localStorage.setItem(ie(0,"isLocal"),e))}}}),l.isUndefined(n.parent)){if(this.closed=n.closed||!1,M.addClass(this.domElement,e.CLASS_MAIN),M.makeSelectable(this.domElement,!1),Y&&o){a.useLocalStorage=!0;var u=localStorage.getItem(ie(0,"gui"));u&&(n.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,M.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),n.closeOnTop?(M.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(M.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),M.bind(this.__closeButton,"click",(function(){a.closed=!a.closed}))}else{void 0===n.closed&&(n.closed=!0);var c=document.createTextNode(n.name);M.addClass(c,"controller-name"),s=Z(a,c),M.addClass(this.__ul,e.CLASS_CLOSED),M.addClass(s,"title"),M.bind(s,"click",(function(e){return e.preventDefault(),a.closed=!a.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(l.isUndefined(n.parent)&&(K&&(Q=document.createElement("div"),M.addClass(Q,"dg"),M.addClass(Q,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Q),K=!1),Q.appendChild(this.domElement),M.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ue(a,n.width)),this.__resizeHandler=function(){a.onResizeDebounced()},M.bind(window,"resize",this.__resizeHandler),M.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),M.bind(this.__ul,"transitionend",this.__resizeHandler),M.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&le(this),r=function(){Y&&"true"===localStorage.getItem(ie(0,"isLocal"))&&localStorage.setItem(ie(0,"gui"),JSON.stringify(a.getSaveObject()))},this.saveToLocalStorageIfPossible=r,n.parent||((i=a.getRoot()).width+=1,l.defer((function(){i.width-=1})))};function Z(e,t,a){var n=document.createElement("li");return t&&n.appendChild(t),a?e.__ul.insertBefore(n,a):e.__ul.appendChild(n),e.onResize(),n}function ee(e){M.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&M.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function te(e,t){var a=e.__preset_select[e.__preset_select.selectedIndex];a.innerHTML=t?a.value+"*":a.value}function ae(e,t){var a=e.getRoot(),n=a.__rememberedObjects.indexOf(t.object);if(-1!==n){var i=a.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},a.__rememberedObjectIndecesToControllers[n]=i),i[t.property]=t,a.load&&a.load.remembered){var o=a.load.remembered,r=void 0;if(o[e.preset])r=o[e.preset];else{if(!o.Default)return;r=o.Default}if(r[n]&&void 0!==r[n][t.property]){var s=r[n][t.property];t.initialValue=s,t.setValue(s)}}}}function ne(e,t,a,n){if(void 0===t[a])throw new Error('Object "'+t+'" has no property "'+a+'"');var i=void 0;if(n.color)i=new z(t,a);else{var o=[t,a].concat(n.factoryArgs);i=j.apply(e,o)}n.before instanceof w&&(n.before=n.before.__li),ae(e,i),M.addClass(i.domElement,"c");var r=document.createElement("span");M.addClass(r,"property-name"),r.innerHTML=i.property;var s=document.createElement("div");s.appendChild(r),s.appendChild(i.domElement);var u=Z(e,s,n.before);return M.addClass(u,J.CLASS_CONTROLLER_ROW),i instanceof z?M.addClass(u,"color"):M.addClass(u,m(i.getValue())),function(e,t,a){if(a.__li=t,a.__gui=e,l.extend(a,{options:function(t){if(arguments.length>1){var n=a.__li.nextElementSibling;return a.remove(),ne(e,a.object,a.property,{before:n,factoryArgs:[l.toArray(arguments)]})}if(l.isArray(t)||l.isObject(t)){var i=a.__li.nextElementSibling;return a.remove(),ne(e,a.object,a.property,{before:i,factoryArgs:[t]})}},name:function(e){return a.__li.firstElementChild.firstElementChild.innerHTML=e,a},listen:function(){return a.__gui.listen(a),a},remove:function(){return a.__gui.remove(a),a}}),a instanceof B){var n=new L(a.object,a.property,{min:a.__min,max:a.__max,step:a.__step});l.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=a[e],i=n[e];a[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(n,e),t.apply(a,e)}})),M.addClass(t,"has-slider"),a.domElement.insertBefore(n.domElement,a.domElement.firstElementChild)}else if(a instanceof L){var i=function(t){if(l.isNumber(a.__min)&&l.isNumber(a.__max)){var n=a.__li.firstElementChild.firstElementChild.innerHTML,i=a.__gui.__listening.indexOf(a)>-1;a.remove();var o=ne(e,a.object,a.property,{before:a.__li.nextElementSibling,factoryArgs:[a.__min,a.__max,a.__step]});return o.name(n),i&&o.listen(),o}return t};a.min=l.compose(i,a.min),a.max=l.compose(i,a.max)}else a instanceof P?(M.bind(t,"click",(function(){M.fakeEvent(a.__checkbox,"click")})),M.bind(a.__checkbox,"click",(function(e){e.stopPropagation()}))):a instanceof N?(M.bind(t,"click",(function(){M.fakeEvent(a.__button,"click")})),M.bind(t,"mouseover",(function(){M.addClass(a.__button,"hover")})),M.bind(t,"mouseout",(function(){M.removeClass(a.__button,"hover")}))):a instanceof z&&(M.addClass(t,"color"),a.updateDisplay=l.compose((function(e){return t.style.borderLeftColor=a.__color.toString(),e}),a.updateDisplay),a.updateDisplay());a.setValue=l.compose((function(t){return e.getRoot().__preset_select&&a.isModified()&&te(e.getRoot(),!0),t}),a.setValue)}(e,u,i),e.__controllers.push(i),i}function ie(e,t){return document.location.href+"."+t}function oe(e,t,a){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),a&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function re(e,t){t.style.display=e.useLocalStorage?"block":"none"}function se(e){var t=e.__save_row=document.createElement("li");M.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),M.addClass(t,"save-row");var a=document.createElement("span");a.innerHTML="&nbsp;",M.addClass(a,"button gears");var n=document.createElement("span");n.innerHTML="Save",M.addClass(n,"button"),M.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",M.addClass(i,"button"),M.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",M.addClass(o,"button"),M.addClass(o,"revert");var r=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?l.each(e.load.remembered,(function(t,a){oe(e,a,a===e.preset)})):oe(e,X,!1),M.bind(r,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(r),t.appendChild(a),t.appendChild(n),t.appendChild(i),t.appendChild(o),Y){var s=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ie(0,"isLocal"))&&u.setAttribute("checked","checked"),re(e,s),M.bind(u,"change",(function(){e.useLocalStorage=!e.useLocalStorage,re(e,s)}))}var c=document.getElementById("dg-new-constructor");M.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||q.hide()})),M.bind(a,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),q.show(),c.focus(),c.select()})),M.bind(n,"click",(function(){e.save()})),M.bind(i,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),M.bind(o,"click",(function(){e.revert()}))}function le(e){var t=void 0;function a(a){return a.preventDefault(),e.width+=t-a.clientX,e.onResize(),t=a.clientX,!1}function n(){M.removeClass(e.__closeButton,J.CLASS_DRAG),M.unbind(window,"mousemove",a),M.unbind(window,"mouseup",n)}function i(i){return i.preventDefault(),t=i.clientX,M.addClass(e.__closeButton,J.CLASS_DRAG),M.bind(window,"mousemove",a),M.bind(window,"mouseup",n),!1}e.__resize_handle=document.createElement("div"),l.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),M.bind(e.__resize_handle,"mousedown",i),M.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ue(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function ce(e,t){var a={};return l.each(e.__rememberedObjects,(function(n,i){var o={},r=e.__rememberedObjectIndecesToControllers[i];l.each(r,(function(e,a){o[a]=t?e.initialValue:e.getValue()})),a[i]=o})),a}function de(e){0!==e.length&&H.call(window,(function(){de(e)})),l.each(e,(function(e){e.updateDisplay()}))}J.toggleHide=function(){W=!W,l.each($,(function(e){e.domElement.style.display=W?"none":""}))},J.CLASS_AUTO_PLACE="a",J.CLASS_AUTO_PLACE_CONTAINER="ac",J.CLASS_MAIN="main",J.CLASS_CONTROLLER_ROW="cr",J.CLASS_TOO_TALL="taller-than-window",J.CLASS_CLOSED="closed",J.CLASS_CLOSE_BUTTON="close-button",J.CLASS_CLOSE_TOP="close-top",J.CLASS_CLOSE_BOTTOM="close-bottom",J.CLASS_DRAG="drag",J.DEFAULT_WIDTH=245,J.TEXT_CLOSED="Close Controls",J.TEXT_OPEN="Open Controls",J._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||J.toggleHide()},M.bind(window,"keydown",J._keydownHandler,!1),l.extend(J.prototype,{add:function(e,t){return ne(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return ne(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;l.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Q.removeChild(this.domElement);var e=this;l.each(this.__folders,(function(t){e.removeFolder(t)})),M.unbind(window,"keydown",J._keydownHandler,!1),ee(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var a=new J(t);this.__folders[e]=a;var n=Z(this,a.domElement);return M.addClass(n,"folder"),a},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],ee(e);var t=this;l.each(e.__folders,(function(t){e.removeFolder(t)})),l.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=M.getOffset(e.__ul).top,a=0;l.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(a+=M.getHeight(t))})),window.innerHeight-t-20<a?(M.addClass(e.domElement,J.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(M.removeClass(e.domElement,J.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&l.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:l.debounce((function(){this.onResize()}),50),remember:function(){if(l.isUndefined(q)&&((q=new G).domElement.innerHTML=U),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;l.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&se(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&ue(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ce(this)),e.folders={},l.each(this.__folders,(function(t,a){e.folders[a]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ce(this),te(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=ce(this,!0)),this.load.remembered[e]=ce(this),this.preset=e,oe(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){l.each(this.__controllers,(function(t){this.getRoot().load.remembered?ae(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),l.each(this.__folders,(function(e){e.revert(e)})),e||te(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&de(this.__listening)},updateDisplay:function(){l.each(this.__controllers,(function(e){e.updateDisplay()})),l.each(this.__folders,(function(e){e.updateDisplay()}))}});var he=J,pe="undefined"!=typeof Float32Array?Float32Array:Array;function fe(){var e=new pe(3);return pe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function me(e,t,a){var n=new pe(3);return n[0]=e,n[1]=t,n[2]=a,n}function ge(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _e(e,t){var a=t[0],n=t[1],i=t[2],o=a*a+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function be(e,t,a){var n=t[0],i=t[1],o=t[2],r=a[0],s=a[1],l=a[2];return e[0]=i*l-o*s,e[1]=o*r-n*l,e[2]=n*s-i*r,e}function ve(e,t,a){var n=t[0],i=t[1],o=t[2],r=a[3]*n+a[7]*i+a[11]*o+a[15];return r=r||1,e[0]=(a[0]*n+a[4]*i+a[8]*o+a[12])/r,e[1]=(a[1]*n+a[5]*i+a[9]*o+a[13])/r,e[2]=(a[2]*n+a[6]*i+a[10]*o+a[14])/r,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),fe();const xe={getCanvas:e=>document.getElementById(e)||(console.error(`There is no canvas with id ${e} on this page.`),null),getGLContext:e=>e.getContext("webgl2")||console.error("WebGL2 is not available in your browser."),autoResizeCanvas(e){const t=()=>{e.width=window.innerWidth,e.height=window.innerHeight};t(),window.addEventListener("resize",t)},getShader(e,t){const a=document.getElementById(t);if(!a)return null;const n=a.text.trim();let i;if("x-shader/x-vertex"===a.type)i=e.createShader(e.VERTEX_SHADER);else{if("x-shader/x-fragment"!==a.type)return null;i=e.createShader(e.FRAGMENT_SHADER)}return e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.error(e.getShaderInfoLog(i)),null)},normalizeColor:e=>e.map((e=>e/255)),denormalizeColor:e=>e.map((e=>255*e)),configureControls(e,t={width:300}){const a=t.gui||new he(t),n={},i=e=>"function"==typeof e;Object.keys(e).forEach((t=>{const o=e[t];if(i(o))return n[t]=o,a.add(n,t);if(!i(r=o)&&"object"==typeof r&&(null===r.value||void 0===r.value))return xe.configureControls(o,{gui:a.addFolder(t)});var r;const{value:s,min:l,max:u,step:c,options:d,onChange:h=(()=>null)}=o;let p;n[t]=s,p=d?a.add(n,t,d):(e=>"string"==typeof e&&~e.indexOf("#")||Array.isArray(e)&&e.length>=3)(s)?a.addColor(n,t):a.add(n,t,l,u,c),p.onChange((e=>h(e,n)))}))},restarVectores(e,t){const a=[];for(let n=0;n<e.length;n++)a.push(e[n]-t[n]);return a},normalizarVector(e){const t=[];let a=0;for(let t=0;t<e.length;t++)a+=e[t]*e[t];a=Math.sqrt(a);for(let n=0;n<e.length;n++){const i=0===a?0:e[n]/a;t.push(i)}return t},calcularNormales(e){const t=[];for(let a=0;a<e.length;a++){const n=e[a];t.push([n[1],-n[0]])}return t},pasarTanAVector3(e){const t=[];for(let a=0;a<e.length;a++)t.push([0,e[a][1],e[a][0]]);return t},productoCruz(e,t){const a=[];return a[0]=e[1]*t[2]-e[2]*t[1],a[1]=e[2]*t[0]-e[0]*t[2],a[2]=e[0]*t[1]-e[1]*t[0],a},calcularVectorBinormal(e,t){const a=[];for(let n=0;n<t.length;n++){const i=t[n],o=this.productoCruz(i,e);a.push(xe.normalizarVector(o))}return a},deRadianesAGrados:e=>180*e/Math.PI>360?180*e/Math.PI-360:180*e/Math.PI,crearForma(e,t){const{puntos:a,puntosTangentes:n}=t.extraerPuntos(e),i=xe.calcularNormales(n);return a.length!==i.length&&(console.error("Se agrega la normal [1,0] al pt:",a[a.length-1]),i.push([1,0])),{puntos:a,normales:i,tangentes:n}},crearRecorrido(e,t,a=[1,0,0]){const{puntos:n,puntosTangentes:i}=t.extraerPuntos(e),o=xe.pasarTanAVector3(i),r=a,s=xe.calcularVectorBinormal(r,o);return n.length===i.length&&i.length===s.length||console.error("No coinciden puntos, tangentes y binormales",n.length,i.length,s.length),{puntos:n,tangentes:o,binormales:s,vectorNormal:r}},crearRecorridoCircular(e,t,a){const n=2*Math.PI*t,i=[],o=[],r=[];for(let t=0;t<=a;t++){const s=n*t/a,l=e*Math.cos(s),u=e*Math.sin(s),c=Math.cos(s),d=Math.sin(s),h=-Math.sin(s),p=Math.cos(s);i.push([l,u]),o.push([c,d,0]),r.push([h,p,0])}return{puntos:i,tangentes:r,binormales:o,vectorNormal:[0,0,1]}},nuevasCoordenadas(e,t,a=!1){const n=t.vertices,i=t.normales,o=t.tangentes,r=[],s=[],l=[];let u=0,c=3;for(n.length!==i.length&&console.log("Vertices y normales distinta longitud");c<=n.length;){const t=me(...n.slice(u,c)),d=me(...i.slice(u,c)),h=me(...o.slice(u,c));ve(d,d,e),ve(t,t,e),ve(h,h,e),a?r.unshift(...t):r.push(...t),_e(d,d),a?s.unshift(...d):s.push(...d),_e(h,h),a?l.unshift(...h):l.push(...h),u+=3,c+=3}return r.length!==s.length&&console.log("Vertices y normales nuevas distinta longitud"),n.length!==r.length&&console.log("Vertices transformados no coinciden en longitud"),i.length!==s.length&&console.log("Normales transformadas no coinciden en longitud"),{vertices:r,normales:s,tangentes:l}},I3(e,t,a=3){t&&console.log(t);for(let t=0;t<e.length;t+=3)console.log(e[t].toFixed(a)+" "+e[t+1].toFixed(a)+" "+e[t+2].toFixed(a))},arrayDeVectores(e,t){const a=[];for(let n=0;n<e.length;n+=t)a.push([...e.slice(n,n+t)]);return a},I2(e,t){const a=[],n=[];t&&"noImprimir"!==t&&console.log(t);for(let i=0;i<e.length;i+=2)a.push(e[i]),n.push(e[i+1]),"noImprimir"!==t&&console.log(e[i].toFixed(4)+" "+e[i+1].toFixed(4));return{columna1:a,columna2:n}},calcularTanYBiTan(e){const{vertices:t,indices:a,textureCoords:n,normales:i}=e,o=xe.arrayDeVectores(t,3),r=xe.arrayDeVectores(n,2),s=xe.arrayDeVectores(i,3),l=[],u=[];for(let e=0;e<o.length;e++)l[e]=[0,0,0],u[e]=[0,0,0];const c={x:0,y:0,z:0},d={x:0,y:0,z:0};let h=0,p=!1;for(let e=0;e<a.length-2;e++){const t=a[e],n=a[e+1],i=a[e+2],s=o[t],f=o[n],m=o[i],g=[f[0]-s[0],f[1]-s[1],f[2]-s[2]],_=[m[0]-s[0],m[1]-s[1],m[2]-s[2]],b=r[t],v=r[n],x=r[i],T=v[0]-b[0],E=v[1]-b[1],y=x[0]-b[0],w=x[1]-b[1];let C=1/(T*w-y*E);p||C===1/0||C===-1/0||0===C||(h=Math.abs(C),p=!0),C===1/0&&(C=h),C===-1/0&&(C=-h),c.x=C*(w*g[0]-E*_[0]),c.y=C*(w*g[1]-E*_[1]),c.z=C*(w*g[2]-E*_[2]),d.x=C*(T*_[0]-y*g[0]),d.y=C*(T*_[1]-y*g[1]),d.z=C*(T*_[2]-y*g[2]);const A=l[t],S=l[n],M=l[i],P=u[t],R=u[n],I=u[i];l[t]=[A[0]+c.x,A[1]+c.y,A[2]+c.z],l[n]=[S[0]+c.x,S[1]+c.y,S[2]+c.z],l[i]=[M[0]+c.x,M[1]+c.y,M[2]+c.z],u[t]=[P[0]+d.x,P[1]+d.y,P[2]+d.z],u[n]=[R[0]+d.x,R[1]+d.y,R[2]+d.z],u[i]=[I[0]+d.x,I[1]+d.y,I[2]+d.z]}const f=[],m=[];for(let e=0;e<o.length;e++){let t=l[e];const a=u[e],n=s[e];(xe.Dot(xe.Cross(t,a),n)>0?1:-1)<0&&(t=xe.MultiplyVector(t,-1)),f.push(...xe.normalizarVector(t)),m.push(...xe.normalizarVector(a))}return{tangentes:f,bitangentes:m}},Dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],Reject(e,t){let a=xe.Dot(e,t)/xe.Dot(t,t);return[e[0]-t[0]*a,e[1]-t[1]*a,e[2]-t[2]*a]},Cross:(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],MultiplyVector:(e,t)=>[e[0]*t,e[1]*t,e[2]*t]};class Te{constructor(e,t,a){return this.gl=e,this.program=e.createProgram(),t&&a?(e.attachShader(this.program,xe.getShader(e,t)),e.attachShader(this.program,xe.getShader(e,a)),e.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)?void this.useProgram():console.error("Could not initialize shaders.")):console.error("No shader IDs were provided")}useProgram(){this.gl.useProgram(this.program)}load(e,t){this.useProgram(),this.setAttributeLocations(e),this.setUniformLocations(t)}setAttributeLocations(e){e.forEach((e=>{this[e]=this.gl.getAttribLocation(this.program,e)}))}setUniformLocations(e){e.forEach((e=>{this[e]=this.gl.getUniformLocation(this.program,e)}))}getUniform(e){return this.gl.getUniform(this.program,e)}}class Ee{constructor(e,t){this.gl=e,this.program=t,this.objects=[]}get(e){return this.objects.find((t=>t.alias===e))}load(e,t,a){return fetch(e).then((e=>e.json())).then((e=>{e.visible=!0,e.alias=t||e.alias,this.add(e,a)})).catch((e=>console.error(e,...arguments)))}loadByParts(e,t,a){for(let n=1;n<=t;n++){const t=`${e}${n}.json`;this.load(t,a)}}add(e,t){const{gl:a,program:n}=this;if(e.diffuse=e.diffuse||[1,1,1,1],e.Kd=e.Kd||e.diffuse.slice(0,3),e.ambient=e.ambient||[.2,.2,.2,1],e.Ka=e.Ka||e.ambient.slice(0,3),e.specular=e.specular||[1,1,1,1],e.Ks=e.Ks||e.specular.slice(0,3),e.specularExponent=e.specularExponent||0,e.Ns=e.Ns||e.specularExponent,e.d=e.d||1,e.transparency=e.transparency||e.d,e.illum=e.illum||1,Object.assign(e,t),e.ibo=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e.ibo),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices),a.STATIC_DRAW),e.vao=a.createVertexArray(),a.bindVertexArray(e.vao),n.aVertexPosition>=0){const t=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,t),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e.vertices),a.STATIC_DRAW),a.enableVertexAttribArray(n.aVertexPosition),a.vertexAttribPointer(n.aVertexPosition,3,a.FLOAT,!1,0,0)}if(n.aVertexNormal>=0){const t=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,t),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e.normales),a.STATIC_DRAW),a.enableVertexAttribArray(n.aVertexNormal),a.vertexAttribPointer(n.aVertexNormal,3,a.FLOAT,!1,0,0)}if(e.scalars&&n.aVertexColor>=0){const t=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,t),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e.scalars),a.STATIC_DRAW),a.enableVertexAttribArray(n.aVertexColor),a.vertexAttribPointer(n.aVertexColor,4,a.FLOAT,!1,0,0)}if(e.textureCoords&&n.aVertexTextureCoords>=0){const t=a.createBuffer();if(a.bindBuffer(a.ARRAY_BUFFER,t),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e.textureCoords),a.STATIC_DRAW),a.enableVertexAttribArray(n.aVertexTextureCoords),a.vertexAttribPointer(n.aVertexTextureCoords,2,a.FLOAT,!1,0,0),n.aVertexTangent>=0){const t=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,t),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e.tangentes),a.STATIC_DRAW),a.enableVertexAttribArray(n.aVertexTangent),a.vertexAttribPointer(n.aVertexTangent,3,a.FLOAT,!1,0,0)}}this.objects.push(e),a.bindVertexArray(null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindBuffer(a.ARRAY_BUFFER,null)}traverse(e){for(let t=0;t<this.objects.length&&void 0===e(this.objects[t],t);t++);}remove(e){const t=this.get(e),a=this.objects.indexOf(t);this.objects.splice(a,1)}renderFirst(e){const t=this.get(e),a=this.objects.indexOf(t);0!==a&&(this.objects.splice(a,1),this.objects.splice(0,0,t),this.printRenderOrder())}renderLast(e){const t=this.get(e),a=this.objects.indexOf(t);0!==a&&(this.objects.splice(a,1),this.objects.push(t),this.printRenderOrder())}renderSooner(e){const t=this.get(e),a=this.objects.indexOf(t);0!==a&&(this.objects.splice(a,1),this.objects.splice(a-1,0,t),this.printRenderOrder())}renderLater(e){const t=this.get(e),a=this.objects.indexOf(t);a!==this.objects.length-1&&(this.objects.splice(a,1),this.objects.splice(a+1,0,t),this.printRenderOrder())}printRenderOrder(){const e=this.objects.map((e=>e.alias)).join(" > ");console.info("Render Order:",e)}}function ye(){var e=new pe(16);return pe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function we(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ce(e,t,a,n,i,o,r,s,l,u,c,d,h,p,f,m,g){return e[0]=t,e[1]=a,e[2]=n,e[3]=i,e[4]=o,e[5]=r,e[6]=s,e[7]=l,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e}function Ae(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Se(e,t){if(e===t){var a=t[1],n=t[2],i=t[3],o=t[6],r=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=a,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=r,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Me(e,t){var a=t[0],n=t[1],i=t[2],o=t[3],r=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],b=a*s-n*r,v=a*l-i*r,x=a*u-o*r,T=n*l-i*s,E=n*u-o*s,y=i*u-o*l,w=c*m-d*f,C=c*g-h*f,A=c*_-p*f,S=d*g-h*m,M=d*_-p*m,P=h*_-p*g,R=b*P-v*M+x*S+T*A-E*C+y*w;return R?(R=1/R,e[0]=(s*P-l*M+u*S)*R,e[1]=(i*M-n*P-o*S)*R,e[2]=(m*y-g*E+_*T)*R,e[3]=(h*E-d*y-p*T)*R,e[4]=(l*A-r*P-u*C)*R,e[5]=(a*P-i*A+o*C)*R,e[6]=(g*x-f*y-_*v)*R,e[7]=(c*y-h*x+p*v)*R,e[8]=(r*M-s*A+u*w)*R,e[9]=(n*A-a*M-o*w)*R,e[10]=(f*E-m*x+_*b)*R,e[11]=(d*x-c*E-p*b)*R,e[12]=(s*C-r*S-l*w)*R,e[13]=(a*S-n*C+i*w)*R,e[14]=(m*v-f*T-g*b)*R,e[15]=(c*T-d*v+h*b)*R,e):null}function Pe(e,t,a){var n=t[0],i=t[1],o=t[2],r=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],b=t[15],v=a[0],x=a[1],T=a[2],E=a[3];return e[0]=v*n+x*s+T*d+E*m,e[1]=v*i+x*l+T*h+E*g,e[2]=v*o+x*u+T*p+E*_,e[3]=v*r+x*c+T*f+E*b,v=a[4],x=a[5],T=a[6],E=a[7],e[4]=v*n+x*s+T*d+E*m,e[5]=v*i+x*l+T*h+E*g,e[6]=v*o+x*u+T*p+E*_,e[7]=v*r+x*c+T*f+E*b,v=a[8],x=a[9],T=a[10],E=a[11],e[8]=v*n+x*s+T*d+E*m,e[9]=v*i+x*l+T*h+E*g,e[10]=v*o+x*u+T*p+E*_,e[11]=v*r+x*c+T*f+E*b,v=a[12],x=a[13],T=a[14],E=a[15],e[12]=v*n+x*s+T*d+E*m,e[13]=v*i+x*l+T*h+E*g,e[14]=v*o+x*u+T*p+E*_,e[15]=v*r+x*c+T*f+E*b,e}function Re(e,t,a){var n,i,o,r,s,l,u,c,d,h,p,f,m=a[0],g=a[1],_=a[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(n=t[0],i=t[1],o=t[2],r=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],f=t[11],e[0]=n,e[1]=i,e[2]=o,e[3]=r,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=d,e[9]=h,e[10]=p,e[11]=f,e[12]=n*m+s*g+d*_+t[12],e[13]=i*m+l*g+h*_+t[13],e[14]=o*m+u*g+p*_+t[14],e[15]=r*m+c*g+f*_+t[15]),e}function Ie(e,t,a){var n=a[0],i=a[1],o=a[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ve(e,t,a,n){var i,o,r,s,l,u,c,d,h,p,f,m,g,_,b,v,x,T,E,y,w,C,A,S,M=n[0],P=n[1],R=n[2],I=Math.hypot(M,P,R);return I<1e-6?null:(M*=I=1/I,P*=I,R*=I,i=Math.sin(a),r=1-(o=Math.cos(a)),s=t[0],l=t[1],u=t[2],c=t[3],d=t[4],h=t[5],p=t[6],f=t[7],m=t[8],g=t[9],_=t[10],b=t[11],v=M*M*r+o,x=P*M*r+R*i,T=R*M*r-P*i,E=M*P*r-R*i,y=P*P*r+o,w=R*P*r+M*i,C=M*R*r+P*i,A=P*R*r-M*i,S=R*R*r+o,e[0]=s*v+d*x+m*T,e[1]=l*v+h*x+g*T,e[2]=u*v+p*x+_*T,e[3]=c*v+f*x+b*T,e[4]=s*E+d*y+m*w,e[5]=l*E+h*y+g*w,e[6]=u*E+p*y+_*w,e[7]=c*E+f*y+b*w,e[8]=s*C+d*A+m*S,e[9]=l*C+h*A+g*S,e[10]=u*C+p*A+_*S,e[11]=c*C+f*A+b*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Oe(e,t,a){var n=Math.sin(a),i=Math.cos(a),o=t[4],r=t[5],s=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+u*n,e[5]=r*i+c*n,e[6]=s*i+d*n,e[7]=l*i+h*n,e[8]=u*i-o*n,e[9]=c*i-r*n,e[10]=d*i-s*n,e[11]=h*i-l*n,e}function Le(e,t,a){var n=Math.sin(a),i=Math.cos(a),o=t[0],r=t[1],s=t[2],l=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-u*n,e[1]=r*i-c*n,e[2]=s*i-d*n,e[3]=l*i-h*n,e[8]=o*n+u*i,e[9]=r*n+c*i,e[10]=s*n+d*i,e[11]=l*n+h*i,e}function ke(e,t,a){var n=Math.sin(a),i=Math.cos(a),o=t[0],r=t[1],s=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+u*n,e[1]=r*i+c*n,e[2]=s*i+d*n,e[3]=l*i+h*n,e[4]=u*i-o*n,e[5]=c*i-r*n,e[6]=d*i-s*n,e[7]=h*i-l*n,e}function Be(){var e=new pe(4);return pe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ne(e,t,a,n,i){return e[0]=t,e[1]=a,e[2]=n,e[3]=i,e}function ze(e,t,a){var n=t[0],i=t[1],o=t[2],r=t[3];return e[0]=a[0]*n+a[4]*i+a[8]*o+a[12]*r,e[1]=a[1]*n+a[5]*i+a[9]*o+a[13]*r,e[2]=a[2]*n+a[6]*i+a[10]*o+a[14]*r,e[3]=a[3]*n+a[7]*i+a[11]*o+a[15]*r,e}Be();class De{constructor(e=De.ORBITING_TYPE){this.position=fe(),this.focus=fe(),this.up=fe(),this.right=fe(),this.normal=fe(),this.matrix=ye(),this.steps=0,this.azimuth=0,this.elevation=0,this.fov=45,this.minZ=.1,this.maxZ=1e4,this.factorVelocidad=500,this.azimuthActual=0,this.elevationActual=-30,this.timeOutIdPool=[],this.rotationMatrix=null,this.setType(e)}setRotationMatrix(e){this.rotationMatrix=e}isOrbiting(){return this.type===De.ORBITING_TYPE}isTracking(){return this.type===De.TRACKING_TYPE}setType(e){~De.TYPES.indexOf(e)?this.type=e:console.error(`Camera type (${e}) not supported`)}goTo(e=[0,0,0],t=0,a=0,n=[0,0,0]){this.setPosition(e),this.setAzimuth(t),this.setElevation(a),this.setFocus(n)}dolly(e){const t=fe(),a=fe();_e(t,this.normal);const n=e-this.steps;this.isTracking()?(a[0]=this.position[0]-n*t[0],a[1]=this.position[1]-n*t[1],a[2]=this.position[2]-n*t[2]):(a[0]=this.position[0],a[1]=this.position[1],a[2]=this.position[2]-n),this.steps=e,this.setPosition(a)}setPosition(e){ge(this.position,e),this.update()}setFocus(e){ge(this.focus,e),this.update()}colocarPaulatinamenteLaCamaraEn(e,t){const a=this.azimuthActual,n=this.elevationActual,i=(this.elevation-e)/this.factorVelocidad,o=(this.azimuth-t)/this.factorVelocidad;Math.abs(i)>.001||Math.abs(o)>.001?(this.elevation-=i,this.azimuth-=o,this.update(),a===t&&n===e?this.timeOutIdPool.push(setTimeout((()=>{this.colocarPaulatinamenteLaCamaraEn(e,t)}),10)):(this.borrarTimeOutIdPool(),this.azimuthActual=t,this.elevationActual=e)):this.borrarTimeOutIdPool()}borrarTimeOutIdPool(){this.timeOutIdPool.forEach((e=>{clearTimeout(e)})),this.timeOutIdPool=[]}setAzimuth(e){this.changeAzimuth(e-this.azimuth)}changeAzimuth(e){this.azimuth+=e,(this.azimuth>360||this.azimuth<-360)&&(this.azimuth=this.azimuth%360),this.update()}setElevation(e){this.changeElevation(e-this.elevation)}changeElevation(e){this.elevation+=e,(this.elevation>360||this.elevation<-360)&&(this.elevation=this.elevation%360),this.update()}lookAt(){const e=Be();Ne(e,0,0,0,1),ze(e,e,this.matrix),this.cameraPositionCoordDelMundo=e;const t=fe();var a,n,i;a=t,n=e,i=this.focus,a[0]=n[0]-i[0],a[1]=n[1]-i[1],a[2]=n[2]-i[2],_e(t,t);const o=fe();be(o,this.up,t),_e(o,o);const r=fe();be(r,t,o),_e(r,r),Ae(this.matrix),Ce(this.matrix,o[0],o[1],o[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1)}calculateOrientation(){const e=Be();Ne(e,1,0,0,0),ze(e,e,this.matrix),ge(this.right,e);const t=Be();Ne(t,0,1,0,0),ze(t,t,this.matrix),ge(this.up,t);const a=Be();Ne(a,0,0,1,0),ze(a,a,this.matrix),ge(this.normal,a)}dejarDeSeguirALaCapsula(){this.seguirCapsula=!1}seguirALaCapsula(){this.seguirCapsula=!0}update(){if(Ae(this.matrix),this.isTracking()?(Re(this.matrix,this.matrix,this.position),Le(this.matrix,this.matrix,this.azimuth*Math.PI/180),Oe(this.matrix,this.matrix,this.elevation*Math.PI/180)):(Re(this.matrix,this.matrix,this.focus),this.seguirCapsula&&Pe(this.matrix,this.matrix,this.rotationMatrix),Le(this.matrix,this.matrix,this.azimuth*Math.PI/180),Oe(this.matrix,this.matrix,this.elevation*Math.PI/180),Re(this.matrix,this.matrix,this.position)),this.isTracking()){const e=Be();Ne(e,0,0,0,1),ze(e,e,this.matrix),ge(this.position,e)}this.calculateOrientation(),this.isOrbiting()&&this.lookAt()}logCamera(){console.log(`posCamara: ${this.position[0].toFixed(2)}, ${this.position[1].toFixed(2)}, ${this.position[2].toFixed(2)}`),console.log(`azimuth: ${this.azimuth.toFixed(2)}`),console.log(`elevation: ${this.elevation.toFixed(2)}`)}getViewTransform(){const e=ye();return Me(e,this.matrix),e}}De.TYPES=["ORBITING_TYPE","TRACKING_TYPE"],De.TYPES.forEach((e=>De[e]=e));class Fe{constructor(e,t,a,n){this.camera=e,this.canvas=t,this.droneCam=a,this.spotLightDir=n,this.picker=null,this.dragging=!1,this.picking=!1,this.ctrl=!1,this.x=0,this.y=0,this.lastX=0,this.lastY=0,this.button=0,this.key=0,this.dloc=0,this.dstep=0,this.motionFactor=10,this.keyIncrement=3,this.focusCamera={Nave:!1,PanelesSolares:!1,Capsula:!1},t.onmousedown=e=>this.onMouseDown(e),t.onmouseup=e=>this.onMouseUp(e),t.onmousemove=e=>this.onMouseMove(e),t.onwheel=e=>this.onMouseWheel(e),window.onkeydown=e=>this.onKeyDown(e),window.onkeyup=e=>this.onKeyUp(e),this.dondeEstoy="Nave",this.Camara={Nave:{position:fe(),azimuth:0,elevation:0,focus:fe()},PanelesSolares:{position:me(0,0,29.5),azimuth:-180,elevation:-30,focus:fe()},Capsula:{position:me(0,0,20),azimuth:0,elevation:-30.8,focus:fe()}}}setFocusCapsula(e){this.Camara.Capsula.focus=e}setFocus(e,t){this.Camara.Nave.focus=e,this.Camara.PanelesSolares.focus=t}setPicker(e){this.picker=e}get2DCoords(e){let t=0,a=0,n=this.canvas;for(;n&&"BODY"!==n.tagName;)t+=n.offsetTop,a+=n.offsetLeft,n=n.offsetParent;return a+=window.pageXOffset,t-=window.pageYOffset,{x:e.clientX-a,y:this.canvas.height-(e.clientY-t)}}onMouseUp(e){this.dragging=!1,!e.shiftKey&&this.picker&&(this.picking=!1,this.picker.stop())}onMouseDown(e){if(this.dragging=!0,this.x=e.clientX,this.y=e.clientY,this.button=e.button,this.dstep=Math.max(this.camera.position[0],this.camera.position[1],this.camera.position[2])/100,!this.picker)return;const t=this.get2DCoords(e);this.picking=this.picker.find(t),this.picking||this.picker.stop()}dollyHelper(e,t=3){for(this.dstep=Math.max(this.camera.position[0],this.camera.position[1],this.camera.position[2])/100;t--;)this.dolly(e)}onMouseWheel(e){const t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));this.dollyHelper(t)}onMouseMove(e){if(this.lastX=this.x,this.lastY=this.y,this.x=e.clientX,this.y=e.clientY,!this.dragging)return;this.ctrl=e.ctrlKey,this.alt=e.altKey;const t=this.x-this.lastX,a=this.y-this.lastY;this.picking&&this.picker.moveCallback?this.picker.moveCallback(t,a):this.button||(this.alt?this.dolly(a):this.rotate(t,a))}configurarCamaraDe(e){ge(this.Camara[this.dondeEstoy].position,this.camera.position),this.Camara[this.dondeEstoy].azimuth=this.camera.azimuth,this.Camara[this.dondeEstoy].elevation=this.camera.elevation,this.camera.goTo(this.Camara[e].position,this.Camara[e].azimuth,this.Camara[e].elevation,this.Camara[e].focus),this.dondeEstoy=e,"Nave"===e?(this.focusCamera.PanelesSolares=!1,this.focusCamera.Capsula=!1,this.focusCamera.Nave=!0):"PanelesSolares"===e?(this.focusCamera.Nave=!1,this.focusCamera.Capsula=!1,this.focusCamera.PanelesSolares=!0):"Capsula"===e&&(this.focusCamera.Nave=!1,this.focusCamera.PanelesSolares=!1,this.focusCamera.Capsula=!0)}onKeyDown(e){if(this.key=e.keyCode,this.ctrl=e.ctrlKey,!this.ctrl)switch(this.key){case 49:return this.droneCam.activarControlesTeclado(!1),this.camera.borrarTimeOutIdPool(),this.camera.dejarDeSeguirALaCapsula(),this.configurarCamaraDe("Nave");case 50:return this.droneCam.activarControlesTeclado(!1),this.camera.borrarTimeOutIdPool(),this.camera.dejarDeSeguirALaCapsula(),this.configurarCamaraDe("PanelesSolares");case 51:return this.droneCam.activarControlesTeclado(),this.camera.seguirALaCapsula(),this.configurarCamaraDe("Capsula");case 88:return this.dollyHelper(-1);case 90:return this.dollyHelper(1);case 102:return this.spotLightDir.cambiarAzimuth(this.keyIncrement);case 100:return this.spotLightDir.cambiarAzimuth(-this.keyIncrement);case 104:return this.spotLightDir.cambiarElevation(this.keyIncrement);case 98:return this.spotLightDir.cambiarElevation(-this.keyIncrement)}}onKeyUp(e){17===e.keyCode&&(this.ctrl=!1)}dolly(e){e>0?this.dloc+=this.dstep:this.dloc-=this.dstep,this.camera.dolly(this.dloc)}rotate(e,t){const{width:a,height:n}=this.canvas,i=-20/n,o=e*(-20/a)*this.motionFactor,r=t*i*this.motionFactor;this.camera.changeAzimuth(o),this.camera.changeElevation(r)}}class Ue{constructor(e,t,a,n){this.stack=[],this.gl=e,this.program=t,this.camera=a,this.canvas=n,this.modelViewMatrix=ye(),this.projectionMatrix=ye(),this.normalMatrix=ye(),this.calculateModelView(),this.updatePerspective(),this.calculateNormal()}calculateModelView(){this.modelViewMatrix=this.camera.getViewTransform()}calculateNormal(){we(this.normalMatrix,this.modelViewMatrix),Me(this.normalMatrix,this.normalMatrix),Se(this.normalMatrix,this.normalMatrix)}updatePerspective(){var e,t,a,n,i,o,r;e=this.projectionMatrix,t=this.camera.fov,a=this.canvas.width/this.canvas.height,n=this.camera.minZ,i=this.camera.maxZ,r=1/Math.tan(t/2),e[0]=r/a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n)}setMatrixUniforms(){this.calculateNormal(),this.gl.uniformMatrix4fv(this.program.uModelViewMatrix,!1,this.modelViewMatrix),this.gl.uniformMatrix4fv(this.program.uProjectionMatrix,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.program.uNormalMatrix,!1,this.normalMatrix)}push(){const e=ye();we(e,this.modelViewMatrix),this.stack.push(e)}pop(){return this.stack.length?this.modelViewMatrix=this.stack.pop():null}}const je={Textura:{diffuse:[1,1,1,1],ambient:[.2,.2,.2,1]},PanelSolar:[0,40/255,166/255,1],Violeta:[1,0,138/255,1],Pastilla:[169/255,183/255,43/255,1],RojoMetalico:[.71875,0,.1796,1],sunLightColor:[[255,176,186,255],[191,255,209,255],[255,186,255,255]]};class He{constructor(e){this.dimensionesTriangulos=e}construir(e){const t=[],a=[],n=[],i=[];for(let o=0;o<=this.dimensionesTriangulos.filas;o++)for(let r=0;r<=this.dimensionesTriangulos.columnas;r++){let s=r/this.dimensionesTriangulos.columnas,l=o/this.dimensionesTriangulos.filas,u=e.getPosicion(s,l);t.push(u[0]),t.push(u[1]),t.push(u[2]);let c=e.getCoordenadasTextura(s,l);n.push(c[0]),n.push(c[1]);let d=e.getTangente(s,l);i.push(d[0]),i.push(d[1]),i.push(d[2]);let h=e.getNormal(s,l);a.push(h[0]),a.push(h[1]),a.push(h[2])}const o=this.dimensionesTriangulos.columnas+1,r=[];for(let e=0;e<this.dimensionesTriangulos.filas;e++){for(let t=0;t<this.dimensionesTriangulos.columnas+1;t+=2)r.push(e*o+t),r.push((e+1)*o+t),r.push(e*o+t+1),r.push((e+1)*o+t+1);const t=r.length;this.dimensionesTriangulos.columnas%2?(r.push(r[t-1]),r.push((e+1)*o+0)):(r[t-1]=r[t-2],r[t-2]=r[t-3])}return r.pop(),r.pop(),{positionBuffer:t,normalBuffer:a,uvBuffer:n,indexBuffer:r,tangenteBuffer:i}}}class Ge{constructor(e,t){this.alias=t,this.vertices=[],this.indices=[],this.textureCoords=[],this.normales=[],this.tangentes=[],this.diffuse=je.RojoMetalico,this.visible=!0,this.dimensionesTriangulos=e,this.wireframe=!1}superficie(){}construir(){const e=new He(this.dimensionesTriangulos).construir(this.superficie());this.vertices=e.positionBuffer,this.indices=e.indexBuffer,this.normales=e.normalBuffer,this.textureCoords=e.uvBuffer,this.tangentes=e.tangenteBuffer}}class Xe extends Ge{constructor(e,t,a,n=!1){super(a,e),this.dimensionesCilindro=t,this.invertirNormales=n,this.construir()}superficie(){const e=this.dimensionesCilindro.radioSuperior,t=this.dimensionesCilindro.radioInferior,a=this.dimensionesCilindro.altura,n=(t-e)/a,i=this.invertirNormales;return{getPosicion:function(n,i){const o=i*(e-t)+t,r=2*Math.PI*n;return[o*Math.sin(r),i*a,o*Math.cos(r)]},getNormal:function(e,t){const a=2*Math.PI*e,o=xe.normalizarVector([Math.sin(a),n,Math.cos(a)]);return!0===i?o.map((e=>-e)):o},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(n,o){const r=2*Math.PI*n,s=o*(e-t)+t,l=2*Math.PI*s,u=[l*Math.cos(r),0,-l*Math.sin(r)],c=e-t,d=[c*Math.sin(r),a,c*Math.cos(r)],h=u.map(((e,t)=>e+d[t])),p=xe.normalizarVector(h);return!0===i?p.map((e=>-e)):p}}}}class Ye extends Ge{constructor(e,t,a){super(a,e),this.dimensionesTubo=t,this.construir()}superficie(){const e=this.dimensionesTubo.radio,t=this.dimensionesTubo.altura;return{getPosicion:function(a,n){const i=2*Math.PI*a,o=e,r=o*Math.cos(i),s=o*Math.sin(i);return[r,n*t,s]},getNormal:function(e,t){const a=2*Math.PI*e;return[Math.cos(a),0,Math.sin(a)]},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(a,n){const i=2*Math.PI*a,o=2*Math.PI*e;return xe.normalizarVector([-o*Math.sin(i),t,o*Math.cos(i)])}}}}class qe extends Ge{constructor(e,t,a){super(a,e),this.radio=t,this.construir()}superficie(){const e=this.radio;return{getPosicion:function(t,a){const n=2*Math.PI*t;return[e*a*Math.cos(n),0,e*a*Math.sin(n)]},getNormal:function(e,t){return[0,1,0]},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(t,a){const n=2*Math.PI*e*a,i=2*Math.PI*t,o=[-n*Math.sin(i),0,n*Math.cos(i)],r=[e*Math.cos(i),0,e*Math.sin(i)],s=o.map(((e,t)=>e+r[t]));return xe.normalizarVector(s)}}}}class Ke extends Ge{constructor(e,t,a){super(a,e),this.dimensiones=t,this.construir()}superficie(){const e=this.dimensiones.ancho,t=this.dimensiones.largo;return{getPosicion:function(a,n){return[(a-.5)*e,0,(n-.5)*t]},getNormal:function(e,t){return[0,1,0]},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(e,t){return[1,0,0]}}}}const Qe={filas:1,columnas:1},We={ancho:.1,largo:6},$e={filas:1,columnas:10},Je=$e;class Ze{constructor(e=300,t){this.velocidadMediaDeGiro=e,this.anguloEnProceso=-5,this.anguloActual=0,this.intervaloEnGrados=t,this.timeOutIdPool=[],this._GIRO={LINEAL:1,LOG:0},this.MODO_GIRO=this._GIRO.LINEAL}empezarEn(e,t){this.panelSolar=t;const a=Math.floor(xe.deRadianesAGrados(e));a%this.intervaloEnGrados==0&&a!==this.anguloEnProceso&&(this.anguloEnProceso=a,this.calcularParametrosYAnimar())}dameUnaVelocidadDeGiroRandom(){return Math.floor(this.velocidadMediaDeGiro*(.5+Math.random()))}dameUnNuevoAngulo(){const e=Math.random(),t=Math.random();let a=Math.random()<.5?this.panelSolar.anguloRotacion*(1-e):this.panelSolar.anguloRotacion*(1+t);return a=Math.floor(a>360?a%360:a),a<18&&(a=10*a+1),a}elegirUnGiro(e){Math.random()<e?this.MODO_GIRO=this._GIRO.LINEAL:this.MODO_GIRO=this._GIRO.LOG}calcularParametrosYAnimar(){const e=this.dameUnaVelocidadDeGiroRandom(),t=this.dameUnNuevoAngulo();this.anguloActual=t,this.elegirUnGiro(.6),this.cambiarElAnguloRotacionPanelSolar(t,e)}cambiarElAnguloRotacionPanelSolar(e,t){const a=this.anguloActual,n=this.panelSolar.anguloRotacion-e;let i;0!==t?(i=n/t,Math.abs(i)>.02?(this.panelSolar.anguloRotacion-=i,a===e?this.timeOutIdPool.push(setTimeout((()=>{this.cambiarElAnguloRotacionPanelSolar(e,t-this.MODO_GIRO)}),10)):(this.limpiarElPool(),this.anguloActual=e,this.cambiarElAnguloRotacionPanelSolar(e,t-this.MODO_GIRO))):this.limpiarElPool()):this.limpiarElPool()}limpiarElPool(){this.timeOutIdPool.forEach((e=>clearTimeout(e))),this.timeOutIdPool=[]}}class et{constructor(e){this.scene=e,this.panelesEnEscena=[],this.cantidadDeFilas=4,this.construirComponentes()}construirComponentes(){this.componentes=[];const e=new Ke("panelTapaSuperior",i.panelSolar.tapa,Qe);e.diffuse=je.PanelSolar,this.componentes.push(e);const t=new Ke("panelTapaInferior",i.panelSolar.tapa,Qe);t.diffuse=je.PanelSolar,this.componentes.push(t),this.componentes.push(new Ke("panelLadoA",i.panelSolar.lado,Qe)),this.componentes.push(new Ke("panelLadoA1",i.panelSolar.lado,Qe)),this.componentes.push(new Ke("panelLadoB",We,Qe)),this.componentes.push(new Ke("panelLadoB1",We,Qe)),this.cambiarAlturaDelTuboPrincipal()}nuevo(e){const t=[];t.push(new Ge(null,e)),t.push(...this.componentes),this.agregarALaEscena(t),this.panelesEnEscena.push(t)}agregarALaEscena(e){e.forEach((e=>{this.scene.add(e)}))}removerPanelesSolares(){const{scene:e}=this;e.remove("tuboPrincipal"),e.remove("tapaPrincipal");for(let t=0;t<this.cantidadDeFilas;t++)e.remove("tuboSecundario"),e.remove("tapaSecundaria1"),e.remove("tapaSecundaria2"),this.removerParPaneles()}removerParPaneles(e=2){let t=0;if(this.panelesEnEscena.length<e)console.error("No hay mas paneles para remover");else for(;t<e;)this.panelesEnEscena.pop().forEach((e=>{this.scene.remove(e.alias)})),t++}cambiarAlturaDelTuboPrincipal(){i.panelSolar.tuboPrincipal.altura=this.cantidadDeFilas*i.panelSolar.distanciaEntreTubosSecundarios+2.15}cargarPanelesSolares(){const{scene:e}=this;e.add(new Ye("tuboPrincipal",i.panelSolar.tuboPrincipal,$e)),e.add(new qe("tapaPrincipal",i.panelSolar.tuboPrincipal.radio,Je));for(let t=0;t<this.cantidadDeFilas;t++)e.add(new Ye("tuboSecundario",i.panelSolar.tuboSecundario,$e)),e.add(new qe("tapaSecundaria1",i.panelSolar.tuboSecundario.radio,Je)),e.add(new qe("tapaSecundaria2",i.panelSolar.tuboSecundario.radio,Je)),this.nuevo("panelSolar1"),this.nuevo("panelSolar2")}}function tt(e,t,a,n,i){return function(e,t){const a=1-e;return a*a*a*t}(e,t)+function(e,t){const a=1-e;return 3*a*a*e*t}(e,a)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}class at{constructor(e=[0,0],t=[0,0],a=[0,0],n=[0,0]){this.type="CurvaDeBezier",this.v0=e,this.v1=t,this.v2=a,this.v3=n}extraerPuntos(e=5){const t=[],a=[];for(let n=0;n<=e;n++)t.push(this.extraerPunto(n/e)),a.push(this.getTangent(n/e));return{puntos:t,puntosTangentes:a}}extraerPunto(e,t=[0,0]){const a=t,n=this.v0,i=this.v1,o=this.v2,r=this.v3;return a[0]=tt(e,n[0],i[0],o[0],r[0]),a[1]=tt(e,n[1],i[1],o[1],r[1]),a}getTangent(e){const t=1e-4;let a=e-t,n=e+t;a<0&&(a=0),n>1&&(n=1);const i=this.extraerPunto(a),o=this.extraerPunto(n),r=xe.restarVectores(o,i);return xe.normalizarVector(r)}}class nt{constructor(){this.curvas=[],this.puntoActual=[0,0],this.esCurvaCerrada=!1}curvaCerrada(e){this.esCurvaCerrada=e}actualizarPuntoActual(e,t){return this.puntoActual[0]=e,this.puntoActual[1]=t,this}extraerPuntos(e=12){const t=[],a=[];let n;for(let i=0,o=this.curvas;i<o.length;i++){const r=o[i];let s,l;if(r&&"CurvaDeBezier"===r.type){const{puntos:t,puntosTangentes:n}=r.extraerPuntos(e);s=t,l=n,a.push(...l)}else s=r;for(let e=0;e<s.length;e++){const a=s[e];n&&n[0]===a[0]&&n[1]===a[1]||(t.push(a),n=a)}}return!0===this.esCurvaCerrada&&a.push(a[0]),{puntos:t,puntosTangentes:a}}clonarPuntoActual(){return[this.puntoActual[0],this.puntoActual[1]]}CurvaBezierA(e,t,a,n,i,o){const r=new at(this.clonarPuntoActual(),[e,t],[a,n],[i,o]);return this.curvas.push(r),this.actualizarPuntoActual(i,o),this}iniciarEn(e,t){return this.actualizarPuntoActual(e,t),this}lineaA(e,t){const a=[this.clonarPuntoActual(),[e,t]];return this.curvas.push(a),this.actualizarPuntoActual(e,t),this}}class it extends Ge{constructor(e,t,a){super(a,e),this.puntosDeLaForma=t,this.construir()}superficie(){const e=this.puntosDeLaForma;let t,a,n=0;return{getPosicion:function(i,o){t=e[n][0],a=e[n][1];const r=o*e[n][0],s=o*e[n][1];return n++,1===i&&(n=0),[r,0,s]},getNormal:(e,t)=>[0,1,0],getCoordenadasTextura:function(e,t){return[e,1-t]},getTangente:(e,n)=>xe.normalizarVector([-a,0,t])}}}class ot extends Ge{constructor(e,t,a,n,i=!1){super(n,e),this.datosDelRecorrido=a,this.datosDeLaForma=t,this.recorridoXY=i,this.construir()}superficie(){let e=0,t=0;const a=this.datosDelRecorrido,n=this.recorridoXY,i=this.datosDeLaForma;let o;return{getPosicion:function(r,s){const[l,u]=i.puntos[e],[c,d]=i.normales[e],h=a.binormales[t],p=a.tangentes[t],f=a.puntos[t],m=a.vectorNormal,g=ye();n?Ce(g,m[0],h[0],p[0],f[0],m[1],h[1],p[1],f[1],m[2],h[2],p[2],0,0,0,0,1):Ce(g,m[0],h[0],p[0],0,m[1],h[1],p[1],f[1],m[2],h[2],p[2],f[0],0,0,0,1),Se(g,g);const _=Be();Ne(_,l,u,0,1),ze(_,_,g);const b=ye();return Ce(b,m[0],h[0],p[0],0,m[1],h[1],p[1],0,m[2],h[2],p[2],0,0,0,0,1),Se(b,b),o=Be(),Ne(o,c,d,0,1),ze(o,o,b),[_[0],_[1],_[2]]},getNormal(a,n){e++,1===a&&(e=0,t++);const i=xe.normalizarVector([o[0],o[1],o[2]]);return[i[0],i[1],i[2]]},getCoordenadasTextura:function(e,t){return[e,1-t]},getTangente:(e,t)=>[e,t,e-1]}}}class rt extends Ge{constructor(e,t,a,n,i=!1){super(n,e),this.datosDelRecorrido=a,this.datosDeLaForma=t,this.recorridoXY=i,this.construir()}superficie(){let e=0,t=0;const a=this.datosDelRecorrido,n=this.recorridoXY,i=this.datosDeLaForma;let o,r;return{getPosicion:function(s,l){const[u,c]=i.puntos[e],[d,h]=i.normales[e],[p,f]=i.tangentes[e],m=a.binormales[t],g=a.tangentes[t],_=a.puntos[t],b=a.vectorNormal,v=ye();n?Ce(v,b[0],m[0],g[0],_[0],b[1],m[1],g[1],_[1],b[2],m[2],g[2],0,0,0,0,1):Ce(v,b[0],m[0],g[0],0,b[1],m[1],g[1],_[1],b[2],m[2],g[2],_[0],0,0,0,1),Se(v,v);const x=Be();Ne(x,u,c,0,1),ze(x,x,v);const T=ye();return Ce(T,b[0],m[0],g[0],0,b[1],m[1],g[1],0,b[2],m[2],g[2],0,0,0,0,1),Se(T,T),o=Be(),Ne(o,d,h,0,1),ze(o,o,T),r=Be(),Ne(r,p,f,0,1),ze(r,r,T),[x[0],x[1],x[2]]},getTangente(e,t){const a=xe.normalizarVector([r[0],r[1],r[2]]);return[a[0],a[1],a[2]]},getNormal(a,n){e++,1===a&&(e=0,t++);const i=xe.normalizarVector([o[0],o[1],o[2]]);return[i[0],i[1],i[2]]},getCoordenadasTextura:function(e,t){return[t,e]}}}}class st{constructor(e,t,a=st.BLOQUES_8,n=16,i=8){this.scene=t,this.radioDelAnillo=e,this.bloqueActual=null,this.pasoDiscretoRecorrido=n,this.divisionesForma=i,this.dictionary={},st.TYPES.forEach((e=>{this.dictionary[e]=[]})),this.construirBloques()}obtenerNuevasCoordenadasTapaAtras(e,t){const a=Ae(ye());Ve(a,a,e,[0,0,1]),Ve(a,a,Math.PI/2,[0,1,0]);const n=Ae(ye());Re(n,n,[15.2*Math.cos(e),15.2*Math.sin(e),0]),Pe(n,n,a);const i=xe.nuevasCoordenadas(n,t,!1),o=xe.nuevasCoordenadas(a,t,!1),r=o.normales,s=o.tangentes;return{vertices:i.vertices,normales:r,tangentes:s}}construirBloques(){const{radioDelAnillo:e,pasoDiscretoRecorrido:t,divisionesForma:a}=this,n=new nt;n.iniciarEn(2.2,.6),n.CurvaBezierA(2.2,.8,2,1,1.8,1),n.lineaA(-1.8,1),n.CurvaBezierA(-2,1,-2.2,.8,-2.2,.6),n.lineaA(-2.2,-.6),n.CurvaBezierA(-2.2,-.8,-2,-1,-1.8,-1),n.lineaA(1.8,-1),n.CurvaBezierA(2,-1,2.2,-.8,2.2,-.6),n.lineaA(2.2,.6).curvaCerrada(!0);const i=xe.crearForma(a,n);i.puntos.splice(9,0,[0,1]),i.puntos.splice(19,0,[-2.2,0]),i.puntos.splice(29,0,[0,-1]),i.puntos.splice(39,0,[2.2,0]),i.normales.splice(9,0,[0,1]),i.normales.splice(19,0,[-1,0]),i.normales.splice(29,0,[0,-1]),i.normales.splice(39,0,[1,0]),i.tangentes.splice(9,0,[-1,0]),i.tangentes.splice(19,0,[0,-1]),i.tangentes.splice(29,0,[1,0]),i.tangentes.splice(39,0,[0,1]);const o=i.puntos.length-1,r={filas:t,columnas:o},s=new Ge(null,"bloque"),l=new Ge(null,"bloque"),u=new Ge(null,"bloque"),c=new Ge(null,"bloque"),d=new Ge(null,"bloque"),h=xe.crearRecorridoCircular(e,1/8,r.filas),p=xe.crearRecorridoCircular(e,.1,r.filas),f=xe.crearRecorridoCircular(e,1/12,r.filas),m=xe.crearRecorridoCircular(e,1/14,r.filas),g=xe.crearRecorridoCircular(e,1/16,r.filas),_=new rt("bloque4_cuerpo",i,h,r,!0),b=new rt("bloque5_cuerpo",i,p,r,!0),v=new rt("bloque6_cuerpo",i,f,r,!0),x=new rt("bloque7_cuerpo",i,m,r,!0),T=new rt("bloque8_cuerpo",i,g,r,!0),E=new it("bloque4_tapaAtras",i.puntos,{filas:1,columnas:o}),y=new it("bloque4_tapaAdelante",i.puntos,{filas:1,columnas:o}),w=Ae(ye());Re(w,w,[15.2,0,0]),Ve(w,w,Math.PI/2,[0,1,0]),Ve(w,w,Math.PI,[1,0,0]);const C=Ae(ye());Ve(C,C,Math.PI/2,[0,1,0]),Ve(C,C,Math.PI,[1,0,0]);const A=xe.nuevasCoordenadas(C,y,!1),S=xe.nuevasCoordenadas(w,y,!1);S.normales=A.normales,S.tangentes=A.tangentes;const M=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/4,E),P=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/5,E),R=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/6,E),I=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/7,E),V=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/8,E);let O=0,L=[],k=[];for(let e=0;e<y.vertices.length;e+=3){const t={x:y.vertices[e],y:y.vertices[e+1],z:y.vertices[e+2]},a={x:y.vertices[(e+3)%y.vertices.length],y:y.vertices[(e+4)%y.vertices.length],z:y.vertices[(e+5)%y.vertices.length]};if(0===t.x&&0===t.y&&0===t.z||0===a.x&&0===a.y&&0===a.z)continue;const n=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)+Math.pow(a.z-t.z,2));L.push(n),O+=n}let B=0;k.push(0),L.map((e=>{B+=e,k.push(B/O)}));const N=[];for(let e=0;e<h.puntos.length+4;e++)N.push(e/(h.puntos.length+3));const z=[];for(let e=0;e<N.length;e++)for(let t=0;t<k.length;t++)z.push(1-k[t],N[e]);const D=[];_.indices.forEach((e=>{D.push(e+Math.max(...y.indices)+1)}));const F=[];E.indices.forEach((e=>{F.push(e+Math.max(...D)+1)}));const U=[];U.push(...y.indices,81,82,...D,778,779,...F),s.indices.push(...U),l.indices.push(...U),u.indices.push(...U),c.indices.push(...U),d.indices.push(...U),s.vertices.push(...S.vertices,..._.vertices,...M.vertices),l.vertices.push(...S.vertices,...b.vertices,...P.vertices),u.vertices.push(...S.vertices,...v.vertices,...R.vertices),c.vertices.push(...S.vertices,...x.vertices,...I.vertices),d.vertices.push(...S.vertices,...T.vertices,...V.vertices),s.normales.push(...S.normales,..._.normales,...M.normales),l.normales.push(...S.normales,...b.normales,...P.normales),u.normales.push(...S.normales,...v.normales,...R.normales),c.normales.push(...S.normales,...x.normales,...I.normales),d.normales.push(...S.normales,...T.normales,...V.normales),s.tangentes.push(...S.tangentes,..._.tangentes,...M.tangentes),l.tangentes.push(...S.tangentes,...b.tangentes,...P.tangentes),u.tangentes.push(...S.tangentes,...v.tangentes,...R.tangentes),c.tangentes.push(...S.tangentes,...x.tangentes,...I.tangentes),d.tangentes.push(...S.tangentes,...T.tangentes,...V.tangentes),s.textureCoords.push(...z),l.textureCoords.push(...z),u.textureCoords.push(...z),c.textureCoords.push(...z),d.textureCoords.push(...z);let j=4;for(;j--;)this.dictionary[st.BLOQUES_4].push(s);for(j=5;j--;)this.dictionary[st.BLOQUES_5].push(l);for(j=6;j--;)this.dictionary[st.BLOQUES_6].push(u);for(j=7;j--;)this.dictionary[st.BLOQUES_7].push(c);for(j=8;j--;)this.dictionary[st.BLOQUES_8].push(d)}setType(e){~st.TYPES.indexOf(e)?this.type=e:console.error(`Bloque type (${e}) not supported`),this.removerBloqueActualDeLaEscena(),this.actualizarEscena()}dameElTipoDeBloqueActual(){return this.type}removerBloqueActualDeLaEscena(){null!=this.bloqueActual&&this.bloqueActual.forEach((e=>{this.scene.remove(e.alias)}))}actualizarEscena(){this.dictionary[this.type].forEach((e=>{this.scene.add(e,{texture:"bloque",diffuse:je.Textura.diffuse,ambient:je.Textura.ambient})})),this.bloqueActual=this.dictionary[this.type]}}function lt(e,t){let a=.01,n=.05;e||(e=[0,0,0]);let i=me(e[0],e[1],e[2]),o=fe(),r=ye(),s={xVel:0,zVel:0,yVel:0,xVelTarget:0,zVelTarget:0,yVelTarget:0,yRotVelTarget:0,yRotVel:0,zRotVelTarget:0,zRotVel:0,xRotVelTarget:0,xRotVel:0,rightAxisMode:"move"},l=Object.assign({},s);this.listener=function(n){switch(n.key){case"ArrowUp":case"w":t.colocarPaulatinamenteLaCamaraEn(-30,0),l.zVelTarget=.3;break;case"ArrowDown":case"s":t.colocarPaulatinamenteLaCamaraEn(-30,180),l.zVelTarget=-.3;break;case"ArrowLeft":case"a":t.colocarPaulatinamenteLaCamaraEn(-30,90),l.xVelTarget=.3;break;case"ArrowRight":case"d":t.colocarPaulatinamenteLaCamaraEn(-30,-90),l.xVelTarget=-.3;break;case"q":case"PageUp":case" ":t.colocarPaulatinamenteLaCamaraEn(90,0),l.yVelTarget=.3;break;case"e":case"PageDown":t.colocarPaulatinamenteLaCamaraEn(-90,0),l.yVelTarget=-.3;break;case"k":l.xRotVelTarget=a;break;case"i":l.xRotVelTarget=-.01;break;case"j":l.yRotVelTarget=a;break;case"l":l.yRotVelTarget=-.01;break;case"u":l.zRotVelTarget=a;break;case"o":l.zRotVelTarget=-.01;break;case"r":o=fe(),i=me(e[0],e[1],e[2]),l=Object.assign({},s),r=ye();break;case"t":o=fe(),l=Object.assign({},s)}},this.activarControlesTeclado=function(e=!0){e?(document.addEventListener("keydown",this.listener),document.addEventListener("keyup",(function(e){switch(e.key){case"ArrowUp":case"w":case"ArrowDown":case"s":l.zVelTarget=0;break;case"ArrowLeft":case"a":case"ArrowRight":case"d":l.xVelTarget=0;break;case"q":case"e":case"PageDown":case"PageUp":case" ":l.yVelTarget=0;break;case"j":case"l":l.yRotVelTarget=0;break;case"i":case"k":l.xRotVelTarget=0;break;case"u":case"o":l.zRotVelTarget=0}}))):document.removeEventListener("keydown",this.listener)},this.update=function(){l.xVel+=(l.xVelTarget-l.xVel)*n,l.yVel+=(l.yVelTarget-l.yVel)*n,l.zVel+=(l.zVelTarget-l.zVel)*n,l.xRotVel+=(l.xRotVelTarget-l.xRotVel)*n,l.yRotVel+=(l.yRotVelTarget-l.yRotVel)*n,l.zRotVel+=(l.zRotVelTarget-l.zRotVel)*n;let e=me(-l.xVel,l.yVel,-l.zVel);var t,a,o;return Math.abs(l.xRotVel)>0&&Ve(r,r,l.xRotVel,me(1,0,0)),Math.abs(l.yRotVel)>0&&Ve(r,r,l.yRotVel,me(0,1,0)),Math.abs(l.zRotVel)>0&&Ve(r,r,l.zRotVel,me(0,0,1)),ve(e,e,r),a=i,o=e,(t=i)[0]=a[0]+o[0],t[1]=a[1]+o[1],t[2]=a[2]+o[2],{rotationMatrix:r,position:i}}}st.TYPES=["BLOQUES_8","BLOQUES_7","BLOQUES_6","BLOQUES_5","BLOQUES_4"],st.TYPES.forEach((e=>st[e]=e));const ut={bloqueTransform:null,centrarElBloque:.42,distanciaNucleoDelAnilloYNave:i.NucleoPS.altura+i.CilindroNucleoPS.altura,distanciaModuloVioletaYNave:i.NucleoPS.altura+2*i.CilindroNucleoPS.altura+i.profundidadModuloVioleta,posicionBloque:0},ct={torusTransform:null,distanciaTubosInteriores:i.anillo.radio,sentidoTuboInterior:1,desplazamientoTuboInterior:0,factorDesplazamientoEntreTubosInteriores:3,pastillaTransform:null,alturaTapaSuperior:.9,alturaTapaInferior:.1},dt={nucleoPSTransform:null,nucleoAnilloTransform:null},ht={capsulaTransform:null},pt={naveTransform:null},ft={tuboTransform:null,tuboSecundarioTransform:null,distanciaRelativaConElTuboPrincipal:3.5,distanciaConElNucleo:4.5,panelTransform:null},mt={esferaTransform:null,radio:2,angulo:Math.PI/4,posRelativaALaNave:8.8},gt={transform:null,lado:5},_t={transform:null};class bt{constructor(e,t,a,n,i,o){this.animacion=o,this.bloque=i,this.transforms=e,this.droneCam=t,this.controles=a,this.camera=n,this.paramAnillo={pastillaEnElMedio:1.55,factorDeVelocidad:5},this.panelSolar={anguloRotacion:310,animar:!0},this.posicionAnillo=0,this.cargarParametrosBloques(),this.cuboTransform=e.modelViewMatrix,this.cargarParametrosMundo()}cargarParametrosMundo(){this.tierraLunaTransform=[{tierra:{x:904,y:-939,z:1554,rx:.87,ry:4.89,rz:3.73,radio:1405},luna:{x:525,y:850,z:-722,rx:1.96,ry:1.08,rz:0,radio:345}},{tierra:{x:-1101,y:-1047,z:1392,rx:1.49,ry:4.01,rz:3.39,radio:1405},luna:{x:1283,y:-17,z:-180,rx:1.42,ry:2.78,rz:5.98,radio:345}},{tierra:{x:-2131,y:-939,z:741,rx:.4,ry:1.89,rz:1.83,radio:1405},luna:{x:796,y:145,z:1066,rx:.87,ry:.67,rz:2.57,radio:345}}]}cargarParametrosBloques(){let e=360,t=8;this.parametrosBloques={},st.TYPES.forEach((a=>{this.parametrosBloques[a]={anguloPosicion:e,anguloTapaAtras:180/t--},e-=45}))}setAlias(e){this.alias=e}capsula(){const{transforms:e,droneCam:t,controles:a,camera:n}=this;if("capsula"===this.alias){ht.capsulaTransform=e.modelViewMatrix;const{rotationMatrix:i,position:o}=t.update();a.setFocusCapsula(o),!0===a.focusCamera.Capsula&&n.setFocus(o),n.setRotationMatrix(i),Re(ht.capsulaTransform,ht.capsulaTransform,o),Pe(ht.capsulaTransform,ht.capsulaTransform,i),Ve(ht.capsulaTransform,ht.capsulaTransform,Math.PI,[1,0,0])}else if("capsulaCuerpoCilindroA"===this.alias){const t=e.modelViewMatrix;Re(t,ht.capsulaTransform,[0,0,.1]),Ve(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroB"===this.alias){const t=e.modelViewMatrix;Re(t,ht.capsulaTransform,[0,0,.3]),Ve(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoBezierA"===this.alias)Ve(e.modelViewMatrix,ht.capsulaTransform,Math.PI/2,[0,0,1]);else if("capsulaCuerpoCilindroC"===this.alias){const t=e.modelViewMatrix;Re(t,ht.capsulaTransform,[0,0,2.51]),Ve(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroD"===this.alias){const t=e.modelViewMatrix;Re(t,ht.capsulaTransform,[0,0,2.9]),Ve(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroE"===this.alias){const t=e.modelViewMatrix;Re(t,ht.capsulaTransform,[0,0,2.901]),Ve(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCola"===this.alias)Re(e.modelViewMatrix,ht.capsulaTransform,[0,0,.2]);else if("capsulaFuegoCola"===this.alias){const t=e.modelViewMatrix;Ve(t,ht.capsulaTransform,-Math.PI/2,[0,0,1]),Re(t,t,[0,0,ht.curvaColav0x+.5+.2]),Ve(t,t,-Math.PI/2,[1,0,0])}else if("capsulaFuegoCuerpo"===this.alias){const t=e.modelViewMatrix;Re(t,ht.capsulaTransform,[0,0,ht.CilAaltura+ht.FuegoCuerpoAltura]),Ve(t,t,-Math.PI/2,[1,0,0])}}esfera(){const{transforms:e}=this;"esfera"===this.alias&&(mt.esferaTransform=e.modelViewMatrix,Re(mt.esferaTransform,pt.naveTransform,[0,0,-mt.posRelativaALaNave]))}bloques(){const{bloque:e,transforms:t}=this,a=e.dameElTipoDeBloqueActual(),n=this.parametrosBloques[a];if("bloque"===this.alias){ut.bloqueTransform=t.modelViewMatrix;const e=(22.5+90*ut.posicionBloque)*Math.PI/n.anguloPosicion;Ve(ut.bloqueTransform,ct.pastillaTransform,e,[0,1,0]),Re(ut.bloqueTransform,ut.bloqueTransform,[0,ut.centrarElBloque,0]),Ve(ut.bloqueTransform,ut.bloqueTransform,Math.PI/2,[1,0,0]),ut.posicionBloque++}}modulosVioleta(){const{transforms:e}=this;"moduloVioletaPS"===this.alias?Re(e.modelViewMatrix,pt.naveTransform,[0,0,0]):"moduloVioletaAnillo"===this.alias&&Re(e.modelViewMatrix,pt.naveTransform,[0,0,-ut.distanciaModuloVioletaYNave])}nucleoDelPanelSolar(){const{transforms:e}=this,t=i.profundidadModuloVioleta+i.CilindroNucleoPS.altura;"nucleoPS"===this.alias&&(dt.nucleoPSTransform=e.modelViewMatrix,Re(dt.nucleoPSTransform,pt.naveTransform,[0,0,t]),Ve(dt.nucleoPSTransform,dt.nucleoPSTransform,Math.PI/2,[1,0,0]))}panelesSolares(){const{transforms:e}=this;if("tuboPrincipal"===this.alias)ft.tuboTransform=e.modelViewMatrix,Re(ft.tuboTransform,dt.nucleoPSTransform,[0,ft.distanciaConElNucleo,0]);else if("tapaPrincipal"===this.alias)Re(e.modelViewMatrix,ft.tuboTransform,[0,i.panelSolar.tuboPrincipal.altura,0]);else if("tuboSecundario"===this.alias)ft.tuboSecundarioTransform=e.modelViewMatrix,Re(ft.tuboSecundarioTransform,ft.tuboTransform,[i.panelSolar.tuboSecundario.altura/2,ft.distanciaRelativaConElTuboPrincipal,0]),ke(ft.tuboSecundarioTransform,ft.tuboSecundarioTransform,Math.PI/2),ft.distanciaRelativaConElTuboPrincipal+=i.panelSolar.distanciaEntreTubosSecundarios;else if("tapaSecundaria1"===this.alias)Re(e.modelViewMatrix,ft.tuboSecundarioTransform,[0,i.panelSolar.tuboSecundario.altura,0]);else if("tapaSecundaria2"===this.alias){const t=e.modelViewMatrix;Re(t,ft.tuboSecundarioTransform,[0,0,0]),Oe(t,t,Math.PI)}else if("panelSolar1"===this.alias)ft.panelTransform=e.modelViewMatrix,Re(ft.panelTransform,ft.tuboSecundarioTransform,[0,-i.panelSolar.tapa.largo/2,0]),Oe(ft.panelTransform,ft.panelTransform,-Math.PI/2),ke(ft.panelTransform,ft.panelTransform,2*Math.PI*this.panelSolar.anguloRotacion/360);else if("panelSolar2"===this.alias)ft.panelTransform=e.modelViewMatrix,Re(ft.panelTransform,ft.tuboSecundarioTransform,[0,i.panelSolar.tuboSecundario.altura+i.panelSolar.tapa.largo/2,0]),Oe(ft.panelTransform,ft.panelTransform,-Math.PI/2),ke(ft.panelTransform,ft.panelTransform,2*Math.PI*this.panelSolar.anguloRotacion/360);else if("panelTapaSuperior"===this.alias)Re(e.modelViewMatrix,ft.panelTransform,[0,i.panelSolar.lado.ancho,0]);else if("panelTapaInferior"===this.alias)Ve(e.modelViewMatrix,ft.panelTransform,Math.PI,[1,0,0]);else if("panelLadoA"===this.alias){const t=e.modelViewMatrix;Re(t,ft.panelTransform,[0,i.panelSolar.lado.ancho/2,i.panelSolar.tapa.largo/2]),Ve(t,t,Math.PI/2,[0,0,1]),Ve(t,t,Math.PI,[0,1,1])}else if("panelLadoA1"===this.alias){const t=e.modelViewMatrix;Re(t,ft.panelTransform,[0,i.panelSolar.lado.ancho/2,-i.panelSolar.tapa.largo/2]),Ve(t,t,Math.PI/2,[1,0,0]),Ve(t,t,-Math.PI,[1,0,1])}else if("panelLadoB"===this.alias){const t=e.modelViewMatrix;Re(t,ft.panelTransform,[i.panelSolar.lado.largo/2,i.panelSolar.lado.ancho/2,0]),Ve(t,t,Math.PI,[1,1,0])}else if("panelLadoB1"===this.alias){const t=e.modelViewMatrix;Re(t,ft.panelTransform,[-i.panelSolar.lado.largo/2,i.panelSolar.lado.ancho/2,0]),Ve(t,t,-Math.PI,[0,0,1]),Ve(t,t,-Math.PI,[1,1,0])}}nucleoDelAnillo(){const{transforms:e}=this;"nucleoAnillo"===this.alias&&(dt.nucleoAnilloTransform=e.modelViewMatrix,Re(dt.nucleoAnilloTransform,pt.naveTransform,[0,0,-ut.distanciaNucleoDelAnilloYNave]),Ve(dt.nucleoAnilloTransform,dt.nucleoAnilloTransform,Math.PI/2,[1,0,0]))}animarAnillo(e){this.posicionAnillo+=e}anillo(){const{transforms:e,posicionAnillo:t,animacion:a}=this;if("pastillaCuerpo"===this.alias){ct.pastillaTransform=e.modelViewMatrix;const n=t/this.paramAnillo.factorDeVelocidad;Ve(ct.pastillaTransform,dt.nucleoAnilloTransform,n,[0,1,0]),Re(ct.pastillaTransform,ct.pastillaTransform,[0,this.paramAnillo.pastillaEnElMedio,0]),this.panelSolar.animar&&a.empezarEn(n,this.panelSolar)}else if("pastillaCilindroSup"===this.alias){const t=e.modelViewMatrix;Ve(t,ct.pastillaTransform,Math.PI/2,[0,1,0]),Re(t,t,[0,i.pastillas.cuerpo.altura,0])}else if("pastillaCilindroInf"===this.alias){const t=e.modelViewMatrix;Ve(t,ct.pastillaTransform,-Math.PI,[1,0,0]),Ve(t,t,Math.PI/2,[0,1,0])}else if("pastillaTapaSup"===this.alias){const t=e.modelViewMatrix;Ve(t,ct.pastillaTransform,0,[1,0,0]),Re(t,t,[0,ct.alturaTapaSuperior,0])}else if("pastillaTapaInf"===this.alias){const t=e.modelViewMatrix;Ve(t,ct.pastillaTransform,-Math.PI,[1,0,0]),Re(t,t,[0,ct.alturaTapaInferior,0])}else if("torus"===this.alias)ct.torusTransform=e.modelViewMatrix,Re(ct.torusTransform,ct.pastillaTransform,[0,i.pastillas.cuerpo.altura/2,0]),Ve(ct.torusTransform,ct.torusTransform,Math.PI/2,[1,0,0]);else if("anillo_tuboH1"===this.alias)Re(e.modelViewMatrix,ct.torusTransform,[-i.anillo.distanciaEntreTubos,-i.anillo.tubo.altura/2,0]);else if("anillo_tuboH2"===this.alias)Re(e.modelViewMatrix,ct.torusTransform,[i.anillo.distanciaEntreTubos,-i.anillo.tubo.altura/2,0]);else if("anillo_tuboV1"===this.alias){const t=e.modelViewMatrix;Re(t,ct.torusTransform,[i.anillo.tubo.altura/2,i.anillo.distanciaEntreTubos,0]),Ve(t,t,Math.PI/2,[0,0,1])}else if("anillo_tuboV2"===this.alias){const t=e.modelViewMatrix;Re(t,ct.torusTransform,[i.anillo.tubo.altura/2,-i.anillo.distanciaEntreTubos,0]),Ve(t,t,Math.PI/2,[0,0,1])}else if("anillo_tuboInterior"===this.alias){const t=e.modelViewMatrix;ct.desplazamientoTuboInterior<i.anillo.tubo.altura?Re(t,ct.torusTransform,[0,ct.distanciaTubosInteriores-ct.desplazamientoTuboInterior,0]):Re(t,ct.torusTransform,[ct.factorDesplazamientoEntreTubosInteriores*ct.distanciaTubosInteriores-ct.desplazamientoTuboInterior,0,0]),Ve(t,t,ct.sentidoTuboInterior*Math.PI/4,[0,0,1]),Re(t,t,[0,-i.anillo.tuboInterior.altura/2,0]),ct.sentidoTuboInterior*=-1,ct.desplazamientoTuboInterior+=2*i.anillo.distanciaEntreTubos}}luna(){const{transforms:e,mundo:t}=this;if("luna"===this.alias){const a=e.modelViewMatrix;i.ajusteLuna.coordenadas[0],i.ajusteLuna.coordenadas[1],i.ajusteLuna.coordenadas[2],i.ajusteLuna.rotacion[0],i.ajusteLuna.rotacion[1],i.ajusteLuna.rotacion[2],i.ajusteLuna.radio,Re(a,a,[t.luna.x,t.luna.y,t.luna.z]),Oe(a,a,t.luna.rx),ke(a,a,t.luna.ry),Le(a,a,t.luna.rz)}}tierra(){const{transforms:e,mundo:t}=this;if("tierra"===this.alias){const a=e.modelViewMatrix;i.ajusteTierra.coordenadas[0],i.ajusteTierra.coordenadas[1],i.ajusteTierra.coordenadas[2],i.ajusteTierra.rotacion[0],i.ajusteTierra.rotacion[1],i.ajusteTierra.rotacion[2],i.ajusteTierra.radio,Re(a,a,[t.tierra.x,t.tierra.y,t.tierra.z]),Oe(a,a,t.tierra.rx),ke(a,a,t.tierra.ry),Le(a,a,t.tierra.rz)}}tierraLunaEnElMundo(e){this.mundo=this.tierraLunaTransform[e]}translate(e,t,a){Re(e,e,[t,0,-a])}rotate(e,t){Ve(e,e,t*Math.PI/180,[0,1,0])}scale(e,t,a){Ie(e,e,[t,0,a])}esferaEscenario(){const{transforms:e}=this;if("esferaEscenario"===this.alias){const t=e.modelViewMatrix;Re(t,t,[-10,8,-10]),Le(t,t,2*Math.PI*this.posicionAnillo/3)}}test(){const{transforms:e}=this;if("test"===this.alias){const t=e.modelViewMatrix;this.translate(t,-4,-6),this.translate(t,4,0),this.scale(t,2,2),this.rotate(t,45),this.translate(t,2,0),this.translate(t,2,-.5)}}cubo(){const{transforms:e}=this;if("cubo"===this.alias)gt.transform=e.modelViewMatrix;else if("cubo_lado1"===this.alias){const t=e.modelViewMatrix;Re(t,gt.transform,[0,0,gt.lado/2]),Ve(t,t,Math.PI/2,[1,0,0])}else if("cubo_lado2"===this.alias){const t=e.modelViewMatrix;Re(t,gt.transform,[0,0,-gt.lado/2]),Ve(t,t,Math.PI/2,[-1,0,0])}else if("cubo_lado3"===this.alias){const t=e.modelViewMatrix;Ve(t,gt.transform,Math.PI/2,[0,1,0]),Re(t,t,[0,0,-gt.lado/2]),Ve(t,t,Math.PI/2,[-1,0,0])}else if("cubo_lado4"===this.alias){const t=e.modelViewMatrix;Ve(t,gt.transform,-Math.PI/2,[0,1,0]),Re(t,t,[0,0,-gt.lado/2]),Ve(t,t,Math.PI/2,[-1,0,0])}else if("cubo_lado5"===this.alias)Re(e.modelViewMatrix,gt.transform,[0,gt.lado/2,0]);else if("cubo_lado6"===this.alias){const t=e.modelViewMatrix;Re(t,gt.transform,[0,-gt.lado/2,0]),Ve(t,t,Math.PI,[1,0,0])}}teatro(){const{transforms:e}=this;if("teatro"===this.alias)_t.transform=e.modelViewMatrix;else if("teatro_lado1"===this.alias)e.modelViewMatrix;else if("teatro_lado2"===this.alias){const t=e.modelViewMatrix;Re(t,_t.transform,[0,2,-2]),Ve(t,t,Math.PI/2,[1,0,0])}else if("teatro_lado3"===this.alias){const t=e.modelViewMatrix;Ve(t,_t.transform,Math.PI/2,[0,1,0]),Re(t,t,[0,2,-2]),Ve(t,t,Math.PI/2,[1,0,0])}}complexCube(){const{transforms:e}=this;if("complexCube"===this.alias){const t=e.modelViewMatrix;Ie(t,t,[5,5,5])}}}class vt{constructor(e){this.id=e,this.position=[0,0,0],this.ambient=[0,0,0,0],this.diffuse=[0,0,0,0],this.specular=[0,0,0,0]}setPosition(e){this.position=e.slice(0)}setDiffuse(e){this.diffuse=e.slice(0)}setAmbient(e){this.ambient=e.slice(0)}setSpecular(e){this.specular=e.slice(0)}setProperty(e,t){this[e]=t}}class xt{constructor(){this.list=[]}add(e){e instanceof vt?this.list.push(e):console.error("The parameter is not a light")}getArray(e){return this.list.reduce(((t,a)=>t.concat(a[e])),[])}get(e){return"string"==typeof e?this.list.find((t=>t.id===e)):this.list[e]}}class Tt{constructor(e,t){this.gl=e,this.program=t}validarAngulos(){(this.azimuth<0||this.azimuth>360)&&(this.azimuth=this.azimuth%360),(this.elevation<0||this.elevation>360)&&(this.elevation=this.elevation%360)}azimuthElevationToVector(){this.validarAngulos();const{azimuth:e,elevation:t}=this,a=e*Math.PI/180,n=t*Math.PI/180,i=Math.cos(n)*Math.cos(a),o=Math.cos(n)*Math.sin(a),r=Math.sin(n);this.vector=[i,r,o],this.printNewVector()}printNewVector(){console.clear(),console.log(`${this.azimuth.toFixed(1)}° azimuth, ${this.elevation.toFixed(1)}° elevation`),console.log(`-> ${this.vector[0].toFixed(2)}, ${this.vector[1].toFixed(2)}, ${this.vector[2].toFixed(2)}`)}cambiarAzimuth(e,t=null){null===t?this.azimuth+=e:this.azimuth=t,this.azimuthElevationToVector(),this.actualizarEnLaEscena()}cambiarElevation(e,t=null){null===t?this.elevation+=e:this.elevation=t,this.azimuthElevationToVector(),this.actualizarEnLaEscena()}actualizarEnLaEscena(){const{gl:e,program:t}=this;this.lightArray[3]=this.vector[0],this.lightArray[4]=this.vector[1],this.lightArray[5]=this.vector[2],this.lightArray[6]=this.vector[0],this.lightArray[7]=this.vector[1],this.lightArray[8]=this.vector[2],e.uniform3fv(t.uLightDirection,this.lightArray)}esteEsElLightsArray(e){this.lightArray=e,this.lightArray[6]=this.lightArray[3],this.lightArray[7]=this.lightArray[4],this.lightArray[8]=this.lightArray[5],this.vector=[this.lightArray[3],this.lightArray[4],this.lightArray[5]],this.azimuth=180*Math.atan2(this.vector[2],this.vector[0])/Math.PI,this.elevation=180*Math.atan2(this.vector[1],Math.sqrt(this.vector[0]*this.vector[0]+this.vector[2]*this.vector[2]))/Math.PI,this.validarAngulos()}}class Et{constructor(e,t){this.gl=e,this.glTexture=e.createTexture(),this.image=new Image,this.image.onload=()=>this.handleLoadedTexture(),t&&this.setImage(t)}setImage(e){this.image.src=e}handleLoadedTexture(){const{gl:e,image:t,glTexture:a}=this;e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)}}const yt=n.p+"assets/images/8ab40f718b980383b31344b595247259.jpg",wt=n.p+"assets/images/d13c703d8d81a74b76513d3b148c5b90.jpg",Ct=n.p+"assets/images/37793c358f680d148683b61b4dc7ec56.jpg",At=n.p+"assets/images/2c72bf10f998ffe1383ddec512b325e6.jpg",St=n.p+"assets/images/0c7b3762b566f9203236c0ded51cdf43.jpg",Mt=n.p+"assets/images/85995578057a6749eeb17da378697d65.jpg",Pt=n.p+"assets/images/4583b65f3a700395e74f85efe112532b.jpg",Rt=n.p+"assets/images/9cdfa8ba7c088ad3893c8359395c4990.jpg",It=n.p+"assets/images/1b453aecde6ee844a942847e24d2412f.jpg",Vt=n.p+"assets/images/56b01432ebd754e8564167279da412a0.jpg",Ot=n.p+"assets/images/3dd880c5aab006b6c425c1e9110cefc3.jpg",Lt=n.p+"assets/images/822da2e7af7bc38f4aae43b420ba2641.jpg",kt=n.p+"assets/images/15e96339007f60800ffbdee8d6d20236.jpg",Bt=n.p+"assets/images/ca4a3f820e104ddd582c623a187244be.jpg",Nt=n.p+"assets/images/bd83c313aa8e056443121a8c37f0224b.jpg",zt=n.p+"assets/images/722021527eb5e395acce71670983c5c5.jpg",Dt=n.p+"assets/images/bd6e368a42baffa99d8e2057e2e2ffda.jpg",Ft=n.p+"assets/images/78496f709b4e1900407b7e6c56dafc30.jpg";class Ut{constructor(e){this.gl=e,this.textureMap={},this.cargarTexturas()}cargarTexturas(){const{gl:e}=this;this.textureMap.UV={diffuse:new Et(e,yt),normal:new Et(e,wt)},this.textureMap.bloque={diffuse:new Et(e,Mt),normal:new Et(e,Pt),specular:new Et(e,Rt)},this.textureMap.moduloVioleta={diffuse:new Et(e,Ct),normal:new Et(e,At),specular:new Et(e,St)},this.textureMap.tierra={diffuse:new Et(e,It),normal:new Et(e,Vt),specular:new Et(e,Ot),clouds:new Et(e,Lt)},this.textureMap.luna={diffuse:new Et(e,kt),normal:new Et(e,Bt),specular:new Et(e,Nt)},this.textureMap.torus={diffuse:new Et(e,zt),normal:new Et(e,Dt),specular:new Et(e,Ft)}}}const jt=JSON.parse('{"diffuse":[1,1,1,1],"vertices":[-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,-0.5,0.5],"indices":[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],"scalars":[1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],"textureCoords":[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]}'),Ht=JSON.parse('{"vertices":[0.17101,0,0.469846,0.13835,0.100517,0.469846,0,0,0.5,0.052845,0.16264,0.469846,-0.052845,0.16264,0.469846,-0.13835,0.100517,0.469846,-0.17101,-1.49502e-8,0.469846,-0.13835,-0.100517,0.469846,-0.052845,-0.16264,0.469846,0.052845,-0.16264,0.469846,0.13835,-0.100517,0.469846,0.17101,0,-0.469846,0,0,-0.5,0.13835,0.100517,-0.469846,0.052845,0.16264,-0.469846,-0.052845,0.16264,-0.469846,-0.13835,0.100517,-0.469846,-0.17101,-1.49502e-8,-0.469846,-0.13835,-0.100517,-0.469846,-0.052845,-0.16264,-0.469846,0.052845,-0.16264,-0.469846,0.13835,-0.100517,-0.469846,0.321394,0,0.383022,0.260013,0.188911,0.383022,0.433013,0,0.25,0.350315,0.254518,0.25,0.492404,0,0.0868241,0.398363,0.289428,0.0868241,0.492404,0,-0.0868241,0.398363,0.289428,-0.0868241,0.433013,0,-0.25,0.350315,0.254518,-0.25,0.321394,0,-0.383022,0.260013,0.188911,-0.383022,0.0993161,0.305664,0.383022,0.133808,0.41182,0.25,0.152161,0.468304,0.0868241,0.152161,0.468304,-0.0868241,0.133808,0.41182,-0.25,0.0993161,0.305664,-0.383022,-0.0993162,0.305664,0.383022,-0.133808,0.41182,0.25,-0.152161,0.468304,0.0868241,-0.152161,0.468304,-0.0868241,-0.133808,0.41182,-0.25,-0.0993162,0.305664,-0.383022,-0.260013,0.188911,0.383022,-0.350315,0.254518,0.25,-0.398363,0.289428,0.0868241,-0.398363,0.289428,-0.0868241,-0.350315,0.254518,-0.25,-0.260013,0.18891,-0.383022,-0.321394,-2.80971e-8,0.383022,-0.433013,-3.78552e-8,0.25,-0.492404,-4.30473e-8,0.0868241,-0.492404,-4.30473e-8,-0.0868241,-0.433013,-3.78552e-8,-0.25,-0.321394,-2.80971e-8,-0.383022,-0.260013,-0.188911,0.383022,-0.350315,-0.254519,0.25,-0.398363,-0.289428,0.0868241,-0.398363,-0.289428,-0.0868241,-0.350315,-0.254519,-0.25,-0.260013,-0.188911,-0.383022,-0.0993161,-0.305664,0.383022,-0.133808,-0.41182,0.25,-0.152161,-0.468304,0.0868241,-0.152161,-0.468304,-0.0868241,-0.133808,-0.41182,-0.25,-0.0993161,-0.305664,-0.383022,0.0993162,-0.305664,0.383022,0.133808,-0.41182,0.25,0.152161,-0.468304,0.0868241,0.152161,-0.468304,-0.0868241,0.133808,-0.41182,-0.25,0.0993162,-0.305664,-0.383022,0.260013,-0.18891,0.383022,0.350315,-0.254518,0.25,0.398363,-0.289428,0.0868241,0.398363,-0.289428,-0.0868241,0.350315,-0.254518,-0.25,0.260013,-0.18891,-0.383022],"indices":[0,1,2,1,3,2,3,4,2,4,5,2,5,6,2,6,7,2,7,8,2,8,9,2,9,10,2,10,0,2,11,12,13,13,12,14,14,12,15,15,12,16,16,12,17,17,12,18,18,12,19,19,12,20,20,12,21,21,12,11,0,22,23,0,23,1,22,24,25,22,25,23,24,26,27,24,27,25,26,28,29,26,29,27,28,30,31,28,31,29,30,32,33,30,33,31,32,11,13,32,13,33,1,23,34,1,34,3,23,25,35,23,35,34,25,27,36,25,36,35,27,29,37,27,37,36,29,31,38,29,38,37,31,33,39,31,39,38,33,13,14,33,14,39,3,34,40,3,40,4,34,35,41,34,41,40,35,36,42,35,42,41,36,37,43,36,43,42,37,38,44,37,44,43,38,39,45,38,45,44,39,14,15,39,15,45,4,40,46,4,46,5,40,41,47,40,47,46,41,42,48,41,48,47,42,43,49,42,49,48,43,44,50,43,50,49,44,45,51,44,51,50,45,15,16,45,16,51,5,46,52,5,52,6,46,47,53,46,53,52,47,48,54,47,54,53,48,49,55,48,55,54,49,50,56,49,56,55,50,51,57,50,57,56,51,16,17,51,17,57,6,52,58,6,58,7,52,53,59,52,59,58,53,54,60,53,60,59,54,55,61,54,61,60,55,56,62,55,62,61,56,57,63,56,63,62,57,17,18,57,18,63,7,58,64,7,64,8,58,59,65,58,65,64,59,60,66,59,66,65,60,61,67,60,67,66,61,62,68,61,68,67,62,63,69,62,69,68,63,18,19,63,19,69,8,64,70,8,70,9,64,65,71,64,71,70,65,66,72,65,72,71,66,67,73,66,73,72,67,68,74,67,74,73,68,69,75,68,75,74,69,19,20,69,20,75,9,70,76,9,76,10,70,71,77,70,77,76,71,72,78,71,78,77,72,73,79,72,79,78,73,74,80,73,80,79,74,75,81,74,81,80,75,20,21,75,21,81,10,76,22,10,22,0,76,77,24,76,24,22,77,78,26,77,26,24,78,79,28,78,28,26,79,80,30,79,30,28,80,81,32,80,32,30,81,21,11,81,11,32],"ambient":[1,1,1,1],"diffuse":[1,1,1,1],"specular":[1,1,1,1]}');class Gt{constructor(e){this.gl=e,this.crearTextura()}crearTextura(){const e=this.gl;this.cubeTexture=e.createTexture(),e.bindTexture(e.TEXTURE_CUBE_MAP,this.cubeTexture),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR)}cargarTexturasCubemap(e){const{gl:t}=this;switch(e){case 0:n.e(985).then(n.bind(n,985)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_X,e.default)})),n.e(122).then(n.bind(n,122)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_X,e.default)})),n.e(840).then(n.bind(n,840)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_Y,e.default)})),n.e(634).then(n.bind(n,634)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.default)})),n.e(660).then(n.bind(n,660)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_Z,e.default)})),n.e(943).then(n.bind(n,943)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.default)}));break;case 1:n.e(670).then(n.bind(n,670)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_X,e.default)})),n.e(548).then(n.bind(n,548)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_X,e.default)})),n.e(895).then(n.bind(n,895)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_Y,e.default)})),n.e(172).then(n.bind(n,172)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.default)})),n.e(130).then(n.bind(n,130)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_Z,e.default)})),n.e(724).then(n.bind(n,724)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.default)}));break;case 2:n.e(103).then(n.bind(n,103)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_X,e.default)})),n.e(67).then(n.bind(n,67)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_X,e.default)})),n.e(804).then(n.bind(n,804)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_Y,e.default)})),n.e(624).then(n.bind(n,624)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.default)})),n.e(907).then(n.bind(n,907)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_POSITIVE_Z,e.default)})),n.e(954).then(n.bind(n,954)).then((e=>{this.loadCubemapFace(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.default)}))}}loadCubemapFace(e,t){const{gl:a,cubeTexture:n}=this,i=new Image;i.src=t,i.onload=()=>{a.bindTexture(a.TEXTURE_CUBE_MAP,n),a.texImage2D(e,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,i),a.bindTexture(a.TEXTURE_CUBE_MAP,null)}}}let Xt,Yt,qt,Kt,Qt,Wt,$t,Jt,Zt,ea,ta,aa,na,ia,oa,ra,sa,la,ua,ca,da,ha,pa,fa,ma=!0,ga=!1,_a=!0,ba=[],va=!0;function xa(){Xt.viewport(0,0,Xt.canvas.width,Xt.canvas.height),Xt.clear(Xt.COLOR_BUFFER_BIT|Xt.DEPTH_BUFFER_BIT),Qt.updatePerspective();try{Yt.traverse((e=>{if(e.hidden)return;Qt.calculateModelView(),Qt.push(),Wt.setAlias(e.alias),Xt.uniform1i(qt.uLightSource,!1);const t=ba.find((({id:t})=>e.alias===t));if(t){const{position:a,diffuse:n}=la.get(t.id);Re(Qt.modelViewMatrix,Qt.modelViewMatrix,a),e.diffuse=n,Xt.uniform1i(qt.uLightSource,!0)}if(Wt.esferaEscenario(),"light"===e.alias){const e=Qt.modelViewMatrix;Re(e,e,qt.getUniform(qt.uLightPosition)),Ie(e,e,[.5,.5,.5])}if("planoTest1"===e.alias){const e=Qt.modelViewMatrix;Re(e,e,[0,20,0]),Ve(e,e,Math.PI/2,[1,0,0])}else"cubeComplexTest"===e.alias&&Qt.modelViewMatrix;if("cubeMap"===e.alias){const e=Qt.modelViewMatrix,t=4096;Ie(e,e,[t,t,t]),Ve(e,e,Math.PI,[1,0,0])}"floor"!==e.alias&&"axis"!==e.alias&&(e.wireframe=ga),"nave"===e.alias&&(pt.naveTransform=Qt.modelViewMatrix,ta=[0,0,0],aa=[0,0,15.5],Zt.setFocus(ta,aa),!0===Zt.focusCamera.Nave?Kt.setFocus(ta):!0===Zt.focusCamera.PanelesSolares&&Kt.setFocus(aa)),Wt.luna(),Wt.tierra(),Wt.nucleoDelPanelSolar(),Wt.panelesSolares(),Wt.nucleoDelAnillo(),Wt.anillo(),Wt.bloques(),Wt.modulosVioleta(),Wt.esfera(),Wt.capsula(),Qt.setMatrixUniforms(),Qt.pop(),Xt.uniform3fv(qt.uLightPosition,la.getArray("position")),Xt.uniformMatrix4fv(qt.uViewMatrix,!1,Qt.modelViewMatrix),function(e){if(Xt.uniform4fv(qt.uMaterialDiffuse,e.diffuse),Xt.uniform4fv(qt.uMaterialSpecular,e.specular),Xt.uniform4fv(qt.uMaterialAmbient,e.ambient),Xt.uniform1i(qt.uWireframe,e.wireframe),Xt.bindVertexArray(e.vao),Xt.bindBuffer(Xt.ELEMENT_ARRAY_BUFFER,e.ibo),Xt.uniform1i(qt.uIsTheCubeMapShader,!1),Xt.uniform1i(qt.uHasTexture,!1),Xt.uniform1i(qt.uActivateEarthTextures,!1),Xt.uniform1i(qt.uActivateSpecularTexture,!1),"cubeMap"===e.alias)Xt.uniform1i(qt.uIsTheCubeMapShader,!0),Xt.activeTexture(Xt.TEXTURE0),Xt.bindTexture(Xt.TEXTURE_CUBE_MAP,ha.cubeTexture);else if(e.texture){Xt.uniform1i(qt.uHasTexture,!0);const t=da.textureMap[e.texture];Xt.activeTexture(Xt.TEXTURE1),Xt.bindTexture(Xt.TEXTURE_2D,t.diffuse.glTexture),Xt.activeTexture(Xt.TEXTURE2),Xt.bindTexture(Xt.TEXTURE_2D,t.normal.glTexture),"tierra"===e.alias&&(Xt.uniform1i(qt.uActivateEarthTextures,!0),Xt.activeTexture(Xt.TEXTURE3),Xt.bindTexture(Xt.TEXTURE_2D,t.clouds.glTexture)),t.specular&&(Xt.uniform1i(qt.uActivateSpecularTexture,_a),Xt.activeTexture(Xt.TEXTURE4),Xt.bindTexture(Xt.TEXTURE_2D,t.specular.glTexture))}if(e.wireframe)"floor"===e.alias||"axis"===e.alias?Xt.drawElements(Xt.LINES,e.indices.length,Xt.UNSIGNED_SHORT,0):(Xt.uniform4fv(qt.uMaterialDiffuse,je.RojoMetalico),Xt.drawElements(Xt.LINE_STRIP,e.indices.length,Xt.UNSIGNED_SHORT,0));else{const t=ma?Xt.TRIANGLE_STRIP:Xt.TRIANGLES;"cubeMap"===e.alias?Xt.drawElements(Xt.TRIANGLES,e.indices.length,Xt.UNSIGNED_SHORT,0):Xt.drawElements(t,e.indices.length,Xt.UNSIGNED_SHORT,0)}Xt.bindVertexArray(null),Xt.bindBuffer(Xt.ARRAY_BUFFER,null),Xt.bindBuffer(Xt.ELEMENT_ARRAY_BUFFER,null)}(e)})),ut.posicionBloque=0,ft.distanciaRelativaConElTuboPrincipal=3.5,ct.sentidoTuboInterior=1,ct.desplazamientoTuboInterior=0}catch(e){console.error(e)}}function Ta(){if(na=(new Date).getTime()-ia,na<30)return;let e=Math.floor(na/30);for(;e>0;)Wt.animarAnillo(.01),xa(),e-=1;ia=(new Date).getTime()}fa=30,window.onload=function(){!function(){const e=xe.getCanvas("webgl-canvas");xe.autoResizeCanvas(e),Xt=xe.getGLContext(e),Xt.clearColor(.9,.9,.9,1),Xt.clearDepth(100),Xt.enable(Xt.DEPTH_TEST),Xt.depthFunc(Xt.LEQUAL),qt=new Te(Xt,"vertex-shader","fragment-shader"),qt.load(["aVertexPosition","aVertexNormal","aVertexTangent","aVertexColor","aVertexTextureCoords"],["uProjectionMatrix","uViewMatrix","uModelViewMatrix","uNormalMatrix","uMaterialDiffuse","uMaterialAmbient","uMaterialSpecular","uLightAmbient","uLightDiffuse","uLightSpecular","uLightPosition","uLightDirection","uShininess","uWireframe","uAjuste","uHasTexture","uIsTheCubeMapShader","uSampler","uCloudSampler","uSpecularSampler","uActivateEarthTextures","uActivateSpecularTexture","uNormalSampler","uCubeSampler","uLightSource","uOuterCutOff","uLerpOuterCutOff","uLightRadius","uLightDecay","uMinLambertTerm","uLuzSolarEncendida"]),Yt=new Ee(Xt,qt),Kt=new De(De.ORBITING_TYPE,70,0),Kt.goTo([0,0,40],0,-30,[0,0,0]),ea=new lt([0,0,-10],Kt),ua=new Tt(Xt,qt),Zt=new Fe(Kt,e,ea,ua),Qt=new Ue(Xt,qt,Kt,e),$t=new st(i.anillo.radio,Yt),Wt=new bt(Qt,ea,Zt,Kt,$t,new Ze(300,30))}(),function(){ha=new Gt(Xt);let e=Math.floor(3*Math.random());Wt.tierraLunaEnElMundo(e),oa=xe.normalizeColor(je.sunLightColor[e]),la=new xt,ba=[{id:"sunLight",name:"Luz solar",position:i.lightPosition[e],diffuse:oa,direction:i.lightPosition[e]},{id:"greenLight",name:"Green Light",position:[0,10,5],diffuse:[0,1,0,1],direction:[0,-1,0]},{id:"blueLight",name:"Blue Light",position:[0,10,-5],diffuse:[0,0,1,1],direction:[0,-1,0]}],ba.forEach((({id:e,position:t,diffuse:a,direction:n})=>{const i=new vt(e);i.setPosition(t),i.setDiffuse(a),i.setProperty("direction",n),la.add(i)})),ua.esteEsElLightsArray(la.getArray("direction")),ca=ua.azimuth,pa=ua.elevation,ra=[.1,.1,.1,1],sa=[1,1,1,1],Xt.uniform3fv(qt.uLightPosition,la.getArray("position")),Xt.uniform3fv(qt.uLightDirection,la.getArray("direction")),Xt.uniform4fv(qt.uLightDiffuse,la.getArray("diffuse")),Xt.uniform4fv(qt.uLightAmbient,ra),Xt.uniform4fv(qt.uLightSpecular,sa),Xt.uniform1f(qt.uShininess,230),Xt.uniform1i(qt.uLuzSolarEncendida,!0),Xt.uniform1f(qt.uOuterCutOff,17.5),Xt.uniform1f(qt.uLerpOuterCutOff,.5),Xt.uniform1f(qt.uLightRadius,100),Xt.uniform1f(qt.uLightDecay,.5),Xt.uniform1f(qt.uMinLambertTerm,.1),ha.cargarTexturasCubemap(e),da=new Ut(Xt),Xt.uniform1i(qt.uCubeSampler,0),Xt.uniform1i(qt.uSampler,1),Xt.uniform1i(qt.uNormalSampler,2),Xt.uniform1i(qt.uCloudSampler,3),Xt.uniform1i(qt.uSpecularSampler,4)}(),Yt.add(jt,{alias:"cubeMap"}),ba.forEach((({id:e})=>{const t=Object.assign({},Ht);t.alias=e,Yt.add(t)})),Yt.add(new Ge(null,"nave")),function(){const e={filas:1,columnas:30},t=new Ge(null,"nucleoPS"),a=new Ye("nucleoPS_tubo",i.NucleoPS,e),n=new Xe("nucleoPS_cilindroSup",i.CilindroNucleoPS,e),o=new Xe("nucleoPS_cilindroInf",i.CilindroNucleoPS,e),r=new qe("nucleoPS_tapaSup",i.CilindroNucleoPS.radioSuperior,e),s=new qe("nucleoPS_tapaInf",i.CilindroNucleoPS.radioSuperior,e),l=i.CilindroNucleoPS.radioSuperior,u=i.CilindroNucleoPS.radioInferior-i.CilindroNucleoPS.radioSuperior,c=i.CilindroNucleoPS.altura,d=Math.sqrt(u*u+c*c),h=i.NucleoPS.altura,p=l+d+h+d+l,f=[];f.push(0,l/p,l/p,(l+d)/p,(l+d)/p,(l+d+h)/p,(l+d+h)/p,(l+d+h+d)/p,(l+d+h+d)/p,(l+d+h+d+l)/p);const m=[];for(let t=0;t<=e.columnas;t++)m.unshift(t/e.columnas);const g=[];for(let e=0;e<f.length;e++)for(let t=0;t<m.length;t++)4===e||5===e?g.push(1-m[t],f[e]):g.push(m[t],f[e]);const _=Ae(ye());Ve(_,_,Math.PI/2,[0,1,0]),Re(_,_,[0,i.NucleoPS.altura,0]);const b=Ae(ye());Ve(b,b,Math.PI/2,[0,1,0]);const v=Ae(ye());Re(v,v,[0,i.NucleoPS.altura+i.CilindroNucleoPS.altura,0]);const x=Ae(ye());Ve(x,x,-Math.PI/2,[0,1,0]),Ve(x,x,-Math.PI,[1,0,0]);const T=Ae(ye());Ve(T,T,Math.PI,[1,0,0]),Re(T,T,[0,i.CilindroNucleoPS.altura,0]);const E=Ae(ye());Ve(E,E,Math.PI,[1,0,0]);const y=Ae(ye()),w=xe.nuevasCoordenadas(y,a,!0),C=xe.nuevasCoordenadas(_,n,!0),A=xe.nuevasCoordenadas(b,n,!0);C.normales=A.normales,C.tangentes=A.tangentes;const S=xe.nuevasCoordenadas(v,r),M=xe.nuevasCoordenadas(x,o),P=xe.nuevasCoordenadas(T,s,!0),R=xe.nuevasCoordenadas(E,s,!0);P.normales=R.normales,P.tangentes=R.tangentes;const I=[];r.indices.forEach((e=>{I.push(e)}));const V=[];n.indices.forEach((e=>{V.push(e+I.length)}));const O=[];a.indices.forEach((e=>{O.push(e+V.length+I.length)}));const L=[];o.indices.forEach((e=>{L.push(e+O.length+V.length+I.length)}));const k=[];s.indices.forEach((e=>{k.push(e+L.length+O.length+V.length+I.length)})),t.indices.push(...I,61,62,...V,123,124,...O,185,186,...L,247,248,...k),t.vertices.push(...S.vertices,...C.vertices,...w.vertices,...M.vertices,...P.vertices),t.normales.push(...r.normales,...C.normales,...w.normales,...M.normales,...P.normales),t.tangentes.push(...r.tangentes,...C.tangentes,...w.tangentes,...M.tangentes,...P.tangentes),t.textureCoords.push(...g),t.diffuse=je.Textura.diffuse,t.ambient=je.Textura.ambient,t.texture="UV";const B=Object.assign({},t);B.alias="nucleoAnillo",Yt.add(t),Yt.add(B)}(),Jt=new et(Yt),Jt.cargarPanelesSolares(),function(){const e={filas:1,columnas:8},t={radioSuperior:2.3,radioInferior:i.pastillas.cuerpo.radio,altura:.1},a={filas:1,columnas:30};Yt.add(new Ye("pastillaCuerpo",i.pastillas.cuerpo,a),{diffuse:je.Pastilla}),Yt.add(new Xe("pastillaCilindroSup",t,a),{diffuse:je.Pastilla}),Yt.add(new Xe("pastillaCilindroInf",t,a),{diffuse:je.Pastilla}),Yt.add(new qe("pastillaTapaSup",t.radioSuperior,a),{diffuse:je.Pastilla}),Yt.add(new qe("pastillaTapaInf",t.radioSuperior,a),{diffuse:je.Pastilla}),function(){const e=30,t=80,a=e,n=i.anillo.radioInterior,o=xe.crearRecorridoCircular(n,1,a),r={puntos:o.puntos,normales:o.binormales.map((e=>[e[0],e[1]])),tangentes:o.tangentes.map((e=>[e[0],e[1]]))},s={filas:t,columnas:r.puntos.length-1},l=xe.crearRecorridoCircular(i.anillo.radio,1,s.filas),u=new rt("torus",r,l,s,!0),c=[];let d=[];const h=[];for(let t=0;t<=e;t++)h.push(t/e);const p=[];p.push(0);for(let e=0;e<=19;e++)for(let t=1;t<=4;t++)p.push(t/4+e);d.push(...p);for(let e=0;e<d.length;e++)for(let t=0;t<h.length;t++)c.push(d[e],h[t]);u.textureCoords.length!==c.length&&console.error("Distintas cantidades de texturas"),u.textureCoords=c;const f=xe.calcularTanYBiTan(u);u.tangentes=f.tangentes,u.diffuse=je.Textura.diffuse,u.ambient=je.Textura.ambient,u.texture="torus",Yt.add(u)}(),Yt.add(new Ye("anillo_tuboH1",i.anillo.tubo,e)),Yt.add(new Ye("anillo_tuboH2",i.anillo.tubo,e)),Yt.add(new Ye("anillo_tuboV1",i.anillo.tubo,e)),Yt.add(new Ye("anillo_tuboV2",i.anillo.tubo,e));const n=2*Math.ceil(i.anillo.tubo.altura/(2*i.anillo.distanciaEntreTubos));for(let t=0;t<n;t++)Yt.add(new Ye("anillo_tuboInterior",i.anillo.tuboInterior,e))}(),$t.setType(st.BLOQUES_4),function(){const e=new at([0,0],[.666,0],[1.333,0],[i.profundidadModuloVioleta,0]),t=new nt;t.iniciarEn(1,.5).CurvaBezierA(1,.8,.8,1,.5,1).lineaA(-.5,1).CurvaBezierA(-.8,1,-1,.8,-1,.5).lineaA(-1,-.5).CurvaBezierA(-1,-.8,-.8,-1,-.5,-1).lineaA(.5,-1).CurvaBezierA(.8,-1,1,-.8,1,-.5).lineaA(1,.5).curvaCerrada(!0);const a=xe.crearRecorrido(10,e),n=xe.crearForma(8,t);n.puntos.splice(9,0,[0,1]),n.puntos.splice(19,0,[-1,0]),n.puntos.splice(29,0,[0,-1]),n.puntos.splice(39,0,[1,0]),n.normales.splice(9,0,[0,1]),n.normales.splice(19,0,[-1,0]),n.normales.splice(29,0,[0,-1]),n.normales.splice(39,0,[1,0]),n.tangentes.splice(9,0,[-1,0]),n.tangentes.splice(19,0,[0,-1]),n.tangentes.splice(29,0,[1,0]),n.tangentes.splice(39,0,[0,1]);const o=[],r=[],s=[];for(let e=9;e<n.puntos.length-1;e++)o.push(n.puntos[e]),r.push(n.normales[e]),s.push(n.tangentes[e]);for(let e=0;e<9;e++)o.push(n.puntos[e]),r.push(n.normales[e]),s.push(n.tangentes[e]);o.push(o[0]),r.push(r[0]),s.push(s[0]),n.puntos=o,n.normales=r,n.tangentes=s;const l={filas:10,columnas:n.puntos.length-1};let u=0,c=[],d=[];for(let e=0;e<n.puntos.length-1;e++){const t=n.puntos[e],a=n.puntos[e+1],i=Math.sqrt(Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2));c.push(i),u+=i}let h=0;d.push(0),c.map((e=>{h+=e,d.push(h/(u/4))}));const p=[];for(let e=0;e<l.columnas;e++)p.push(e/l.filas);const f=[];for(let e=0;e<p.length;e++)for(let t=0;t<d.length;t++)f.push(1-d[t],p[e]);const m=new rt("moduloVioletaPS",n,a,l),g=xe.calcularTanYBiTan(m);m.tangentes=g.tangentes,m.textureCoords=f,m.diffuse=je.Textura.diffuse,m.ambient=je.Textura.ambient,m.texture="moduloVioleta";const _=Object.assign({},m);_.alias="moduloVioletaAnillo",Yt.add(m),Yt.add(_)}(),function(){const e=mt.radio,t=xe.crearRecorridoCircular(e,2/8,20),a=mt.angulo,n={puntos:t.puntos.map((e=>[e[0]*Math.cos(a)-e[1]*Math.sin(a),e[0]*Math.sin(a)+e[1]*Math.cos(a)])),normales:t.binormales.map((e=>[e[0]*Math.cos(a)-e[1]*Math.sin(a),e[0]*Math.sin(a)+e[1]*Math.cos(a)])),tangentes:t.tangentes.map((e=>[e[0]*Math.cos(a)-e[1]*Math.sin(a),e[0]*Math.sin(a)+e[1]*Math.cos(a)]))},i=n.puntos.length-1,o={filas:30,columnas:i},r=xe.crearRecorridoCircular(0,1,o.filas),s=new Ge(null,"esfera"),l=new rt("esfera_cuerpo",n,r,o,!0),u=new qe("esfera_TapaAtras",e*Math.sin(a),{filas:1,columnas:30}),c=new qe("esfera_TapaAdelante",e*Math.sin(a),{filas:1,columnas:30}),d=Ae(ye());Ve(d,d,Math.PI/2,[1,0,0]);const h=Ae(ye());Re(h,h,[0,0,mt.radio*Math.cos(mt.angulo)]),Pe(h,h,d);const p=xe.calcularTanYBiTan(c);c.tangentes=p.tangentes;const f=xe.nuevasCoordenadas(d,c,!1),m=xe.nuevasCoordenadas(h,c,!1);m.normales=f.normales,m.tangentes=f.tangentes;const g=Ae(ye());Ve(g,g,-Math.PI/2,[1,0,0]);const _=Ae(ye());Re(_,_,[0,0,-mt.radio*Math.cos(mt.angulo)]),Pe(_,_,g);const b=xe.calcularTanYBiTan(u);u.tangentes=b.tangentes;const v=xe.nuevasCoordenadas(g,u,!0),x=xe.nuevasCoordenadas(_,u,!0);x.normales=v.normales,x.tangentes=v.tangentes;const{columna1:T,_:E}=xe.I2(c.textureCoords,"noImprimir"),y=T.slice(0,-31),w=[];w.push(0,.2);const C=[];for(let e=0;e<w.length;e++)for(let t=0;t<y.length;t++)C.push(1-y[t],w[e]);const A=[],S=[];A.push(.8,1);for(let e=0;e<A.length;e++)for(let t=0;t<y.length;t++)S.push(1-y[t],A[e]);const M=[],P=[],R=.6/i;for(let e=0;e<=i;e++)P.push(.2+R*e);for(let e=0;e<y.length;e++)for(let t=0;t<P.length;t++)M.push(y[e],P[t]);const I=[],V=[];l.indices.forEach((e=>{I.push(e+c.indices[c.indices.length-1]+1)})),u.indices.forEach((e=>{V.push(e+I[I.length-1]+1)})),s.indices.push(...c.indices,61,62,...I,712,713,...V),s.vertices.push(...m.vertices,...l.vertices,...x.vertices),s.normales.push(...m.normales,...l.normales,...x.normales),s.textureCoords.push(...C,...M,...S);const O=xe.calcularTanYBiTan(l);s.tangentes.push(...m.tangentes,...O.tangentes,...x.tangentes),s.diffuse=je.Textura.diffuse,s.ambient=je.Textura.ambient,s.texture="UV",Yt.add(s)}(),function(){const e=[[247,144/255,0,1],[247,90/255,0,1],[247,19/255,0,1]],t={filas:1,columnas:30},a=new Ge(null,"capsula");Yt.add(a),ht.curvaColav0x=-1.99;const n=new at([ht.curvaColav0x,.78],[-1.2,.785],[-.66,.52],[-.14,.18]).extraerPuntos(10),i={puntos:n.puntos,normales:n.puntosTangentes.map((e=>[-e[1],e[0]]))},o={filas:30,columnas:i.puntos.length-1},r=xe.crearRecorridoCircular(0,1,o.filas),s=new ot("capsulaCola",i,r,o,!0);Yt.add(s,{diffuse:e[1]});const l=new Xe("capsulaFuegoCola",{radioSuperior:.78,radioInferior:.05,altura:.5},t,!0);Yt.add(l,{diffuse:e[2]});const u=new at([.3,1.5],[1.185,1.44],[1.844,1.185],[2.5,.7]).extraerPuntos(10),c={puntos:u.puntos,normales:u.puntosTangentes.map((e=>[-e[1],e[0]]))},d=c.puntos.length-1,h=new ot("capsulaCuerpoBezierA",c,r,{filas:30,columnas:d},!0);Yt.add(h),ht.CilAaltura=.1;const p=new Xe("capsulaCuerpoCilindroA",{radioSuperior:.4,radioInferior:1.2,altura:ht.CilAaltura},t);Yt.add(p);const f=new Xe("capsulaCuerpoCilindroB",{radioSuperior:1.2,radioInferior:1.5,altura:.2},t);Yt.add(f);const m=new Xe("capsulaCuerpoCilindroC",{radioSuperior:.7,radioInferior:.6,altura:.01},t);Yt.add(m);const g=new Xe("capsulaCuerpoCilindroD",{radioSuperior:.6,radioInferior:.4,altura:2.9-2.51},t);Yt.add(g,{diffuse:je.RojoMetalico});const _=new Xe("capsulaCuerpoCilindroE",{radioSuperior:.4,radioInferior:0,altura:.001},t);Yt.add(_),ht.FuegoCuerpoAltura=.5;const b=new Xe("capsulaFuegoCuerpo",{radioSuperior:1.2,radioInferior:.05,altura:ht.FuegoCuerpoAltura},t,!0);Yt.add(b,{diffuse:e[0]})}(),function(){const e=xe.crearRecorridoCircular(345,.5,50),t={puntos:e.puntos,normales:e.binormales.map((e=>[e[0],e[1]])),tangentes:e.tangentes.map((e=>[e[0],e[1]]))},a={filas:50,columnas:t.puntos.length-1},n=xe.crearRecorridoCircular(0,1,a.filas),i=new rt("luna",t,n,a,!0),o=xe.calcularTanYBiTan(i);i.tangentes=o.tangentes,i.diffuse=je.Textura.diffuse,i.ambient=je.Textura.ambient,i.texture="luna",Yt.add(i)}(),function(){const e=xe.crearRecorridoCircular(1405,.5,50),t={puntos:e.puntos,normales:e.binormales.map((e=>[e[0],e[1]])),tangentes:e.tangentes.map((e=>[e[0],e[1]]))},a={filas:50,columnas:t.puntos.length-1},n=xe.crearRecorridoCircular(0,1,a.filas),i=new rt("tierra",t,n,a,!0),o=xe.calcularTanYBiTan(i);i.tangentes=o.tangentes,i.diffuse=je.Textura.diffuse,i.ambient=[.1,.1,.1,1],i.texture="tierra",Yt.add(i)}(),ia=(new Date).getTime(),setInterval(Ta,.03),xe.configureControls({Bloques:{value:$t.type,options:[st.BLOQUES_4,st.BLOQUES_5,st.BLOQUES_6,st.BLOQUES_7,st.BLOQUES_8],onChange:e=>{$t.setType(e)}},PanelesSolares:{Filas:{value:Jt.cantidadDeFilas,min:1,max:10,step:1,onChange:e=>{Jt.removerPanelesSolares(),Jt.cantidadDeFilas=e,Jt.cambiarAlturaDelTuboPrincipal(),Jt.cargarPanelesSolares()}},Angulo:{value:Wt.panelSolar.anguloRotacion,min:0,max:360,step:1,onChange:e=>Wt.panelSolar.anguloRotacion=e},AnimarPaneles:{value:Wt.panelSolar.animar,onChange:e=>Wt.panelSolar.animar=e}},...ba.reduce(((e,t)=>{const a=[`X - ${t.name}`,`Y - ${t.name}`,`Z - ${t.name}`];return e[t.name]=a.reduce(((e,n,i)=>(e[n]={value:t.position[i],min:-30,max:30,step:.1,onChange:(e,n)=>{la.get(t.id).position=a.map((e=>n[e]))}},e)),{}),e}),{}),Penumbra:{value:.5,min:0,max:1,step:.01,onChange:e=>Xt.uniform1f(qt.uLerpOuterCutOff,e)},Angulo:{value:17.5,min:0,max:60,step:.1,onChange:e=>Xt.uniform1f(qt.uOuterCutOff,e)},LuzDistancia:{value:5,min:.01,max:10,step:1,onChange:e=>Xt.uniform1f(qt.uLightRadius,20*e)},Decay:{value:.5,min:.01,max:1,step:.001,onChange:e=>{Xt.uniform1f(qt.uLightDecay,e)}},azimuth:{value:ca,min:-0,max:360,step:1,onChange:e=>{ua.cambiarAzimuth(null,e)}},elevation:{value:pa,min:-0,max:360,step:1,onChange:e=>{ua.cambiarElevation(null,e)}},"Light Ambient Term":{value:ra[0],min:0,max:1,step:.01,onChange:e=>Xt.uniform4fv(qt.uLightAmbient,[e,e,e,1])},"Light Specular Term":{value:sa[0],min:0,max:1,step:.01,onChange:e=>Xt.uniform4fv(qt.uLightSpecular,[e,e,e,1])},MinLambertTerm:{value:.1,min:0,max:.25,step:.01,onChange:e=>Xt.uniform1f(qt.uMinLambertTerm,e)},LuzSolar:{value:true,onChange:e=>{Xt.uniform1i(qt.uLuzSolarEncendida,e)}},CubeMap:{value:va,onChange:e=>{va=e,jt.hidden=!e}},SpecularMap:{value:_a,onChange:e=>{_a=e}},Wireframe:()=>{ga=!ga},"Triangle Strip":{value:ma,onChange:e=>ma=e}},{closed:!1})}})();
//# sourceMappingURL=bundle.8136aa2b5c59ee2ac5fd.js.map