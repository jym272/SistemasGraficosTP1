(()=>{"use strict";function e(e,t){var i=e.__state.conversionName.toString(),o=Math.round(e.r),a=Math.round(e.g),n=Math.round(e.b),s=e.a,r=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===i?"rgb("+o+","+a+","+n+")":"CSS_RGBA"===i?"rgba("+o+","+a+","+n+","+s+")":"HEX"===i?"0x"+e.hex.toString(16):"RGB_ARRAY"===i?"["+o+","+a+","+n+"]":"RGBA_ARRAY"===i?"["+o+","+a+","+n+","+s+"]":"RGB_OBJ"===i?"{r:"+o+",g:"+a+",b:"+n+"}":"RGBA_OBJ"===i?"{r:"+o+",g:"+a+",b:"+n+",a:"+s+"}":"HSV_OBJ"===i?"{h:"+r+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===i?"{h:"+r+",s:"+l+",v:"+u+",a:"+s+"}":"unknown format"}var t=Array.prototype.forEach,i=Array.prototype.slice,o={BREAK:{},extend:function(e){return this.each(i.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(i){this.isUndefined(t[i])||(e[i]=t[i])}.bind(this))}),this),e},defaults:function(e){return this.each(i.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(i){this.isUndefined(e[i])&&(e[i]=t[i])}.bind(this))}),this),e},compose:function(){var e=i.call(arguments);return function(){for(var t=i.call(arguments),o=e.length-1;o>=0;o--)t=[e[o].apply(this,t)];return t[0]}},each:function(e,i,o){if(e)if(t&&e.forEach&&e.forEach===t)e.forEach(i,o);else if(e.length===e.length+0){var a,n=void 0;for(n=0,a=e.length;n<a;n++)if(n in e&&i.call(o,e[n],n)===this.BREAK)return}else for(var s in e)if(i.call(o,e[s],s)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var o=void 0;return function(){var a=this,n=arguments;function s(){o=null,i||e.apply(a,n)}var r=i||!o;clearTimeout(o),o=setTimeout(s,t),r&&e.apply(a,n)}},toArray:function(e){return e.toArray?e.toArray():i.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},a=[{litmus:o.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:o.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:o.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:o.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(o.isNumber(e.r)&&o.isNumber(e.g)&&o.isNumber(e.b)&&o.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(o.isNumber(e.r)&&o.isNumber(e.g)&&o.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(o.isNumber(e.h)&&o.isNumber(e.s)&&o.isNumber(e.v)&&o.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(o.isNumber(e.h)&&o.isNumber(e.s)&&o.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],n=void 0,s=void 0,r=function(){s=!1;var e=arguments.length>1?o.toArray(arguments):arguments[0];return o.each(a,(function(t){if(t.litmus(e))return o.each(t.conversions,(function(t,i){if(n=t.read(e),!1===s&&!1!==n)return s=n,n.conversionName=i,n.conversion=t,o.BREAK})),o.BREAK})),s},l=void 0,u={hsv_to_rgb:function(e,t,i){var o=Math.floor(e/60)%6,a=e/60-Math.floor(e/60),n=i*(1-t),s=i*(1-a*t),r=i*(1-(1-a)*t),l=[[i,r,n],[s,i,n],[n,i,r],[n,s,i],[r,n,i],[i,n,s]][o];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,i){var o=Math.min(e,t,i),a=Math.max(e,t,i),n=a-o,s=void 0;return 0===a?{h:NaN,s:0,v:0}:(s=e===a?(t-i)/n:t===a?2+(i-e)/n:4+(e-t)/n,(s/=6)<0&&(s+=1),{h:360*s,s:n/a,v:a/255})},rgb_to_hex:function(e,t,i){var o=this.hex_with_component(0,2,e);return o=this.hex_with_component(o,1,t),this.hex_with_component(o,0,i)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,i){return i<<(l=8*t)|e&~(255<<l)}},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),f=function e(t,i,o){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,i,o)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(o):void 0},p=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},_=function(){function t(){if(d(this,t),this.__state=r.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return h(t,[{key:"toString",value:function(){return e(this)}},{key:"toHexString",value:function(){return e(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function g(e,t,i){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||_.recalculateRGB(this,t,i),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(_.recalculateRGB(this,t,i),this.__state.space="RGB"),this.__state[t]=e}})}function b(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||_.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(_.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}_.recalculateRGB=function(e,t,i){if("HEX"===e.__state.space)e.__state[t]=u.component_from_hex(e.__state.hex,i);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");o.extend(e.__state,u.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},_.recalculateHSV=function(e){var t=u.rgb_to_hsv(e.r,e.g,e.b);o.extend(e.__state,{s:t.s,v:t.v}),o.isNaN(t.h)?o.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},_.COMPONENTS=["r","g","b","h","s","v","hex","a"],g(_.prototype,"r",2),g(_.prototype,"g",1),g(_.prototype,"b",0),b(_.prototype,"h"),b(_.prototype,"s"),b(_.prototype,"v"),Object.defineProperty(_.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(_.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=u.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var v=function(){function e(t,i){d(this,e),this.initialValue=t[i],this.domElement=document.createElement("div"),this.object=t,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return h(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),w={};o.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){o.each(e,(function(e){w[e]=t}))}));var x=/(\d+(\.\d+)?)px/;function y(e){if("0"===e||o.isUndefined(e))return 0;var t=e.match(x);return o.isNull(t)?0:parseFloat(t[1])}var T={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var a=i,n=t;o.isUndefined(n)&&(n=!0),o.isUndefined(a)&&(a=!0),e.style.position="absolute",n&&(e.style.left=0,e.style.right=0),a&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,a){var n=i||{},s=w[t];if(!s)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(s);switch(s){case"MouseEvents":var l=n.x||n.clientX||0,u=n.y||n.clientY||0;r.initMouseEvent(t,n.bubbles||!1,n.cancelable||!0,window,n.clickCount||1,0,0,l,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=r.initKeyboardEvent||r.initKeyEvent;o.defaults(n,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,n.bubbles||!1,n.cancelable,window,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode);break;default:r.initEvent(t,n.bubbles||!1,n.cancelable||!0)}o.defaults(r,a),e.dispatchEvent(r)},bind:function(e,t,i,o){var a=o||!1;return e.addEventListener?e.addEventListener(t,i,a):e.attachEvent&&e.attachEvent("on"+t,i),T},unbind:function(e,t,i,o){var a=o||!1;return e.removeEventListener?e.removeEventListener(t,i,a):e.detachEvent&&e.detachEvent("on"+t,i),T},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);-1===i.indexOf(t)&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return T},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),o=i.indexOf(t);-1!==o&&(i.splice(o,1),e.className=i.join(" "))}else e.className=void 0;return T},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return y(t["border-left-width"])+y(t["border-right-width"])+y(t["padding-left"])+y(t["padding-right"])+y(t.width)},getHeight:function(e){var t=getComputedStyle(e);return y(t["border-top-width"])+y(t["border-bottom-width"])+y(t["padding-top"])+y(t["padding-bottom"])+y(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do{i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent}while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},A=function(e){function t(e,i){d(this,t);var o=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=o;return o.__prev=o.getValue(),o.__checkbox=document.createElement("input"),o.__checkbox.setAttribute("type","checkbox"),T.bind(o.__checkbox,"change",(function(){a.setValue(!a.__prev)}),!1),o.domElement.appendChild(o.__checkbox),o.updateDisplay(),o}return p(t,e),h(t,[{key:"setValue",value:function(e){var i=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(v),E=function(e){function t(e,i,a){d(this,t);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),s=a,r=n;if(n.__select=document.createElement("select"),o.isArray(s)){var l={};o.each(s,(function(e){l[e]=e})),s=l}return o.each(s,(function(e,t){var i=document.createElement("option");i.innerHTML=t,i.setAttribute("value",e),r.__select.appendChild(i)})),n.updateDisplay(),T.bind(n.__select,"change",(function(){var e=this.options[this.selectedIndex].value;r.setValue(e)})),n.domElement.appendChild(n.__select),n}return p(t,e),h(t,[{key:"setValue",value:function(e){var i=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return T.isActive(this.__select)?this:(this.__select.value=this.getValue(),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(v),C=function(e){function t(e,i){d(this,t);var o=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=o;function n(){a.setValue(a.__input.value)}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),T.bind(o.__input,"keyup",n),T.bind(o.__input,"change",n),T.bind(o.__input,"blur",(function(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())})),T.bind(o.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return p(t,e),h(t,[{key:"updateDisplay",value:function(){return T.isActive(this.__input)||(this.__input.value=this.getValue()),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(v);function M(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var S=function(e){function t(e,i,a){d(this,t);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),s=a||{};return n.__min=s.min,n.__max=s.max,n.__step=s.step,o.isUndefined(n.__step)?0===n.initialValue?n.__impliedStep=1:n.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(n.initialValue))/Math.LN10))/10:n.__impliedStep=n.__step,n.__precision=M(n.__impliedStep),n}return p(t,e),h(t,[{key:"setValue",value:function(e){var i=e;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=M(e),this}}]),t}(v),P=function(e){function t(e,i,a){d(this,t);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,a));n.__truncationSuspended=!1;var s=n,r=void 0;function l(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function u(e){var t=r-e.clientY;s.setValue(s.getValue()+t*s.__impliedStep),r=e.clientY}function c(){T.unbind(window,"mousemove",u),T.unbind(window,"mouseup",c),l()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),T.bind(n.__input,"change",(function(){var e=parseFloat(s.__input.value);o.isNaN(e)||s.setValue(e)})),T.bind(n.__input,"blur",(function(){l()})),T.bind(n.__input,"mousedown",(function(e){T.bind(window,"mousemove",u),T.bind(window,"mouseup",c),r=e.clientY})),T.bind(n.__input,"keydown",(function(e){13===e.keyCode&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1,l())})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return p(t,e),h(t,[{key:"updateDisplay",value:function(){var e,i,o;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),i=this.__precision,o=Math.pow(10,i),Math.round(e*o)/o),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(S);function O(e,t,i,o,a){return o+(e-t)/(i-t)*(a-o)}var I=function(e){function t(e,i,o,a,n){d(this,t);var s=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,{min:o,max:a,step:n})),r=s;function l(e){e.preventDefault();var t=r.__background.getBoundingClientRect();return r.setValue(O(e.clientX,t.left,t.right,r.__min,r.__max)),!1}function u(){T.unbind(window,"mousemove",l),T.unbind(window,"mouseup",u),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function c(e){var t=e.touches[0].clientX,i=r.__background.getBoundingClientRect();r.setValue(O(t,i.left,i.right,r.__min,r.__max))}function h(){T.unbind(window,"touchmove",c),T.unbind(window,"touchend",h),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),T.bind(s.__background,"mousedown",(function(e){document.activeElement.blur(),T.bind(window,"mousemove",l),T.bind(window,"mouseup",u),l(e)})),T.bind(s.__background,"touchstart",(function(e){1===e.touches.length&&(T.bind(window,"touchmove",c),T.bind(window,"touchend",h),c(e))})),T.addClass(s.__background,"slider"),T.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return p(t,e),h(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(S),V=function(e){function t(e,i,o){d(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),n=a;return a.__button=document.createElement("div"),a.__button.innerHTML=void 0===o?"Fire":o,T.bind(a.__button,"click",(function(e){return e.preventDefault(),n.fire(),!1})),T.addClass(a.__button,"button"),a.domElement.appendChild(a.__button),a}return p(t,e),h(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(v),k=function(e){function t(e,i){d(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));a.__color=new _(a.getValue()),a.__temp=new _(0);var n=a;a.domElement=document.createElement("div"),T.makeSelectable(a.domElement,!1),a.__selector=document.createElement("div"),a.__selector.className="selector",a.__saturation_field=document.createElement("div"),a.__saturation_field.className="saturation-field",a.__field_knob=document.createElement("div"),a.__field_knob.className="field-knob",a.__field_knob_border="2px solid ",a.__hue_knob=document.createElement("div"),a.__hue_knob.className="hue-knob",a.__hue_field=document.createElement("div"),a.__hue_field.className="hue-field",a.__input=document.createElement("input"),a.__input.type="text",a.__input_textShadow="0 1px 1px ",T.bind(a.__input,"keydown",(function(e){13===e.keyCode&&p.call(this)})),T.bind(a.__input,"blur",p),T.bind(a.__selector,"mousedown",(function(){T.addClass(this,"drag").bind(window,"mouseup",(function(){T.removeClass(n.__selector,"drag")}))})),T.bind(a.__selector,"touchstart",(function(){T.addClass(this,"drag").bind(window,"touchend",(function(){T.removeClass(n.__selector,"drag")}))}));var s,l=document.createElement("div");function u(e){b(e),T.bind(window,"mousemove",b),T.bind(window,"touchmove",b),T.bind(window,"mouseup",h),T.bind(window,"touchend",h)}function c(e){v(e),T.bind(window,"mousemove",v),T.bind(window,"touchmove",v),T.bind(window,"mouseup",f),T.bind(window,"touchend",f)}function h(){T.unbind(window,"mousemove",b),T.unbind(window,"touchmove",b),T.unbind(window,"mouseup",h),T.unbind(window,"touchend",h),g()}function f(){T.unbind(window,"mousemove",v),T.unbind(window,"touchmove",v),T.unbind(window,"mouseup",f),T.unbind(window,"touchend",f),g()}function p(){var e=r(this.value);!1!==e?(n.__color.__state=e,n.setValue(n.__color.toOriginal())):this.value=n.__color.toString()}function g(){n.__onFinishChange&&n.__onFinishChange.call(n,n.__color.toOriginal())}function b(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__saturation_field.getBoundingClientRect(),i=e.touches&&e.touches[0]||e,o=i.clientX,a=i.clientY,s=(o-t.left)/(t.right-t.left),r=1-(a-t.top)/(t.bottom-t.top);return r>1?r=1:r<0&&(r=0),s>1?s=1:s<0&&(s=0),n.__color.v=r,n.__color.s=s,n.setValue(n.__color.toOriginal()),!1}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__hue_field.getBoundingClientRect(),i=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return i>1?i=1:i<0&&(i=0),n.__color.h=360*i,n.setValue(n.__color.toOriginal()),!1}return o.extend(a.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),o.extend(a.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:a.__field_knob_border+(a.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),o.extend(a.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),o.extend(a.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),o.extend(l.style,{width:"100%",height:"100%",background:"none"}),L(l,"top","rgba(0,0,0,0)","#000"),o.extend(a.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(s=a.__hue_field).style.background="",s.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",s.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.extend(a.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:a.__input_textShadow+"rgba(0,0,0,0.7)"}),T.bind(a.__saturation_field,"mousedown",u),T.bind(a.__saturation_field,"touchstart",u),T.bind(a.__field_knob,"mousedown",u),T.bind(a.__field_knob,"touchstart",u),T.bind(a.__hue_field,"mousedown",c),T.bind(a.__hue_field,"touchstart",c),a.__saturation_field.appendChild(l),a.__selector.appendChild(a.__field_knob),a.__selector.appendChild(a.__saturation_field),a.__selector.appendChild(a.__hue_field),a.__hue_field.appendChild(a.__hue_knob),a.domElement.appendChild(a.__input),a.domElement.appendChild(a.__selector),a.updateDisplay(),a}return p(t,e),h(t,[{key:"updateDisplay",value:function(){var e=r(this.getValue());if(!1!==e){var t=!1;o.each(_.COMPONENTS,(function(i){if(!o.isUndefined(e[i])&&!o.isUndefined(this.__color.__state[i])&&e[i]!==this.__color.__state[i])return t=!0,{}}),this),t&&o.extend(this.__color.__state,e)}o.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,a=255-i;o.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,L(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),o.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),t}(v),R=["-moz-","-o-","-webkit-","-ms-",""];function L(e,t,i,a){e.style.background="",o.each(R,(function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+i+" 0%, "+a+" 100%); "}))}var B='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',F=function(e,t){var i=e[t];return o.isArray(arguments[2])||o.isObject(arguments[2])?new E(e,t,arguments[2]):o.isNumber(i)?o.isNumber(arguments[2])&&o.isNumber(arguments[3])?o.isNumber(arguments[4])?new I(e,t,arguments[2],arguments[3],arguments[4]):new I(e,t,arguments[2],arguments[3]):o.isNumber(arguments[4])?new P(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new P(e,t,{min:arguments[2],max:arguments[3]}):o.isString(i)?new C(e,t):o.isFunction(i)?new V(e,t,""):o.isBoolean(i)?new A(e,t):null},N=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},D=function(){function e(){d(this,e),this.backgroundElement=document.createElement("div"),o.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),T.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),o.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;T.bind(this.backgroundElement,"click",(function(){t.hide()}))}return h(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),o.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",T.unbind(e.domElement,"webkitTransitionEnd",t),T.unbind(e.domElement,"transitionend",t),T.unbind(e.domElement,"oTransitionEnd",t)};T.bind(this.domElement,"webkitTransitionEnd",t),T.bind(this.domElement,"transitionend",t),T.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-T.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-T.getHeight(this.domElement)/2+"px"}}]),e}();!function(e,t){var i=t||document,o=document.createElement("style");o.type="text/css",o.innerHTML=e;var a=i.getElementsByTagName("head")[0];try{a.appendChild(o)}catch(e){}}(function(e){if("undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var z="Default",U=function(){try{return!!window.localStorage}catch(e){return!1}}(),q=void 0,j=!0,H=void 0,G=!1,Y=[],Q=function e(t){var i=this,a=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),T.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=o.defaults(a,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),a=o.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),o.isUndefined(a.load)?a.load={preset:z}:a.preset&&(a.load.preset=a.preset),o.isUndefined(a.parent)&&a.hideable&&Y.push(this),a.resizable=o.isUndefined(a.parent)&&a.resizable,a.autoPlace&&o.isUndefined(a.scrollable)&&(a.scrollable=!0);var n,s=U&&"true"===localStorage.getItem(Z(0,"isLocal")),r=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:a.load.preset},set:function(e){i.parent?i.getRoot().preset=e:a.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),i.revert()}},width:{get:function(){return a.width},set:function(e){a.width=e,ae(i,e)}},name:{get:function(){return a.name},set:function(e){a.name=e,l&&(l.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(t){a.closed=t,a.closed?T.addClass(i.__ul,e.CLASS_CLOSED):T.removeClass(i.__ul,e.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return s},set:function(e){U&&(s=e,e?T.bind(window,"unload",r):T.unbind(window,"unload",r),localStorage.setItem(Z(0,"isLocal"),e))}}}),o.isUndefined(a.parent)){if(this.closed=a.closed||!1,T.addClass(this.domElement,e.CLASS_MAIN),T.makeSelectable(this.domElement,!1),U&&s){i.useLocalStorage=!0;var u=localStorage.getItem(Z(0,"gui"));u&&(a.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,T.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),a.closeOnTop?(T.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(T.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),T.bind(this.__closeButton,"click",(function(){i.closed=!i.closed}))}else{void 0===a.closed&&(a.closed=!0);var c=document.createTextNode(a.name);T.addClass(c,"controller-name"),l=X(i,c),T.addClass(this.__ul,e.CLASS_CLOSED),T.addClass(l,"title"),T.bind(l,"click",(function(e){return e.preventDefault(),i.closed=!i.closed,!1})),a.closed||(this.closed=!1)}a.autoPlace&&(o.isUndefined(a.parent)&&(j&&(H=document.createElement("div"),T.addClass(H,"dg"),T.addClass(H,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(H),j=!1),H.appendChild(this.domElement),T.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ae(i,a.width)),this.__resizeHandler=function(){i.onResizeDebounced()},T.bind(window,"resize",this.__resizeHandler),T.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),T.bind(this.__ul,"transitionend",this.__resizeHandler),T.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),a.resizable&&oe(this),r=function(){U&&"true"===localStorage.getItem(Z(0,"isLocal"))&&localStorage.setItem(Z(0,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=r,a.parent||((n=i.getRoot()).width+=1,o.defer((function(){n.width-=1})))};function X(e,t,i){var o=document.createElement("li");return t&&o.appendChild(t),i?e.__ul.insertBefore(o,i):e.__ul.appendChild(o),e.onResize(),o}function K(e){T.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&T.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function W(e,t){var i=e.__preset_select[e.__preset_select.selectedIndex];i.innerHTML=t?i.value+"*":i.value}function J(e,t){var i=e.getRoot(),o=i.__rememberedObjects.indexOf(t.object);if(-1!==o){var a=i.__rememberedObjectIndecesToControllers[o];if(void 0===a&&(a={},i.__rememberedObjectIndecesToControllers[o]=a),a[t.property]=t,i.load&&i.load.remembered){var n=i.load.remembered,s=void 0;if(n[e.preset])s=n[e.preset];else{if(!n.Default)return;s=n.Default}if(s[o]&&void 0!==s[o][t.property]){var r=s[o][t.property];t.initialValue=r,t.setValue(r)}}}}function $(e,t,i,a){if(void 0===t[i])throw new Error('Object "'+t+'" has no property "'+i+'"');var n=void 0;if(a.color)n=new k(t,i);else{var s=[t,i].concat(a.factoryArgs);n=F.apply(e,s)}a.before instanceof v&&(a.before=a.before.__li),J(e,n),T.addClass(n.domElement,"c");var r=document.createElement("span");T.addClass(r,"property-name"),r.innerHTML=n.property;var l=document.createElement("div");l.appendChild(r),l.appendChild(n.domElement);var u=X(e,l,a.before);return T.addClass(u,Q.CLASS_CONTROLLER_ROW),n instanceof k?T.addClass(u,"color"):T.addClass(u,c(n.getValue())),function(e,t,i){if(i.__li=t,i.__gui=e,o.extend(i,{options:function(t){if(arguments.length>1){var a=i.__li.nextElementSibling;return i.remove(),$(e,i.object,i.property,{before:a,factoryArgs:[o.toArray(arguments)]})}if(o.isArray(t)||o.isObject(t)){var n=i.__li.nextElementSibling;return i.remove(),$(e,i.object,i.property,{before:n,factoryArgs:[t]})}},name:function(e){return i.__li.firstElementChild.firstElementChild.innerHTML=e,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof I){var a=new P(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});o.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=i[e],o=a[e];i[e]=a[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(a,e),t.apply(i,e)}})),T.addClass(t,"has-slider"),i.domElement.insertBefore(a.domElement,i.domElement.firstElementChild)}else if(i instanceof P){var n=function(t){if(o.isNumber(i.__min)&&o.isNumber(i.__max)){var a=i.__li.firstElementChild.firstElementChild.innerHTML,n=i.__gui.__listening.indexOf(i)>-1;i.remove();var s=$(e,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return s.name(a),n&&s.listen(),s}return t};i.min=o.compose(n,i.min),i.max=o.compose(n,i.max)}else i instanceof A?(T.bind(t,"click",(function(){T.fakeEvent(i.__checkbox,"click")})),T.bind(i.__checkbox,"click",(function(e){e.stopPropagation()}))):i instanceof V?(T.bind(t,"click",(function(){T.fakeEvent(i.__button,"click")})),T.bind(t,"mouseover",(function(){T.addClass(i.__button,"hover")})),T.bind(t,"mouseout",(function(){T.removeClass(i.__button,"hover")}))):i instanceof k&&(T.addClass(t,"color"),i.updateDisplay=o.compose((function(e){return t.style.borderLeftColor=i.__color.toString(),e}),i.updateDisplay),i.updateDisplay());i.setValue=o.compose((function(t){return e.getRoot().__preset_select&&i.isModified()&&W(e.getRoot(),!0),t}),i.setValue)}(e,u,n),e.__controllers.push(n),n}function Z(e,t){return document.location.href+"."+t}function ee(e,t,i){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),i&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function te(e,t){t.style.display=e.useLocalStorage?"block":"none"}function ie(e){var t=e.__save_row=document.createElement("li");T.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),T.addClass(t,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",T.addClass(i,"button gears");var a=document.createElement("span");a.innerHTML="Save",T.addClass(a,"button"),T.addClass(a,"save");var n=document.createElement("span");n.innerHTML="New",T.addClass(n,"button"),T.addClass(n,"save-as");var s=document.createElement("span");s.innerHTML="Revert",T.addClass(s,"button"),T.addClass(s,"revert");var r=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?o.each(e.load.remembered,(function(t,i){ee(e,i,i===e.preset)})):ee(e,z,!1),T.bind(r,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(r),t.appendChild(i),t.appendChild(a),t.appendChild(n),t.appendChild(s),U){var l=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Z(0,"isLocal"))&&u.setAttribute("checked","checked"),te(e,l),T.bind(u,"change",(function(){e.useLocalStorage=!e.useLocalStorage,te(e,l)}))}var c=document.getElementById("dg-new-constructor");T.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||q.hide()})),T.bind(i,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),q.show(),c.focus(),c.select()})),T.bind(a,"click",(function(){e.save()})),T.bind(n,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),T.bind(s,"click",(function(){e.revert()}))}function oe(e){var t=void 0;function i(i){return i.preventDefault(),e.width+=t-i.clientX,e.onResize(),t=i.clientX,!1}function a(){T.removeClass(e.__closeButton,Q.CLASS_DRAG),T.unbind(window,"mousemove",i),T.unbind(window,"mouseup",a)}function n(o){return o.preventDefault(),t=o.clientX,T.addClass(e.__closeButton,Q.CLASS_DRAG),T.bind(window,"mousemove",i),T.bind(window,"mouseup",a),!1}e.__resize_handle=document.createElement("div"),o.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),T.bind(e.__resize_handle,"mousedown",n),T.bind(e.__closeButton,"mousedown",n),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ae(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function ne(e,t){var i={};return o.each(e.__rememberedObjects,(function(a,n){var s={},r=e.__rememberedObjectIndecesToControllers[n];o.each(r,(function(e,i){s[i]=t?e.initialValue:e.getValue()})),i[n]=s})),i}function se(e){0!==e.length&&N.call(window,(function(){se(e)})),o.each(e,(function(e){e.updateDisplay()}))}Q.toggleHide=function(){G=!G,o.each(Y,(function(e){e.domElement.style.display=G?"none":""}))},Q.CLASS_AUTO_PLACE="a",Q.CLASS_AUTO_PLACE_CONTAINER="ac",Q.CLASS_MAIN="main",Q.CLASS_CONTROLLER_ROW="cr",Q.CLASS_TOO_TALL="taller-than-window",Q.CLASS_CLOSED="closed",Q.CLASS_CLOSE_BUTTON="close-button",Q.CLASS_CLOSE_TOP="close-top",Q.CLASS_CLOSE_BOTTOM="close-bottom",Q.CLASS_DRAG="drag",Q.DEFAULT_WIDTH=245,Q.TEXT_CLOSED="Close Controls",Q.TEXT_OPEN="Open Controls",Q._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Q.toggleHide()},T.bind(window,"keydown",Q._keydownHandler,!1),o.extend(Q.prototype,{add:function(e,t){return $(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return $(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;o.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&H.removeChild(this.domElement);var e=this;o.each(this.__folders,(function(t){e.removeFolder(t)})),T.unbind(window,"keydown",Q._keydownHandler,!1),K(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new Q(t);this.__folders[e]=i;var o=X(this,i.domElement);return T.addClass(o,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],K(e);var t=this;o.each(e.__folders,(function(t){e.removeFolder(t)})),o.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=T.getOffset(e.__ul).top,i=0;o.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(i+=T.getHeight(t))})),window.innerHeight-t-20<i?(T.addClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(T.removeClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&o.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:o.debounce((function(){this.onResize()}),50),remember:function(){if(o.isUndefined(q)&&((q=new D).domElement.innerHTML=B),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;o.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&ie(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&ae(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ne(this)),e.folders={},o.each(this.__folders,(function(t,i){e.folders[i]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ne(this),W(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=ne(this,!0)),this.load.remembered[e]=ne(this),this.preset=e,ee(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){o.each(this.__controllers,(function(t){this.getRoot().load.remembered?J(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),o.each(this.__folders,(function(e){e.revert(e)})),e||W(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&se(this.__listening)},updateDisplay:function(){o.each(this.__controllers,(function(e){e.updateDisplay()})),o.each(this.__folders,(function(e){e.updateDisplay()}))}});var re=Q;const le={getCanvas:e=>document.getElementById(e)||(console.error(`There is no canvas with id ${e} on this page.`),null),getGLContext:e=>e.getContext("webgl2")||console.error("WebGL2 is not available in your browser."),autoResizeCanvas(e){const t=()=>{e.width=window.innerWidth,e.height=window.innerHeight};t(),window.addEventListener("resize",t)},getShader(e,t){const i=document.getElementById(t);if(!i)return null;const o=i.text.trim();let a;if("x-shader/x-vertex"===i.type)a=e.createShader(e.VERTEX_SHADER);else{if("x-shader/x-fragment"!==i.type)return null;a=e.createShader(e.FRAGMENT_SHADER)}return e.shaderSource(a,o),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(console.error(e.getShaderInfoLog(a)),null)},normalizeColor:e=>e.map((e=>e/255)),denormalizeColor:e=>e.map((e=>255*e)),configureControls(e,t={width:300}){const i=t.gui||new re(t),o={},a=e=>"function"==typeof e;Object.keys(e).forEach((t=>{const n=e[t];if(a(n))return o[t]=n,i.add(o,t);if(!a(s=n)&&"object"==typeof s&&(null===s.value||void 0===s.value))return le.configureControls(n,{gui:i.addFolder(t)});var s;const{value:r,min:l,max:u,step:c,options:d,onChange:h=(()=>null)}=n;let f;o[t]=r,f=d?i.add(o,t,d):(e=>"string"==typeof e&&~e.indexOf("#")||Array.isArray(e)&&e.length>=3)(r)?i.addColor(o,t):i.add(o,t,l,u,c),f.onChange((e=>h(e,o)))}))},restarVectores(e,t){const i=[];for(let o=0;o<e.length;o++)i.push(e[o]-t[o]);return i},normalizarVector(e){const t=[];let i=0;for(let t=0;t<e.length;t++)i+=e[t]*e[t];i=Math.sqrt(i);for(let o=0;o<e.length;o++)t.push(e[o]/i);return t},calcularNormales(e){const t=[];for(let i=0;i<e.length;i++){const o=e[i];t.push([o[1],-o[0]])}return t},pasarTanAVector3(e){const t=[];for(let i=0;i<e.length;i++)t.push([0,e[i][1],e[i][0]]);return t},productoCruz(e,t){const i=[];return i[0]=e[1]*t[2]-e[2]*t[1],i[1]=e[2]*t[0]-e[0]*t[2],i[2]=e[0]*t[1]-e[1]*t[0],i},calcularVectorBinormal(e,t){const i=[];for(let o=0;o<t.length;o++){const a=t[o],n=this.productoCruz(a,e);i.push(le.normalizarVector(n))}return i},deRadianesAGrados(e){const t=180*e/Math.PI>360?180*e/Math.PI-360:180*e/Math.PI;return Math.floor(t)}};var ue="undefined"!=typeof Float32Array?Float32Array:Array;function ce(){var e=new ue(16);return ue!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function de(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function he(e,t,i,o,a,n,s,r,l,u,c,d,h,f,p,m,_){return e[0]=t,e[1]=i,e[2]=o,e[3]=a,e[4]=n,e[5]=s,e[6]=r,e[7]=l,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=f,e[13]=p,e[14]=m,e[15]=_,e}function fe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pe(e,t){if(e===t){var i=t[1],o=t[2],a=t[3],n=t[6],s=t[7],r=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=o,e[9]=n,e[11]=t[14],e[12]=a,e[13]=s,e[14]=r}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function me(e,t){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],r=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],_=t[14],g=t[15],b=i*r-o*s,v=i*l-a*s,w=i*u-n*s,x=o*l-a*r,y=o*u-n*r,T=a*u-n*l,A=c*m-d*p,E=c*_-h*p,C=c*g-f*p,M=d*_-h*m,S=d*g-f*m,P=h*g-f*_,O=b*P-v*S+w*M+x*C-y*E+T*A;return O?(O=1/O,e[0]=(r*P-l*S+u*M)*O,e[1]=(a*S-o*P-n*M)*O,e[2]=(m*T-_*y+g*x)*O,e[3]=(h*y-d*T-f*x)*O,e[4]=(l*C-s*P-u*E)*O,e[5]=(i*P-a*C+n*E)*O,e[6]=(_*w-p*T-g*v)*O,e[7]=(c*T-h*w+f*v)*O,e[8]=(s*S-r*C+u*A)*O,e[9]=(o*C-i*S-n*A)*O,e[10]=(p*y-m*w+g*b)*O,e[11]=(d*w-c*y-f*b)*O,e[12]=(r*E-s*M-l*A)*O,e[13]=(i*M-o*E+a*A)*O,e[14]=(m*v-p*x-_*b)*O,e[15]=(c*x-d*v+h*b)*O,e):null}function _e(e,t,i){var o=t[0],a=t[1],n=t[2],s=t[3],r=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],f=t[10],p=t[11],m=t[12],_=t[13],g=t[14],b=t[15],v=i[0],w=i[1],x=i[2],y=i[3];return e[0]=v*o+w*r+x*d+y*m,e[1]=v*a+w*l+x*h+y*_,e[2]=v*n+w*u+x*f+y*g,e[3]=v*s+w*c+x*p+y*b,v=i[4],w=i[5],x=i[6],y=i[7],e[4]=v*o+w*r+x*d+y*m,e[5]=v*a+w*l+x*h+y*_,e[6]=v*n+w*u+x*f+y*g,e[7]=v*s+w*c+x*p+y*b,v=i[8],w=i[9],x=i[10],y=i[11],e[8]=v*o+w*r+x*d+y*m,e[9]=v*a+w*l+x*h+y*_,e[10]=v*n+w*u+x*f+y*g,e[11]=v*s+w*c+x*p+y*b,v=i[12],w=i[13],x=i[14],y=i[15],e[12]=v*o+w*r+x*d+y*m,e[13]=v*a+w*l+x*h+y*_,e[14]=v*n+w*u+x*f+y*g,e[15]=v*s+w*c+x*p+y*b,e}function ge(e,t,i){var o,a,n,s,r,l,u,c,d,h,f,p,m=i[0],_=i[1],g=i[2];return t===e?(e[12]=t[0]*m+t[4]*_+t[8]*g+t[12],e[13]=t[1]*m+t[5]*_+t[9]*g+t[13],e[14]=t[2]*m+t[6]*_+t[10]*g+t[14],e[15]=t[3]*m+t[7]*_+t[11]*g+t[15]):(o=t[0],a=t[1],n=t[2],s=t[3],r=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],f=t[10],p=t[11],e[0]=o,e[1]=a,e[2]=n,e[3]=s,e[4]=r,e[5]=l,e[6]=u,e[7]=c,e[8]=d,e[9]=h,e[10]=f,e[11]=p,e[12]=o*m+r*_+d*g+t[12],e[13]=a*m+l*_+h*g+t[13],e[14]=n*m+u*_+f*g+t[14],e[15]=s*m+c*_+p*g+t[15]),e}function be(e,t,i,o){var a,n,s,r,l,u,c,d,h,f,p,m,_,g,b,v,w,x,y,T,A,E,C,M,S=o[0],P=o[1],O=o[2],I=Math.hypot(S,P,O);return I<1e-6?null:(S*=I=1/I,P*=I,O*=I,a=Math.sin(i),s=1-(n=Math.cos(i)),r=t[0],l=t[1],u=t[2],c=t[3],d=t[4],h=t[5],f=t[6],p=t[7],m=t[8],_=t[9],g=t[10],b=t[11],v=S*S*s+n,w=P*S*s+O*a,x=O*S*s-P*a,y=S*P*s-O*a,T=P*P*s+n,A=O*P*s+S*a,E=S*O*s+P*a,C=P*O*s-S*a,M=O*O*s+n,e[0]=r*v+d*w+m*x,e[1]=l*v+h*w+_*x,e[2]=u*v+f*w+g*x,e[3]=c*v+p*w+b*x,e[4]=r*y+d*T+m*A,e[5]=l*y+h*T+_*A,e[6]=u*y+f*T+g*A,e[7]=c*y+p*T+b*A,e[8]=r*E+d*C+m*M,e[9]=l*E+h*C+_*M,e[10]=u*E+f*C+g*M,e[11]=c*E+p*C+b*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ve(e,t,i){var o=Math.sin(i),a=Math.cos(i),n=t[4],s=t[5],r=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*a+u*o,e[5]=s*a+c*o,e[6]=r*a+d*o,e[7]=l*a+h*o,e[8]=u*a-n*o,e[9]=c*a-s*o,e[10]=d*a-r*o,e[11]=h*a-l*o,e}function we(e,t,i){var o=Math.sin(i),a=Math.cos(i),n=t[0],s=t[1],r=t[2],l=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*a-u*o,e[1]=s*a-c*o,e[2]=r*a-d*o,e[3]=l*a-h*o,e[8]=n*o+u*a,e[9]=s*o+c*a,e[10]=r*o+d*a,e[11]=l*o+h*a,e}function xe(e,t,i){var o=Math.sin(i),a=Math.cos(i),n=t[0],s=t[1],r=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*a+u*o,e[1]=s*a+c*o,e[2]=r*a+d*o,e[3]=l*a+h*o,e[4]=u*a-n*o,e[5]=c*a-s*o,e[6]=d*a-r*o,e[7]=h*a-l*o,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});class ye{constructor(e,t,i){return this.gl=e,this.program=e.createProgram(),t&&i?(e.attachShader(this.program,le.getShader(e,t)),e.attachShader(this.program,le.getShader(e,i)),e.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)?void this.useProgram():console.error("Could not initialize shaders.")):console.error("No shader IDs were provided")}useProgram(){this.gl.useProgram(this.program)}load(e,t){this.useProgram(),this.setAttributeLocations(e),this.setUniformLocations(t)}setAttributeLocations(e){e.forEach((e=>{this[e]=this.gl.getAttribLocation(this.program,e)}))}setUniformLocations(e){e.forEach((e=>{this[e]=this.gl.getUniformLocation(this.program,e)}))}getUniform(e){return this.gl.getUniform(this.program,e)}}class Te{constructor(e,t){this.gl=e,this.program=t,this.objects=[]}get(e){return this.objects.find((t=>t.alias===e))}load(e,t,i){return fetch(e).then((e=>e.json())).then((e=>{e.visible=!0,e.alias=t||e.alias,this.add(e,i)})).catch((e=>console.error(e,...arguments)))}loadByParts(e,t,i){for(let o=1;o<=t;o++){const t=`${e}${o}.json`;this.load(t,i)}}add(e,t){const{gl:i,program:o}=this;if(e.diffuse=e.diffuse||[1,1,1,1],e.Kd=e.Kd||e.diffuse.slice(0,3),e.ambient=e.ambient||[.2,.2,.2,1],e.Ka=e.Ka||e.ambient.slice(0,3),e.specular=e.specular||[1,1,1,1],e.Ks=e.Ks||e.specular.slice(0,3),e.specularExponent=e.specularExponent||0,e.Ns=e.Ns||e.specularExponent,e.d=e.d||1,e.transparency=e.transparency||e.d,e.illum=e.illum||1,Object.assign(e,t),e.ibo=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.ibo),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices),i.STATIC_DRAW),e.vao=i.createVertexArray(),i.bindVertexArray(e.vao),o.aVertexPosition>=0){const t=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e.vertices),i.STATIC_DRAW),i.enableVertexAttribArray(o.aVertexPosition),i.vertexAttribPointer(o.aVertexPosition,3,i.FLOAT,!1,0,0)}if(o.aVertexNormal>=0){const t=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e.normales),i.STATIC_DRAW),i.enableVertexAttribArray(o.aVertexNormal),i.vertexAttribPointer(o.aVertexNormal,3,i.FLOAT,!1,0,0)}if(e.scalars&&o.aVertexColor>=0){const t=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e.scalars),i.STATIC_DRAW),i.enableVertexAttribArray(o.aVertexColor),i.vertexAttribPointer(o.aVertexColor,4,i.FLOAT,!1,0,0)}if(e.textureCoords&&o.aVertexTextureCoords>=0){const t=i.createBuffer();if(i.bindBuffer(i.ARRAY_BUFFER,t),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e.textureCoords),i.STATIC_DRAW),i.enableVertexAttribArray(o.aVertexTextureCoords),i.vertexAttribPointer(o.aVertexTextureCoords,2,i.FLOAT,!1,0,0),o.aVertexTangent>=0){const t=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t),i.bufferData(i.ARRAY_BUFFER,new Float32Array(le.calculateTangents(e.vertices,e.textureCoords,e.indices)),i.STATIC_DRAW),i.enableVertexAttribArray(o.aVertexTangent),i.vertexAttribPointer(o.aVertexTangent,3,i.FLOAT,!1,0,0)}}e.image&&(e.texture=new Texture(i,e.image)),this.objects.push(e),i.bindVertexArray(null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),i.bindBuffer(i.ARRAY_BUFFER,null)}traverse(e){for(let t=0;t<this.objects.length&&void 0===e(this.objects[t],t);t++);}remove(e){const t=this.get(e),i=this.objects.indexOf(t);this.objects.splice(i,1)}renderFirst(e){const t=this.get(e),i=this.objects.indexOf(t);0!==i&&(this.objects.splice(i,1),this.objects.splice(0,0,t),this.printRenderOrder())}renderLast(e){const t=this.get(e),i=this.objects.indexOf(t);0!==i&&(this.objects.splice(i,1),this.objects.push(t),this.printRenderOrder())}renderSooner(e){const t=this.get(e),i=this.objects.indexOf(t);0!==i&&(this.objects.splice(i,1),this.objects.splice(i-1,0,t),this.printRenderOrder())}renderLater(e){const t=this.get(e),i=this.objects.indexOf(t);i!==this.objects.length-1&&(this.objects.splice(i,1),this.objects.splice(i+1,0,t),this.printRenderOrder())}printRenderOrder(){const e=this.objects.map((e=>e.alias)).join(" > ");console.info("Render Order:",e)}}class Ae{constructor(e=50,t=5){this.alias="floor",this.dimension=e,this.lines=t,this.vertices=[],this.indices=[],this.wireframe=!0,this.visible=!0,this.build(this.dimension,this.lines)}build(e,t){e&&(this.dimension=e),t&&(this.lines=2*this.dimension/t);const i=2*this.dimension/this.lines,o=[],a=[];for(let e=0;e<=this.lines;e++)o[6*e]=-this.dimension,o[6*e+1]=0,o[6*e+2]=-this.dimension+e*i,o[6*e+3]=this.dimension,o[6*e+4]=0,o[6*e+5]=-this.dimension+e*i,o[6*(this.lines+1)+6*e]=-this.dimension+e*i,o[6*(this.lines+1)+6*e+1]=0,o[6*(this.lines+1)+6*e+2]=-this.dimension,o[6*(this.lines+1)+6*e+3]=-this.dimension+e*i,o[6*(this.lines+1)+6*e+4]=0,o[6*(this.lines+1)+6*e+5]=this.dimension,a[2*e]=2*e,a[2*e+1]=2*e+1,a[2*(this.lines+1)+2*e]=2*(this.lines+1)+2*e,a[2*(this.lines+1)+2*e+1]=2*(this.lines+1)+2*e+1;this.vertices=o,this.indices=a}}class Ee{constructor(e=10){this.alias="axis",this.wireframe=!0,this.indices=[0,1,2,3,4,5],this.dimension=e,this.build(this.dimension)}build(e){e&&(this.dimension=e),this.vertices=[-e,0,0,e,0,0,0,-e/2,0,0,e/2,0,0,0,-e,0,0,e]}}function Ce(){var e=new ue(3);return ue!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Me(e,t,i){var o=new ue(3);return o[0]=e,o[1]=t,o[2]=i,o}function Se(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Pe(e,t){var i=t[0],o=t[1],a=t[2],n=i*i+o*o+a*a;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Oe(e,t,i){var o=t[0],a=t[1],n=t[2],s=i[0],r=i[1],l=i[2];return e[0]=a*l-n*r,e[1]=n*s-o*l,e[2]=o*r-a*s,e}function Ie(){var e=new ue(4);return ue!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ve(e,t,i,o,a){return e[0]=t,e[1]=i,e[2]=o,e[3]=a,e}function ke(e,t,i){var o=t[0],a=t[1],n=t[2],s=t[3];return e[0]=i[0]*o+i[4]*a+i[8]*n+i[12]*s,e[1]=i[1]*o+i[5]*a+i[9]*n+i[13]*s,e[2]=i[2]*o+i[6]*a+i[10]*n+i[14]*s,e[3]=i[3]*o+i[7]*a+i[11]*n+i[15]*s,e}Ce(),Ie();class Re{constructor(e=Re.ORBITING_TYPE){this.position=Ce(),this.focus=Ce(),this.up=Ce(),this.right=Ce(),this.normal=Ce(),this.matrix=ce(),this.steps=0,this.azimuth=0,this.elevation=0,this.fov=45,this.minZ=.1,this.maxZ=1e4,this.factorVelocidad=500,this.azimuthActual=0,this.elevationActual=-30,this.timeOutIdPool=[],this.rotationMatrix=null,this.setType(e)}setRotationMatrix(e){this.rotationMatrix=e}isOrbiting(){return this.type===Re.ORBITING_TYPE}isTracking(){return this.type===Re.TRACKING_TYPE}setType(e){~Re.TYPES.indexOf(e)?this.type=e:console.error(`Camera type (${e}) not supported`)}goTo(e=[0,0,0],t=0,i=0,o=[0,0,0]){this.setPosition(e),this.setAzimuth(t),this.setElevation(i),this.setFocus(o)}dolly(e){const t=Ce(),i=Ce();Pe(t,this.normal);const o=e-this.steps;this.isTracking()?(i[0]=this.position[0]-o*t[0],i[1]=this.position[1]-o*t[1],i[2]=this.position[2]-o*t[2]):(i[0]=this.position[0],i[1]=this.position[1],i[2]=this.position[2]-o),this.steps=e,this.setPosition(i)}setPosition(e){Se(this.position,e),this.update()}setFocus(e){Se(this.focus,e),this.update()}colocarPaulatinamenteLaCamaraEn(e,t){const i=this.azimuthActual,o=this.elevationActual,a=(this.elevation-e)/this.factorVelocidad,n=(this.azimuth-t)/this.factorVelocidad;console.log(n.toFixed(4),a.toFixed(4)),Math.abs(a)>.001||Math.abs(n)>.001?(this.elevation-=a,this.azimuth-=n,this.update(),i===t&&o===e?this.timeOutIdPool.push(setTimeout((()=>{this.colocarPaulatinamenteLaCamaraEn(e,t)}),10)):(this.borrarTimeOutIdPool(),this.azimuthActual=t,this.elevationActual=e,this.colocarPaulatinamenteLaCamaraEn(e,t))):this.borrarTimeOutIdPool()}borrarTimeOutIdPool(){this.timeOutIdPool.forEach((e=>{clearTimeout(e)})),this.timeOutIdPool=[]}setAzimuth(e){this.changeAzimuth(e-this.azimuth)}changeAzimuth(e){this.azimuth+=e,(this.azimuth>360||this.azimuth<-360)&&(this.azimuth=this.azimuth%360),this.update()}setElevation(e){this.changeElevation(e-this.elevation)}changeElevation(e){this.elevation+=e,(this.elevation>360||this.elevation<-360)&&(this.elevation=this.elevation%360),this.update()}lookAt(){const e=Ie();Ve(e,0,0,0,1),ke(e,e,this.matrix);const t=Ce();var i,o,a;i=t,o=e,a=this.focus,i[0]=o[0]-a[0],i[1]=o[1]-a[1],i[2]=o[2]-a[2],Pe(t,t);const n=Ce();Oe(n,this.up,t),Pe(n,n);const s=Ce();Oe(s,t,n),Pe(s,s),fe(this.matrix),he(this.matrix,n[0],n[1],n[2],0,s[0],s[1],s[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1)}calculateOrientation(){const e=Ie();Ve(e,1,0,0,0),ke(e,e,this.matrix),Se(this.right,e);const t=Ie();Ve(t,0,1,0,0),ke(t,t,this.matrix),Se(this.up,t);const i=Ie();Ve(i,0,0,1,0),ke(i,i,this.matrix),Se(this.normal,i)}dejarDeSeguirALaCapsula(){this.seguirCapsula=!1}seguirALaCapsula(){this.seguirCapsula=!0}update(){if(fe(this.matrix),this.isTracking()?(ge(this.matrix,this.matrix,this.position),we(this.matrix,this.matrix,this.azimuth*Math.PI/180),ve(this.matrix,this.matrix,this.elevation*Math.PI/180)):(ge(this.matrix,this.matrix,this.focus),this.seguirCapsula&&_e(this.matrix,this.matrix,this.rotationMatrix),we(this.matrix,this.matrix,this.azimuth*Math.PI/180),ve(this.matrix,this.matrix,this.elevation*Math.PI/180),ge(this.matrix,this.matrix,this.position)),this.isTracking()){const e=Ie();Ve(e,0,0,0,1),ke(e,e,this.matrix),Se(this.position,e)}this.calculateOrientation(),this.isOrbiting()&&this.lookAt()}logCamera(){console.log(`posCamara: ${this.position[0].toFixed(2)}, ${this.position[1].toFixed(2)}, ${this.position[2].toFixed(2)}`),console.log(`azimuth: ${this.azimuth.toFixed(2)}`),console.log(`elevation: ${this.elevation.toFixed(2)}`)}getViewTransform(){const e=ce();return me(e,this.matrix),e}}Re.TYPES=["ORBITING_TYPE","TRACKING_TYPE"],Re.TYPES.forEach((e=>Re[e]=e));class Le{constructor(e,t,i){this.camera=e,this.canvas=t,this.droneCam=i,this.picker=null,this.dragging=!1,this.picking=!1,this.ctrl=!1,this.x=0,this.y=0,this.lastX=0,this.lastY=0,this.button=0,this.key=0,this.dloc=0,this.dstep=0,this.motionFactor=10,this.keyIncrement=5,this.focusCamera={Nave:!1,PanelesSolares:!1,Capsula:!1},t.onmousedown=e=>this.onMouseDown(e),t.onmouseup=e=>this.onMouseUp(e),t.onmousemove=e=>this.onMouseMove(e),t.onwheel=e=>this.onMouseWheel(e),window.onkeydown=e=>this.onKeyDown(e),window.onkeyup=e=>this.onKeyUp(e),this.dondeEstoy="Nave",this.Camara={Nave:{position:Ce(),azimuth:0,elevation:0,focus:Ce()},PanelesSolares:{position:Me(0,0,29.5),azimuth:-180,elevation:-30,focus:Ce()},Capsula:{position:Me(0,0,20),azimuth:0,elevation:-30.8,focus:Ce()}}}setFocusCapsula(e){this.Camara.Capsula.focus=e}setFocus(e,t){this.Camara.Nave.focus=e,this.Camara.PanelesSolares.focus=t}setPicker(e){this.picker=e}get2DCoords(e){let t=0,i=0,o=this.canvas;for(;o&&"BODY"!==o.tagName;)t+=o.offsetTop,i+=o.offsetLeft,o=o.offsetParent;return i+=window.pageXOffset,t-=window.pageYOffset,{x:e.clientX-i,y:this.canvas.height-(e.clientY-t)}}onMouseUp(e){this.dragging=!1,!e.shiftKey&&this.picker&&(this.picking=!1,this.picker.stop())}onMouseDown(e){if(this.dragging=!0,this.x=e.clientX,this.y=e.clientY,this.button=e.button,this.dstep=Math.max(this.camera.position[0],this.camera.position[1],this.camera.position[2])/100,!this.picker)return;const t=this.get2DCoords(e);this.picking=this.picker.find(t),this.picking||this.picker.stop()}dollyHelper(e,t=3){for(this.dstep=Math.max(this.camera.position[0],this.camera.position[1],this.camera.position[2])/100;t--;)this.dolly(e)}onMouseWheel(e){const t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));this.dollyHelper(t)}onMouseMove(e){if(this.lastX=this.x,this.lastY=this.y,this.x=e.clientX,this.y=e.clientY,!this.dragging)return;this.ctrl=e.ctrlKey,this.alt=e.altKey;const t=this.x-this.lastX,i=this.y-this.lastY;this.picking&&this.picker.moveCallback?this.picker.moveCallback(t,i):this.button||(this.alt?this.dolly(i):this.rotate(t,i))}configurarCamaraDe(e){Se(this.Camara[this.dondeEstoy].position,this.camera.position),this.Camara[this.dondeEstoy].azimuth=this.camera.azimuth,this.Camara[this.dondeEstoy].elevation=this.camera.elevation,this.camera.goTo(this.Camara[e].position,this.Camara[e].azimuth,this.Camara[e].elevation,this.Camara[e].focus),this.dondeEstoy=e,"Nave"===e?(this.focusCamera.PanelesSolares=!1,this.focusCamera.Capsula=!1,this.focusCamera.Nave=!0):"PanelesSolares"===e?(this.focusCamera.Nave=!1,this.focusCamera.Capsula=!1,this.focusCamera.PanelesSolares=!0):"Capsula"===e&&(this.focusCamera.Nave=!1,this.focusCamera.PanelesSolares=!1,this.focusCamera.Capsula=!0)}onKeyDown(e){if(this.key=e.keyCode,this.ctrl=e.ctrlKey,!this.ctrl)switch(this.key){case 49:return this.droneCam.activarControlesTeclado(!1),this.camera.borrarTimeOutIdPool(),this.camera.dejarDeSeguirALaCapsula(),this.configurarCamaraDe("Nave");case 50:return this.droneCam.activarControlesTeclado(!1),this.camera.borrarTimeOutIdPool(),this.camera.dejarDeSeguirALaCapsula(),this.configurarCamaraDe("PanelesSolares");case 51:return this.droneCam.activarControlesTeclado(),this.camera.seguirALaCapsula(),this.configurarCamaraDe("Capsula");case 78:return this.dollyHelper(-1);case 77:return this.dollyHelper(1)}}onKeyUp(e){17===e.keyCode&&(this.ctrl=!1)}dolly(e){e>0?this.dloc+=this.dstep:this.dloc-=this.dstep,this.camera.dolly(this.dloc)}rotate(e,t){const{width:i,height:o}=this.canvas,a=-20/o,n=e*(-20/i)*this.motionFactor,s=t*a*this.motionFactor;this.camera.changeAzimuth(n),this.camera.changeElevation(s)}}class Be{constructor(e,t,i,o){this.stack=[],this.gl=e,this.program=t,this.camera=i,this.canvas=o,this.modelViewMatrix=ce(),this.projectionMatrix=ce(),this.normalMatrix=ce(),this.calculateModelView(),this.updatePerspective(),this.calculateNormal()}calculateModelView(){this.modelViewMatrix=this.camera.getViewTransform()}calculateNormal(){de(this.normalMatrix,this.modelViewMatrix),me(this.normalMatrix,this.normalMatrix),pe(this.normalMatrix,this.normalMatrix)}updatePerspective(){var e,t,i,o,a,n,s;e=this.projectionMatrix,t=this.camera.fov,i=this.canvas.width/this.canvas.height,o=this.camera.minZ,a=this.camera.maxZ,s=1/Math.tan(t/2),e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(n=1/(o-a),e[10]=(a+o)*n,e[14]=2*a*o*n):(e[10]=-1,e[14]=-2*o)}setMatrixUniforms(){this.calculateNormal(),this.gl.uniformMatrix4fv(this.program.uModelViewMatrix,!1,this.modelViewMatrix),this.gl.uniformMatrix4fv(this.program.uProjectionMatrix,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.program.uNormalMatrix,!1,this.normalMatrix)}push(){const e=ce();de(e,this.modelViewMatrix),this.stack.push(e)}pop(){return this.stack.length?this.modelViewMatrix=this.stack.pop():null}}class Fe{constructor(e){this.dimensionesTriangulos=e}construir(e){const t=[],i=[],o=[];for(let a=0;a<=this.dimensionesTriangulos.filas;a++)for(let n=0;n<=this.dimensionesTriangulos.columnas;n++){let s=n/this.dimensionesTriangulos.columnas,r=a/this.dimensionesTriangulos.filas,l=e.getPosicion(s,r);t.push(l[0]),t.push(l[1]),t.push(l[2]);let u=e.getNormal(s,r);i.push(u[0]),i.push(u[1]),i.push(u[2]);let c=e.getCoordenadasTextura(s,r);o.push(c[0]),o.push(c[1])}const a=this.dimensionesTriangulos.columnas+1,n=[];for(let e=0;e<this.dimensionesTriangulos.filas;e++){for(let t=0;t<this.dimensionesTriangulos.columnas+1;t+=2)n.push(e*a+t),n.push((e+1)*a+t),n.push(e*a+t+1),n.push((e+1)*a+t+1);const t=n.length;this.dimensionesTriangulos.columnas%2?(n.push(n[t-1]),n.push((e+1)*a+0)):(n[t-1]=n[t-2],n[t-2]=n[t-3])}return n.pop(),n.pop(),{positionBuffer:t,normalBuffer:i,uvBuffer:o,indexBuffer:n}}}class Ne{constructor(e,t){this.alias=t,this.vertices=[],this.indices=[],this.textureCoords=[],this.normales=[],this.diffuse=[.71875,0,.1796,1],this.visible=!0,this.dimensionesTriangulos=e,this.wireframe=!1}superficie(){}construir(){const e=new Fe(this.dimensionesTriangulos).construir(this.superficie());this.vertices=e.positionBuffer,this.indices=e.indexBuffer,this.normales=e.normalBuffer,this.textureCoords=e.uvBuffer}}class De extends Ne{constructor(e,t,i,o=!1){super(i,e),this.dimensionesCilindro=t,this.invertirNormales=o,this.construir()}superficie(){const e=this.dimensionesCilindro.radioSuperior,t=this.dimensionesCilindro.radioInferior,i=this.dimensionesCilindro.altura,o=(t-e)/i,a=this.invertirNormales;return{getPosicion:function(o,a){const n=a*(e-t)+t,s=2*Math.PI*o;return[n*Math.sin(s),a*i,n*Math.cos(s)]},getNormal:function(e,t){const i=2*Math.PI*e,n=le.normalizarVector([Math.sin(i),o,Math.cos(i)]);return!0===a?n.map((e=>-e)):n},getCoordenadasTextura:function(e,t){return[e,1-t]}}}}class ze extends Ne{constructor(e,t,i){super(i,e),this.dimensionesTubo=t,this.construir()}superficie(){const e=this.dimensionesTubo.radio,t=this.dimensionesTubo.altura;return{getPosicion:function(i,o){const a=2*Math.PI*i,n=e,s=n*Math.cos(a),r=n*Math.sin(a);return[s,o*t,r]},getNormal:function(e,t){const i=2*Math.PI*e;return[Math.cos(i),0,Math.sin(i)]},getCoordenadasTextura:function(e,t){return[e,1-t]}}}}class Ue extends Ne{constructor(e,t,i){super(i,e),this.radio=t,this.construir()}superficie(){const e=this.radio;return{getPosicion:function(t,i){let o=2*Math.PI*t;return[e*i*Math.cos(o),0,e*i*Math.sin(o)]},getNormal:function(e,t){return[0,1,0]},getCoordenadasTextura:function(e,t){return[e,t]}}}}class qe extends Ne{constructor(e,t,i){super(i,e),this.dimensiones=t,this.construir()}superficie(){const e=this.dimensiones.ancho,t=this.dimensiones.largo;return{getPosicion:function(i,o){return[(i-.5)*e,0,(o-.5)*t]},getNormal:function(e,t){return[0,1,0]},getCoordenadasTextura:function(e,t){return[e,t]}}}}class je extends Ne{constructor(e,t=1,i=.4,o,a=2*Math.PI){super(o,e),this.arc=a,this.radius=t,this.tube=i,this.construir()}superficie(){const e=this.arc,t=this.radius,i=this.tube;return{getPosicion:function(o,a){return a=2*Math.PI*a,o*=e,[(t+i*Math.cos(a))*Math.cos(o),(t+i*Math.cos(a))*Math.sin(o),i*Math.sin(a)]},getNormal:function(i,o){const a=this.getPosicion(i,o);i*=e;const n=[],s=[];n[0]=t*Math.cos(i),n[1]=t*Math.sin(i),n[2]=0,s[0]=a[0]-n[0],s[1]=a[1]-n[1],s[2]=a[2]-n[2];const r=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);return s[0]/=r,s[1]/=r,s[2]/=r,[s[0],s[1],s[2]]},getCoordenadasTextura:function(e,t){return[e,t]}}}}function He(e,t,i,o,a){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,o)+function(e,t){return e*e*e*t}(e,a)}class Ge{constructor(e=[0,0],t=[0,0],i=[0,0],o=[0,0]){this.type="CurvaDeBezier",this.v0=e,this.v1=t,this.v2=i,this.v3=o}extraerPuntos(e=5){const t=[],i=[];for(let o=0;o<=e;o++)t.push(this.extraerPunto(o/e)),i.push(this.getTangent(o/e));return{puntos:t,puntosTangentes:i}}extraerPunto(e,t=[0,0]){const i=t,o=this.v0,a=this.v1,n=this.v2,s=this.v3;return i[0]=He(e,o[0],a[0],n[0],s[0]),i[1]=He(e,o[1],a[1],n[1],s[1]),i}getTangent(e){const t=1e-4;let i=e-t,o=e+t;i<0&&(i=0),o>1&&(o=1);const a=this.extraerPunto(i),n=this.extraerPunto(o),s=le.restarVectores(n,a);return le.normalizarVector(s)}}class Ye{constructor(){this.curvas=[],this.puntoActual=[0,0],this.esCurvaCerrada=!1}curvaCerrada(e){this.esCurvaCerrada=e}actualizarPuntoActual(e,t){return this.puntoActual[0]=e,this.puntoActual[1]=t,this}extraerPuntos(e=12){const t=[],i=[];let o;for(let a=0,n=this.curvas;a<n.length;a++){const s=n[a];let r,l;if(s&&"CurvaDeBezier"===s.type){const{puntos:t,puntosTangentes:o}=s.extraerPuntos(e);r=t,l=o,i.push(...l)}else r=s;for(let e=0;e<r.length;e++){const i=r[e];o&&o[0]===i[0]&&o[1]===i[1]||(t.push(i),o=i)}}return!0===this.esCurvaCerrada&&i.push(i[0]),{puntos:t,puntosTangentes:i}}clonarPuntoActual(){return[this.puntoActual[0],this.puntoActual[1]]}CurvaBezierA(e,t,i,o,a,n){const s=new Ge(this.clonarPuntoActual(),[e,t],[i,o],[a,n]);return this.curvas.push(s),this.actualizarPuntoActual(a,n),this}iniciarEn(e,t){return this.actualizarPuntoActual(e,t),this}lineaA(e,t){const i=[this.clonarPuntoActual(),[e,t]];return this.curvas.push(i),this.actualizarPuntoActual(e,t),this}}class Qe extends Ne{constructor(e,t,i){super(i,e),this.puntosDeLaForma=t,this.construir()}superficie(){const e=this.puntosDeLaForma;let t=0;return{getPosicion:function(i,o){const a=o*e[t][0],n=o*e[t][1];return t++,1===i&&(t=0),[a,0,n]},getNormal:(e,t)=>[0,1,0],getCoordenadasTextura:function(e,t){return[e,1-t]}}}}class Xe extends Ne{constructor(e,t,i,o,a=!1){super(o,e),this.datosDelRecorrido=i,this.datosDeLaForma=t,this.recorridoXY=a,this.construir()}superficie(){let e=0,t=0;const i=this.datosDelRecorrido,o=this.recorridoXY,a=this.datosDeLaForma;let n;return{getPosicion:function(s,r){const[l,u]=a.puntos[e],[c,d]=a.normales[e],h=i.binormales[t],f=i.tangentes[t],p=i.puntos[t],m=i.vectorNormal,_=ce();o?he(_,m[0],h[0],f[0],p[0],m[1],h[1],f[1],p[1],m[2],h[2],f[2],0,0,0,0,1):he(_,m[0],h[0],f[0],0,m[1],h[1],f[1],p[1],m[2],h[2],f[2],p[0],0,0,0,1),pe(_,_);const g=Ie();Ve(g,l,u,0,1),ke(g,g,_);const b=ce();return he(b,m[0],h[0],f[0],0,m[1],h[1],f[1],0,m[2],h[2],f[2],0,0,0,0,1),pe(b,b),n=Ie(),Ve(n,c,d,0,1),ke(n,n,b),[g[0],g[1],g[2]]},getNormal(i,o){e++,1===i&&(e=0,t++);const a=le.normalizarVector([n[0],n[1],n[2]]);return[a[0],a[1],a[2]]},getCoordenadasTextura:function(e,t){return[e,1-t]}}}}function Ke(e,t){let i=.05,o=.05;e||(e=[0,0,0]);let a=Me(e[0],e[1],e[2]),n=Ce(),s=ce(),r={xVel:0,zVel:0,yVel:0,xVelTarget:0,zVelTarget:0,yVelTarget:0,yRotVelTarget:0,yRotVel:0,zRotVelTarget:0,zRotVel:0,xRotVelTarget:0,xRotVel:0,rightAxisMode:"move"},l=Object.assign({},r);this.listener=function(o){switch(o.key){case"ArrowUp":case"w":t.colocarPaulatinamenteLaCamaraEn(-30,0),l.zVelTarget=.7;break;case"ArrowDown":case"s":t.colocarPaulatinamenteLaCamaraEn(-30,180),l.zVelTarget=-.7;break;case"ArrowLeft":case"a":t.colocarPaulatinamenteLaCamaraEn(-30,90),l.xVelTarget=.7;break;case"ArrowRight":case"d":t.colocarPaulatinamenteLaCamaraEn(-30,-90),l.xVelTarget=-.7;break;case"q":case"PageUp":case" ":t.colocarPaulatinamenteLaCamaraEn(90,0),l.yVelTarget=.7;break;case"e":case"PageDown":t.colocarPaulatinamenteLaCamaraEn(-90,0),l.yVelTarget=-.7;break;case"k":l.xRotVelTarget=i;break;case"i":l.xRotVelTarget=-.05;break;case"j":l.yRotVelTarget=i;break;case"l":l.yRotVelTarget=-.05;break;case"u":l.zRotVelTarget=i;break;case"o":l.zRotVelTarget=-.05;break;case"r":n=Ce(),a=Me(e[0],e[1],e[2]),l=Object.assign({},r),s=ce();break;case"t":n=Ce(),l=Object.assign({},r)}},this.activarControlesTeclado=function(e=!0){e?(document.addEventListener("keydown",this.listener),document.addEventListener("keyup",(function(e){switch(e.key){case"ArrowUp":case"w":case"ArrowDown":case"s":l.zVelTarget=0;break;case"ArrowLeft":case"a":case"ArrowRight":case"d":l.xVelTarget=0;break;case"q":case"e":case"PageDown":case"PageUp":case" ":l.yVelTarget=0;break;case"j":case"l":l.yRotVelTarget=0;break;case"i":case"k":l.xRotVelTarget=0;break;case"u":case"o":l.zRotVelTarget=0}}))):document.removeEventListener("keydown",this.listener)},this.update=function(){l.xVel+=(l.xVelTarget-l.xVel)*o,l.yVel+=(l.yVelTarget-l.yVel)*o,l.zVel+=(l.zVelTarget-l.zVel)*o,l.xRotVel+=(l.xRotVelTarget-l.xRotVel)*o,l.yRotVel+=(l.yRotVelTarget-l.yRotVel)*o,l.zRotVel+=(l.zRotVelTarget-l.zRotVel)*o;let e=Me(-l.xVel,l.yVel,-l.zVel);var t,i,n,r,u,c,d;return Math.abs(l.xRotVel)>0&&be(s,s,l.xRotVel,Me(1,0,0)),Math.abs(l.yRotVel)>0&&be(s,s,l.yRotVel,Me(0,1,0)),Math.abs(l.zRotVel)>0&&be(s,s,l.zRotVel,Me(0,0,1)),t=e,n=s,r=(i=e)[0],u=i[1],c=i[2],d=(d=n[3]*r+n[7]*u+n[11]*c+n[15])||1,t[0]=(n[0]*r+n[4]*u+n[8]*c+n[12])/d,t[1]=(n[1]*r+n[5]*u+n[9]*c+n[13])/d,t[2]=(n[2]*r+n[6]*u+n[10]*c+n[14])/d,function(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}(a,a,e),{rotationMatrix:s,position:a}}}let We,Je,$e,Ze,et,tt,it,ot,at,nt,st,rt,lt,ut,ct,dt=!0,ht=!1,ft=0,pt=30,mt=!0,_t=[0,5,12];const gt=[169/255,183/255,43/255,1],bt=[0,40/255,166/255,1],vt=[.71875,0,.1796,1],wt=[1,0,138/255,1];let xt=4,yt=310;const Tt={radio:.15,altura:2*xt+2.15},At={radio:.05,altura:2},Et={ancho:1.3,largo:6},Ct={ancho:.1,largo:1.3},Mt={ancho:.1,largo:6},St={filas:1,columnas:10},Pt={filas:1,columnas:1},Ot=St;let It=2*Math.PI;const Vt={filas:20,columnas:70},kt=15.2,Rt={radio:.05,altura:30.4},Lt={radio:.05,altura:.8*Math.sqrt(2)},Bt={filas:1,columnas:8},Ft={radio:2.5,altura:.8},Nt={radioSuperior:2.3,radioInferior:Ft.radio,altura:.1},Dt={filas:1,columnas:30},zt=Dt,Ut={radio:2,altura:4},qt={radioSuperior:1.6,radioInferior:Ut.radio,altura:.7};class jt{constructor(){this.panelesEnEscena=[],this.construirComponentes()}construirComponentes(){this.componentes=[];const e=new qe("panelTapaSuperior",Et,Pt);e.diffuse=bt,this.componentes.push(e);const t=new qe("panelTapaInferior",Et,Pt);t.diffuse=bt,this.componentes.push(t),this.componentes.push(new qe("panelLadoA",Ct,Pt)),this.componentes.push(new qe("panelLadoA1",Ct,Pt)),this.componentes.push(new qe("panelLadoB",Mt,Pt)),this.componentes.push(new qe("panelLadoB1",Mt,Pt))}nuevo(e){const t=[];t.push(new Ne(null,e)),t.push(...this.componentes),this.agregarALaEscena(t),this.panelesEnEscena.push(t)}agregarALaEscena(e){e.forEach((e=>{Je.add(e)}))}removerParPaneles(e=2){let t=0;if(this.panelesEnEscena.length<e)console.error("No hay mas paneles para remover");else for(;t<e;)this.panelesEnEscena.pop().forEach((e=>{Je.remove(e.alias)})),t++}}function Ht(e,t,i){const o=2*Math.PI*t,a=[],n=[],s=[];for(let t=0;t<=i;t++){const r=o*t/i,l=e*Math.cos(r),u=e*Math.sin(r),c=Math.cos(r),d=Math.sin(r),h=-Math.sin(r),f=Math.cos(r);a.push([l,u]),n.push([c,d,0]),s.push([h,f,0])}return{puntos:a,tangentes:s,binormales:n,vectorNormal:[0,0,1]}}class Gt{constructor(e=Gt.BLOQUES_8,t=30,i=8){this.bloqueActual=null,this.pasoDiscretoRecorrido=t,this.divisionesForma=i,this.dictionary={},Gt.TYPES.forEach((e=>{this.dictionary[e]=[]})),this.construirBloques(),this.setType(e)}construirBloques(){const e=this.pasoDiscretoRecorrido,t=this.divisionesForma,i=new Ye;i.iniciarEn(2.2,.6),i.CurvaBezierA(2.2,.8,2,1,1.8,1),i.lineaA(-1.8,1),i.CurvaBezierA(-2,1,-2.2,.8,-2.2,.6),i.lineaA(-2.2,-.6),i.CurvaBezierA(-2.2,-.8,-2,-1,-1.8,-1),i.lineaA(1.8,-1),i.CurvaBezierA(2,-1,2.2,-.8,2.2,-.6),i.lineaA(2.2,.6).curvaCerrada(!0);const o=Yt(t,i),a=o.puntos.length-1,n={filas:e,columnas:a};n.filas=2*e+10;const s=Ht(kt,1,n.filas);this.dictionary[Gt.BLOQUES_8].push(new Xe("bloque8",o,s,n,!0)),n.filas=e,n.filas=2*e;const r=Ht(kt,7/8,n.filas);this.dictionary[Gt.BLOQUES_7].push(new Xe("bloque7",o,r,n,!0)),n.filas=e,this.dictionary[Gt.BLOQUES_7].push(new Qe("bloque7TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_7].push(new Qe("bloque7TapaAtras",o.puntos,{filas:1,columnas:a})),n.filas=e+20;const l=Ht(kt,5/8,n.filas);this.dictionary[Gt.BLOQUES_6].push(new Xe("bloque6",o,l,n,!0)),n.filas=e,n.filas=e-20;const u=Ht(kt,1/8,n.filas);this.dictionary[Gt.BLOQUES_6].push(new Qe("bloque7TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_6].push(new Qe("bloque6TapaAtras",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_6].push(new Xe("bloque61",o,u,n,!0)),this.dictionary[Gt.BLOQUES_6].push(new Qe("bloque61TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_6].push(new Qe("bloque61TapaAtras",o.puntos,{filas:1,columnas:a})),n.filas=e-10;const c=Ht(kt,3/8,n.filas);this.dictionary[Gt.BLOQUES_5].push(new Xe("bloque5",o,c,n,!0)),n.filas=e-20,this.dictionary[Gt.BLOQUES_5].push(new Qe("bloque7TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_5].push(new Qe("bloque5TapaAtras",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_5].push(new Xe("bloque61",o,u,n,!0)),this.dictionary[Gt.BLOQUES_5].push(new Qe("bloque61TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_5].push(new Qe("bloque61TapaAtras",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_5].push(new Xe("bloque51",o,u,n,!0)),this.dictionary[Gt.BLOQUES_5].push(new Qe("bloque51TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_5].push(new Qe("bloque51TapaAtras",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_4].push(new Xe("bloque4",o,u,n,!0)),this.dictionary[Gt.BLOQUES_4].push(new Qe("bloque4TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_4].push(new Qe("bloque4TapaAtras",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_4].push(new Xe("bloque4",o,u,n,!0)),this.dictionary[Gt.BLOQUES_4].push(new Qe("bloque4TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_4].push(new Qe("bloque4TapaAtras",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_4].push(new Xe("bloque4",o,u,n,!0)),this.dictionary[Gt.BLOQUES_4].push(new Qe("bloque4TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_4].push(new Qe("bloque4TapaAtras",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_4].push(new Xe("bloque4",o,u,n,!0)),this.dictionary[Gt.BLOQUES_4].push(new Qe("bloque4TapaAdelante",o.puntos,{filas:1,columnas:a})),this.dictionary[Gt.BLOQUES_4].push(new Qe("bloque4TapaAtras",o.puntos,{filas:1,columnas:a}))}setType(e){~Gt.TYPES.indexOf(e)?this.type=e:console.error(`Bloque type (${e}) not supported`),this.removerBloqueActualDeLaEscena(),this.actualizarEscena()}removerBloqueActualDeLaEscena(){null!=this.bloqueActual&&this.bloqueActual.forEach((e=>{Je.remove(e.alias)}))}actualizarEscena(){this.dictionary[this.type].forEach((e=>{Je.add(e,{diffuse:wt})})),this.bloqueActual=this.dictionary[this.type]}}function Yt(e,t){const{puntos:i,puntosTangentes:o}=t.extraerPuntos(e),a=le.calcularNormales(o);return i.length!==a.length&&(console.error("Se agrega la normal [1,0] al pt:",i[i.length-1]),a.push([1,0])),{puntos:i,normales:a}}function Qt(){Je.add(new ze("tuboPrincipal",Tt,St)),Je.add(new Ue("tapaPrincipal",Tt.radio,Ot));for(let e=0;e<xt;e++)Je.add(new ze("tuboSecundario",At,St)),Je.add(new Ue("tapaSecundaria1",At.radio,Ot)),Je.add(new Ue("tapaSecundaria2",At.radio,Ot)),ot.nuevo("panelSolar1"),ot.nuevo("panelSolar2")}Gt.TYPES=["BLOQUES_8","BLOQUES_7","BLOQUES_6","BLOQUES_5","BLOQUES_4"],Gt.TYPES.forEach((e=>Gt[e]=e));const Xt={nucleoPSTransform:null,nucleoAnilloTransform:null},Kt={naveTransform:null},Wt={tuboTransform:null,tuboSecundarioTransform:null,distanciaRelativaConElTuboPrincipal:3.5,distanciaConElNucleo:4.5,panelTransform:null},Jt={torusTransform:null,distanciaTubosInteriores:kt,sentidoTuboInterior:1,desplazamientoTuboInterior:0,factorDesplazamientoEntreTubosInteriores:3,pastillaTransform:null,alturaTapaSuperior:.9,alturaTapaInferior:.1},$t={bloqueTransform:null,centrarElBloque:.42,distanciaNucleoDelAnilloYNave:Ut.altura+qt.altura,distanciaModuloVioletaYNave:Ut.altura+2*qt.altura+2,posicionBloque:0},Zt={esferaTransform:null,radio:2,angulo:Math.PI/4,posRelativaALaNave:8.8},ei={capsulaTransform:null};class ti{constructor(e=300,t){this.velocidadMediaDeGiro=e,this.anguloEnProceso=-5,this.anguloActual=0,this.intervaloEnGrados=t,this.timeOutIdPool=[],this._GIRO={LINEAL:1,LOG:0},this.MODO_GIRO=this._GIRO.LINEAL}animar(e){const t=le.deRadianesAGrados(e);t%this.intervaloEnGrados==0&&t!==this.anguloEnProceso&&(this.anguloEnProceso=t,this.calcularParametrosYAnimar())}dameUnaVelocidadDeGiroRandom(){return Math.floor(this.velocidadMediaDeGiro*(.5+Math.random()))}dameUnNuevoAngulo(){const e=Math.random(),t=Math.random();let i=Math.random()<.5?yt*(1-e):yt*(1+t);return i=Math.floor(i>360?i%360:i),i<18&&(i=10*i+1),i}elegirUnGiro(e){Math.random()<e?this.MODO_GIRO=this._GIRO.LINEAL:this.MODO_GIRO=this._GIRO.LOG}calcularParametrosYAnimar(){const e=this.dameUnaVelocidadDeGiroRandom(),t=this.dameUnNuevoAngulo();this.anguloActual=t,this.elegirUnGiro(.6),this.cambiarElAnguloRotacionPanelSolar(t,e)}cambiarElAnguloRotacionPanelSolar(e,t){const i=this.anguloActual;let o;0!==t?(o=(yt-e)/t,Math.abs(o)>.02?(yt-=o,i===e?this.timeOutIdPool.push(setTimeout((()=>{this.cambiarElAnguloRotacionPanelSolar(e,t-this.MODO_GIRO)}),10)):(this.limpiarElPool(),this.anguloActual=e,this.cambiarElAnguloRotacionPanelSolar(e,t-this.MODO_GIRO))):this.limpiarElPool()):this.limpiarElPool()}limpiarElPool(){this.timeOutIdPool.forEach((e=>clearTimeout(e))),this.timeOutIdPool=[]}}class ii{constructor(e){this.paramAnillo={pastillaEnElMedio:1.55,factorDeVelocidad:5},this.animacionPanelesSolares=e}setAlias(e){this.alias=e}capsula(){if("capsula"===this.alias){ei.capsulaTransform=et.modelViewMatrix;const{rotationMatrix:e,position:t}=nt.update();at.setFocusCapsula(t),!0===at.focusCamera.Capsula&&Ze.setFocus(t),Ze.setRotationMatrix(e),ge(ei.capsulaTransform,ei.capsulaTransform,t),_e(ei.capsulaTransform,ei.capsulaTransform,e),be(ei.capsulaTransform,ei.capsulaTransform,Math.PI,[1,0,0])}else if("capsulaCuerpoCilindroA"===this.alias){const e=et.modelViewMatrix;ge(e,ei.capsulaTransform,[0,0,.1]),be(e,e,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroB"===this.alias){const e=et.modelViewMatrix;ge(e,ei.capsulaTransform,[0,0,.3]),be(e,e,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoBezierA"===this.alias)be(et.modelViewMatrix,ei.capsulaTransform,Math.PI/2,[0,0,1]);else if("capsulaCuerpoCilindroC"===this.alias){const e=et.modelViewMatrix;ge(e,ei.capsulaTransform,[0,0,2.51]),be(e,e,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroD"===this.alias){const e=et.modelViewMatrix;ge(e,ei.capsulaTransform,[0,0,2.9]),be(e,e,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroE"===this.alias){const e=et.modelViewMatrix;ge(e,ei.capsulaTransform,[0,0,2.901]),be(e,e,-Math.PI/2,[1,0,0])}else if("capsulaCola"===this.alias)ge(et.modelViewMatrix,ei.capsulaTransform,[0,0,.2]);else if("capsulaFuegoCola"===this.alias){const e=et.modelViewMatrix;be(e,ei.capsulaTransform,-Math.PI/2,[0,0,1]),ge(e,e,[0,0,ei.curvaColav0x+.5+.2]),be(e,e,-Math.PI/2,[1,0,0])}else if("capsulaFuegoCuerpo"===this.alias){const e=et.modelViewMatrix;ge(e,ei.capsulaTransform,[0,0,ei.CilAaltura+ei.FuegoCuerpoAltura]),be(e,e,-Math.PI/2,[1,0,0])}}esfera(){if("esfera"===this.alias)Zt.esferaTransform=et.modelViewMatrix,ge(Zt.esferaTransform,Kt.naveTransform,[0,0,-Zt.posRelativaALaNave]);else if("esferaTapaAtras"===this.alias){const e=et.modelViewMatrix;ge(e,Zt.esferaTransform,[0,0,Zt.radio*Math.cos(Zt.angulo)]),be(e,e,Math.PI/2,[1,0,0])}else if("esferaTapaAdelante"===this.alias){const e=et.modelViewMatrix;ge(e,Zt.esferaTransform,[0,0,-Zt.radio*Math.cos(Zt.angulo)]),be(e,e,Math.PI/2,[-1,0,0])}}bloques(){if("bloque7"===this.alias)$t.bloqueTransform=et.modelViewMatrix,be($t.bloqueTransform,Jt.pastillaTransform,-3*Math.PI/8,[0,1,0]),ge($t.bloqueTransform,$t.bloqueTransform,[0,$t.centrarElBloque,0]),be($t.bloqueTransform,$t.bloqueTransform,Math.PI/2,[1,0,0]);else if("bloque7TapaAdelante"===this.alias){const e=et.modelViewMatrix;ge(e,$t.bloqueTransform,[kt,0,0]),be(e,e,Math.PI,[1,0,1])}else if("bloque7TapaAtras"===this.alias){const e=et.modelViewMatrix;ge(e,$t.bloqueTransform,[kt/Math.sqrt(2),-15.2/Math.sqrt(2),0]),be(e,e,Math.PI,[1,0,1]),be(e,e,3*Math.PI/4,[1,0,0])}else if("bloque8"===this.alias)$t.bloqueTransform=et.modelViewMatrix,ge($t.bloqueTransform,Jt.pastillaTransform,[0,$t.centrarElBloque,0]),be($t.bloqueTransform,$t.bloqueTransform,Math.PI/2,[1,0,0]);else if("bloque6"===this.alias){$t.bloqueTransform=et.modelViewMatrix;const e=-157.5*Math.PI/180;be($t.bloqueTransform,Jt.pastillaTransform,e,[0,1,0]),ge($t.bloqueTransform,$t.bloqueTransform,[0,$t.centrarElBloque,0]),be($t.bloqueTransform,$t.bloqueTransform,Math.PI/2,[1,0,0])}else if("bloque6TapaAtras"===this.alias){const e=et.modelViewMatrix,t=45,i=kt*Math.sin(t*Math.PI/180),o=kt*Math.cos(t*Math.PI/180);ge(e,$t.bloqueTransform,[-o,-i,0]),be(e,e,Math.PI,[1,0,1]),be(e,e,t*Math.PI/180,[1,0,0])}else if("bloque61"===this.alias){const e=et.modelViewMatrix,t=-90*Math.PI/180;be(e,$t.bloqueTransform,t,[0,0,1])}else if("bloque61TapaAdelante"===this.alias){const e=et.modelViewMatrix,t=135,i=kt*Math.sin(t*Math.PI/180),o=kt*Math.cos(t*Math.PI/180);ge(e,$t.bloqueTransform,[-o,-i,0]),be(e,e,Math.PI,[1,0,1]),be(e,e,t*Math.PI/180,[1,0,0])}else if("bloque61TapaAtras"===this.alias){const e=et.modelViewMatrix,t=90,i=kt*Math.sin(t*Math.PI/180),o=kt*Math.cos(t*Math.PI/180);ge(e,$t.bloqueTransform,[-o,-i,0]),be(e,e,Math.PI,[1,0,-1]),be(e,e,t*Math.PI/180,[1,0,0])}else if("bloque5"===this.alias){$t.bloqueTransform=et.modelViewMatrix;const e=112.5*Math.PI/180;be($t.bloqueTransform,Jt.pastillaTransform,e,[0,1,0]),ge($t.bloqueTransform,$t.bloqueTransform,[0,$t.centrarElBloque,0]),be($t.bloqueTransform,$t.bloqueTransform,Math.PI/2,[1,0,0])}else if("bloque5TapaAtras"===this.alias){const e=et.modelViewMatrix,t=-45,i=kt*Math.sin(t*Math.PI/180),o=kt*Math.cos(t*Math.PI/180);ge(e,$t.bloqueTransform,[-o,-i,0]),be(e,e,Math.PI,[1,0,1]),be(e,e,t*Math.PI/180,[1,0,0])}else if("bloque51"===this.alias){const e=et.modelViewMatrix,t=-180*Math.PI/180;be(e,$t.bloqueTransform,t,[0,0,1])}else if("bloque51TapaAdelante"===this.alias){const e=et.modelViewMatrix,t=45,i=kt*Math.sin(t*Math.PI/180),o=kt*Math.cos(t*Math.PI/180);ge(e,$t.bloqueTransform,[-o,-i,0]),be(e,e,Math.PI,[1,0,1]),be(e,e,t*Math.PI/180,[1,0,0])}else if("bloque51TapaAtras"===this.alias){const e=et.modelViewMatrix,t=0,i=kt*Math.sin(t*Math.PI/180),o=kt*Math.cos(t*Math.PI/180);ge(e,$t.bloqueTransform,[-o,-i,0]),be(e,e,Math.PI/2,[0,1,0])}else if("bloque4"===this.alias){$t.bloqueTransform=et.modelViewMatrix;const e=(22.5+90*$t.posicionBloque)*Math.PI/180;be($t.bloqueTransform,Jt.pastillaTransform,e,[0,1,0]),ge($t.bloqueTransform,$t.bloqueTransform,[0,$t.centrarElBloque,0]),be($t.bloqueTransform,$t.bloqueTransform,Math.PI/2,[1,0,0]),$t.posicionBloque++}else if("bloque4TapaAdelante"===this.alias){const e=et.modelViewMatrix,t=0,i=kt*Math.sin(t*Math.PI/180),o=kt*Math.cos(t*Math.PI/180);ge(e,$t.bloqueTransform,[o,i,0]),be(e,e,Math.PI,[1,0,1])}else if("bloque4TapaAtras"===this.alias){const e=et.modelViewMatrix,t=45,i=kt*Math.sin(t*Math.PI/180),o=kt*Math.cos(t*Math.PI/180);ge(e,$t.bloqueTransform,[o,i,0]),be(e,e,Math.PI,[1,0,-1]),be(e,e,135*Math.PI/180,[1,0,0])}}modulosVioleta(){"moduloVioletaPS"===this.alias?ge(et.modelViewMatrix,Kt.naveTransform,[0,0,0]):"moduloVioletaAnillo"===this.alias&&ge(et.modelViewMatrix,Kt.naveTransform,[0,0,-$t.distanciaModuloVioletaYNave])}nucleoDelPanelSolar(){const e=2+qt.altura;if("nucleoPS"===this.alias)Xt.nucleoPSTransform=et.modelViewMatrix,ge(Xt.nucleoPSTransform,Kt.naveTransform,[0,0,e]),be(Xt.nucleoPSTransform,Xt.nucleoPSTransform,Math.PI/2,[1,0,0]);else if("nucleoPSCilindroSup"===this.alias){const e=et.modelViewMatrix;be(e,Xt.nucleoPSTransform,Math.PI/2,[0,1,0]),ge(e,e,[0,Ut.altura,0])}else if("nucleoPSCilindroInf"===this.alias){const e=et.modelViewMatrix;be(e,Xt.nucleoPSTransform,-Math.PI/2,[0,1,0]),be(e,e,-Math.PI,[1,0,0])}else if("nucleoPSTapaSup"===this.alias)ge(et.modelViewMatrix,Xt.nucleoPSTransform,[0,Ut.altura+qt.altura,0]);else if("nucleoPSTapaInf"===this.alias){const e=et.modelViewMatrix;be(e,Xt.nucleoPSTransform,Math.PI,[1,0,0]),ge(e,e,[0,qt.altura,0])}}panelesSolares(){if("tuboPrincipal"===this.alias)Wt.tuboTransform=et.modelViewMatrix,ge(Wt.tuboTransform,Xt.nucleoPSTransform,[0,Wt.distanciaConElNucleo,0]);else if("tapaPrincipal"===this.alias)ge(et.modelViewMatrix,Wt.tuboTransform,[0,Tt.altura,0]);else if("tuboSecundario"===this.alias)Wt.tuboSecundarioTransform=et.modelViewMatrix,ge(Wt.tuboSecundarioTransform,Wt.tuboTransform,[At.altura/2,Wt.distanciaRelativaConElTuboPrincipal,0]),xe(Wt.tuboSecundarioTransform,Wt.tuboSecundarioTransform,Math.PI/2),Wt.distanciaRelativaConElTuboPrincipal+=2;else if("tapaSecundaria1"===this.alias)ge(et.modelViewMatrix,Wt.tuboSecundarioTransform,[0,At.altura,0]);else if("tapaSecundaria2"===this.alias){const e=et.modelViewMatrix;ge(e,Wt.tuboSecundarioTransform,[0,0,0]),ve(e,e,Math.PI)}else if("panelSolar1"===this.alias)Wt.panelTransform=et.modelViewMatrix,ge(Wt.panelTransform,Wt.tuboSecundarioTransform,[0,-Et.largo/2,0]),ve(Wt.panelTransform,Wt.panelTransform,-Math.PI/2),xe(Wt.panelTransform,Wt.panelTransform,2*Math.PI*yt/360);else if("panelSolar2"===this.alias)Wt.panelTransform=et.modelViewMatrix,ge(Wt.panelTransform,Wt.tuboSecundarioTransform,[0,At.altura+Et.largo/2,0]),ve(Wt.panelTransform,Wt.panelTransform,-Math.PI/2),xe(Wt.panelTransform,Wt.panelTransform,2*Math.PI*yt/360);else if("panelTapaSuperior"===this.alias)ge(et.modelViewMatrix,Wt.panelTransform,[0,Ct.ancho,0]);else if("panelTapaInferior"===this.alias)be(et.modelViewMatrix,Wt.panelTransform,Math.PI,[1,0,0]);else if("panelLadoA"===this.alias){const e=et.modelViewMatrix;ge(e,Wt.panelTransform,[0,Ct.ancho/2,Et.largo/2]),be(e,e,Math.PI/2,[0,0,1]),be(e,e,Math.PI,[0,1,1])}else if("panelLadoA1"===this.alias){const e=et.modelViewMatrix;ge(e,Wt.panelTransform,[0,Ct.ancho/2,-Et.largo/2]),be(e,e,Math.PI/2,[1,0,0]),be(e,e,-Math.PI,[1,0,1])}else if("panelLadoB"===this.alias){const e=et.modelViewMatrix;ge(e,Wt.panelTransform,[Ct.largo/2,Ct.ancho/2,0]),be(e,e,Math.PI,[1,1,0])}else if("panelLadoB1"===this.alias){const e=et.modelViewMatrix;ge(e,Wt.panelTransform,[-Ct.largo/2,Ct.ancho/2,0]),be(e,e,-Math.PI,[0,0,1]),be(e,e,-Math.PI,[1,1,0])}}nucleoDelAnillo(){if("nucleoAnillo"===this.alias)Xt.nucleoAnilloTransform=et.modelViewMatrix,ge(Xt.nucleoAnilloTransform,Kt.naveTransform,[0,0,-$t.distanciaNucleoDelAnilloYNave]),be(Xt.nucleoAnilloTransform,Xt.nucleoAnilloTransform,Math.PI/2,[1,0,0]);else if("nucleoAnilloCilindroSup"===this.alias){const e=et.modelViewMatrix;be(e,Xt.nucleoAnilloTransform,Math.PI/2,[0,1,0]),ge(e,e,[0,Ut.altura,0])}else if("nucleoAnilloCilindroInf"===this.alias){const e=et.modelViewMatrix;be(e,Xt.nucleoAnilloTransform,-Math.PI/2,[0,1,0]),be(e,e,-Math.PI,[1,0,0])}else if("nucleoAnilloTapaSup"===this.alias)ge(et.modelViewMatrix,Xt.nucleoAnilloTransform,[0,Ut.altura+qt.altura,0]);else if("nucleoAnilloTapaInf"===this.alias){const e=et.modelViewMatrix;be(e,Xt.nucleoAnilloTransform,Math.PI,[1,0,0]),ge(e,e,[0,qt.altura,0])}}anillo(){if("pastillaCuerpo"===this.alias){Jt.pastillaTransform=et.modelViewMatrix;const e=ft/this.paramAnillo.factorDeVelocidad;be(Jt.pastillaTransform,Xt.nucleoAnilloTransform,e,[0,1,0]),ge(Jt.pastillaTransform,Jt.pastillaTransform,[0,this.paramAnillo.pastillaEnElMedio,0]),mt&&this.animacionPanelesSolares.animar(e)}else if("pastillaCilindroSup"===this.alias){const e=et.modelViewMatrix;be(e,Jt.pastillaTransform,Math.PI/2,[0,1,0]),ge(e,e,[0,Ft.altura,0])}else if("pastillaCilindroInf"===this.alias){const e=et.modelViewMatrix;be(e,Jt.pastillaTransform,-Math.PI,[1,0,0]),be(e,e,Math.PI/2,[0,1,0])}else if("pastillaTapaSup"===this.alias){const e=et.modelViewMatrix;be(e,Jt.pastillaTransform,0,[1,0,0]),ge(e,e,[0,Jt.alturaTapaSuperior,0])}else if("pastillaTapaInf"===this.alias){const e=et.modelViewMatrix;be(e,Jt.pastillaTransform,-Math.PI,[1,0,0]),ge(e,e,[0,Jt.alturaTapaInferior,0])}else if("torus"===this.alias)Jt.torusTransform=et.modelViewMatrix,ge(Jt.torusTransform,Jt.pastillaTransform,[0,Ft.altura/2,0]),be(Jt.torusTransform,Jt.torusTransform,Math.PI/2,[1,0,0]);else if("anillo_tuboH1"===this.alias)ge(et.modelViewMatrix,Jt.torusTransform,[-.4,-Rt.altura/2,0]);else if("anillo_tuboH2"===this.alias)ge(et.modelViewMatrix,Jt.torusTransform,[.4,-Rt.altura/2,0]);else if("anillo_tuboV1"===this.alias){const e=et.modelViewMatrix;ge(e,Jt.torusTransform,[Rt.altura/2,.4,0]),be(e,e,Math.PI/2,[0,0,1])}else if("anillo_tuboV2"===this.alias){const e=et.modelViewMatrix;ge(e,Jt.torusTransform,[Rt.altura/2,-.4,0]),be(e,e,Math.PI/2,[0,0,1])}else if("anillo_tuboInterior"===this.alias){const e=et.modelViewMatrix;Jt.desplazamientoTuboInterior<Rt.altura?ge(e,Jt.torusTransform,[0,Jt.distanciaTubosInteriores-Jt.desplazamientoTuboInterior,0]):ge(e,Jt.torusTransform,[Jt.factorDesplazamientoEntreTubosInteriores*Jt.distanciaTubosInteriores-Jt.desplazamientoTuboInterior,0,0]),be(e,e,Jt.sentidoTuboInterior*Math.PI/4,[0,0,1]),ge(e,e,[0,-Lt.altura/2,0]),Jt.sentidoTuboInterior*=-1,Jt.desplazamientoTuboInterior+=.8}}}function oi(){We.viewport(0,0,We.canvas.width,We.canvas.height),We.clear(We.COLOR_BUFFER_BIT|We.DEPTH_BUFFER_BIT),et.updatePerspective();try{We.uniform1i($e.uUpdateLight,!1),Je.traverse((e=>{et.calculateModelView(),et.push(),"floor"!==e.alias&&"axis"!==e.alias&&(e.wireframe=ht),tt.setAlias(e.alias),"nave"===e.alias&&(Kt.naveTransform=et.modelViewMatrix,st=[0,0,0],rt=[0,0,15.5],at.setFocus(st,rt),!0===at.focusCamera.Nave?Ze.setFocus(st):!0===at.focusCamera.PanelesSolares&&Ze.setFocus(rt)),tt.nucleoDelPanelSolar(),tt.panelesSolares(),tt.nucleoDelAnillo(),tt.anillo(),tt.bloques(),tt.modulosVioleta(),tt.esfera(),tt.capsula(),et.setMatrixUniforms(),et.pop(),function(e){if(We.uniform4fv($e.uMaterialDiffuse,e.diffuse),We.uniform4fv($e.uMaterialSpecular,e.specular),We.uniform4fv($e.uMaterialAmbient,e.ambient),We.uniform1i($e.uWireframe,e.wireframe),We.bindVertexArray(e.vao),We.bindBuffer(We.ELEMENT_ARRAY_BUFFER,e.ibo),e.wireframe)"floor"===e.alias||"axis"===e.alias?We.drawElements(We.LINES,e.indices.length,We.UNSIGNED_SHORT,0):We.drawElements(We.LINE_STRIP,e.indices.length,We.UNSIGNED_SHORT,0);else{const t=dt?We.TRIANGLE_STRIP:We.TRIANGLES;We.drawElements(t,e.indices.length,We.UNSIGNED_SHORT,0)}We.bindVertexArray(null),We.bindBuffer(We.ARRAY_BUFFER,null),We.bindBuffer(We.ELEMENT_ARRAY_BUFFER,null)}(e)})),$t.posicionBloque=0,Wt.distanciaRelativaConElTuboPrincipal=3.5,Jt.sentidoTuboInterior=1,Jt.desplazamientoTuboInterior=0}catch(e){console.error(e)}}function ai(){if(lt=(new Date).getTime()-ut,lt<30)return;let e=Math.floor(lt/30);for(;e>0;)ft+=.01,oi(),e-=1;ut=(new Date).getTime()}ct=30,window.onload=function(){!function(){const e=le.getCanvas("webgl-canvas");le.autoResizeCanvas(e),We=le.getGLContext(e),We.clearColor(.9,.9,.9,1),We.clearDepth(100),We.enable(We.DEPTH_TEST),We.depthFunc(We.LEQUAL),$e=new ye(We,"vertex-shader","fragment-shader"),$e.load(["aVertexPosition","aVertexNormal","aVertexColor"],["uProjectionMatrix","uModelViewMatrix","uNormalMatrix","uMaterialDiffuse","uMaterialAmbient","uMaterialSpecular","uLightAmbient","uLightDiffuse","uLightSpecular","uLightPosition","uShininess","uUpdateLight","uWireframe"]),Je=new Te(We,$e),Ze=new Re(Re.ORBITING_TYPE,70,0),Ze.goTo([0,0,40],0,0,[0,0,0]),nt=new Ke([0,0,-10],Ze),at=new Le(Ze,e,nt),et=new Be(We,$e,Ze,e),We.uniform3fv($e.uLightPosition,_t),We.uniform4fv($e.uLightAmbient,[.2,.2,.2,1]),We.uniform4fv($e.uLightDiffuse,[1,1,1,1]),We.uniform4fv($e.uLightSpecular,[1,1,1,1]),We.uniform1f($e.uShininess,230),tt=new ii(new ti(300,pt))}(),function(){Je.add(new Ae(80,2)),Je.add(new Ee(82));const e=new Ne(null,"nave");Je.add(e),Je.add(new ze("nucleoPS",Ut,zt),{diffuse:vt}),Je.add(new De("nucleoPSCilindroSup",qt,zt),{diffuse:vt}),Je.add(new De("nucleoPSCilindroInf",qt,zt),{diffuse:vt}),Je.add(new Ue("nucleoPSTapaSup",qt.radioSuperior,zt),{diffuse:vt}),Je.add(new Ue("nucleoPSTapaInf",qt.radioSuperior,zt),{diffuse:vt}),Je.add(new ze("nucleoAnillo",Ut,zt),{diffuse:vt}),Je.add(new De("nucleoAnilloCilindroSup",qt,zt),{diffuse:vt}),Je.add(new De("nucleoAnilloCilindroInf",qt,zt),{diffuse:vt}),Je.add(new Ue("nucleoAnilloTapaSup",qt.radioSuperior,zt),{diffuse:vt}),Je.add(new Ue("nucleoAnilloTapaInf",qt.radioSuperior,zt),{diffuse:vt}),ot=new jt,Qt(),function(){Je.add(new ze("pastillaCuerpo",Ft,Dt),{diffuse:gt}),Je.add(new De("pastillaCilindroSup",Nt,Dt),{diffuse:gt}),Je.add(new De("pastillaCilindroInf",Nt,Dt),{diffuse:gt}),Je.add(new Ue("pastillaTapaSup",Nt.radioSuperior,Dt),{diffuse:gt}),Je.add(new Ue("pastillaTapaInf",Nt.radioSuperior,Dt),{diffuse:gt}),Je.add(new je("torus",kt,.8,Vt,It)),Je.add(new ze("anillo_tuboH1",Rt,Bt)),Je.add(new ze("anillo_tuboH2",Rt,Bt)),Je.add(new ze("anillo_tuboV1",Rt,Bt)),Je.add(new ze("anillo_tuboV2",Rt,Bt));const e=2*Math.ceil(Rt.altura/.8);for(let t=0;t<e;t++)Je.add(new ze("anillo_tuboInterior",Lt,Bt))}(),it=new Gt(Gt.BLOQUES_4),function(){const e=new Ge([0,0],[.666,0],[1.333,0],[2,0]),t=new Ye;t.iniciarEn(1,.5).CurvaBezierA(1,.8,.8,1,.5,1).lineaA(-.5,1).CurvaBezierA(-.8,1,-1,.8,-1,.5).lineaA(-1,-.5).CurvaBezierA(-1,-.8,-.8,-1,-.5,-1).lineaA(.5,-1).CurvaBezierA(.8,-1,1,-.8,1,-.5).lineaA(1,.5).curvaCerrada(!0);const i=function(e,t,i=[1,0,0]){const{puntos:o,puntosTangentes:a}=t.extraerPuntos(e),n=le.pasarTanAVector3(a),s=i,r=le.calcularVectorBinormal(s,n);return o.length===a.length&&a.length===r.length||console.error("No coinciden puntos, tangentes y binormales",o.length,a.length,r.length),{puntos:o,tangentes:n,binormales:r,vectorNormal:s}}(1,e),o=Yt(8,t),a={filas:1,columnas:o.puntos.length-1};Je.add(new Xe("moduloVioletaPS",o,i,a),{diffuse:wt}),Je.add(new Xe("moduloVioletaAnillo",o,i,a),{diffuse:wt})}(),function(){const e=Zt.radio,t=Ht(e,2/8,20),i=Zt.angulo,o={puntos:t.puntos.map((e=>[e[0]*Math.cos(i)-e[1]*Math.sin(i),e[0]*Math.sin(i)+e[1]*Math.cos(i)])),normales:t.binormales.map((e=>[e[0]*Math.cos(i)-e[1]*Math.sin(i),e[0]*Math.sin(i)+e[1]*Math.cos(i)]))},a={filas:30,columnas:o.puntos.length-1},n=Ht(0,1,a.filas),s=new Xe("esfera",o,n,a,!0);Je.add(s),Je.add(new Ue("esferaTapaAtras",e*Math.sin(i),{filas:1,columnas:30}),{diffuse:vt}),Je.add(new Ue("esferaTapaAdelante",e*Math.sin(i),{filas:1,columnas:30}),{diffuse:vt})}(),function(){const e=[[247,144/255,0,1],[247,90/255,0,1],[247,19/255,0,1]],t={filas:1,columnas:30},i=new Ne(null,"capsula");Je.add(i),ei.curvaColav0x=-1.99;const o=new Ge([ei.curvaColav0x,.78],[-1.2,.785],[-.66,.52],[-.14,.18]).extraerPuntos(10),a={puntos:o.puntos,normales:o.puntosTangentes.map((e=>[-e[1],e[0]]))},n={filas:30,columnas:a.puntos.length-1},s=Ht(0,1,n.filas),r=new Xe("capsulaCola",a,s,n,!0);Je.add(r,{diffuse:e[1]});const l=new De("capsulaFuegoCola",{radioSuperior:.78,radioInferior:.05,altura:.5},t,!0);Je.add(l,{diffuse:e[2]});const u=new Ge([.3,1.5],[1.185,1.44],[1.844,1.185],[2.5,.7]).extraerPuntos(10),c={puntos:u.puntos,normales:u.puntosTangentes.map((e=>[-e[1],e[0]]))},d=c.puntos.length-1,h=new Xe("capsulaCuerpoBezierA",c,s,{filas:30,columnas:d},!0);Je.add(h),ei.CilAaltura=.1;const f=new De("capsulaCuerpoCilindroA",{radioSuperior:.4,radioInferior:1.2,altura:ei.CilAaltura},t);Je.add(f);const p=new De("capsulaCuerpoCilindroB",{radioSuperior:1.2,radioInferior:1.5,altura:.2},t);Je.add(p);const m=new De("capsulaCuerpoCilindroC",{radioSuperior:.7,radioInferior:.6,altura:.01},t);Je.add(m);const _=new De("capsulaCuerpoCilindroD",{radioSuperior:.6,radioInferior:.4,altura:2.9-2.51},t);Je.add(_,{diffuse:vt});const g=new De("capsulaCuerpoCilindroE",{radioSuperior:.4,radioInferior:0,altura:.001},t);Je.add(g),ei.FuegoCuerpoAltura=.5;const b=new De("capsulaFuegoCuerpo",{radioSuperior:1.2,radioInferior:.05,altura:ei.FuegoCuerpoAltura},t,!0);Je.add(b,{diffuse:e[0]})}()}(),ut=(new Date).getTime(),setInterval(ai,.03),le.configureControls({Bloques:{value:it.type,options:[Gt.BLOQUES_4,Gt.BLOQUES_5,Gt.BLOQUES_6,Gt.BLOQUES_7,Gt.BLOQUES_8],onChange:e=>{it.setType(e)}},PanelesSolares:{Filas:{value:xt,min:1,max:10,step:1,onChange:e=>{!function(){Je.remove("tuboPrincipal"),Je.remove("tapaPrincipal");for(let e=0;e<xt;e++)Je.remove("tuboSecundario"),Je.remove("tapaSecundaria1"),Je.remove("tapaSecundaria2"),ot.removerParPaneles()}(),xt=e,Tt.altura=2*xt+2.15,Qt()}},Angulo:{value:yt,min:0,max:360,step:1,onChange:e=>yt=e},AnimarPaneles:{value:mt,onChange:e=>mt=e},IntervaloAnimacion:{value:pt,min:15,max:45,step:15,onChange:e=>pt=e}},Wireframe:()=>{ht=!ht},"Triangle Strip":{value:dt,onChange:e=>dt=e}},{closed:!1})}})();
//# sourceMappingURL=bundle.d19775a56f61b836bace.js.map