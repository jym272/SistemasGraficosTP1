(()=>{"use strict";const e={profundidadModuloVioleta:2,NucleoPS:{radio:2,altura:4},CilindroNucleoPS:{radioSuperior:1.6,radioInferior:2,altura:.7},anillo:{radio:15.2,radioInterior:.8,distanciaEntreTubos:.4,tubo:{radio:.05,altura:30.4},tuboInterior:{radio:.05,altura:.8*Math.sqrt(2)}},panelSolar:{tapa:{ancho:1.3,largo:6},filasDeTubosSecundarios:4,distanciaEntreTubosSecundarios:2,fc:2.15,tuboPrincipal:{radio:.15,altura:0},tuboSecundario:{radio:.05,altura:2},lado:{ancho:.1,largo:1.3}},pastillas:{cuerpo:{radio:2.5,altura:.8}}};function t(e,t){var o=e.__state.conversionName.toString(),a=Math.round(e.r),n=Math.round(e.g),i=Math.round(e.b),r=e.a,s=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===o||"SIX_CHAR_HEX"===o){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===o?"rgb("+a+","+n+","+i+")":"CSS_RGBA"===o?"rgba("+a+","+n+","+i+","+r+")":"HEX"===o?"0x"+e.hex.toString(16):"RGB_ARRAY"===o?"["+a+","+n+","+i+"]":"RGBA_ARRAY"===o?"["+a+","+n+","+i+","+r+"]":"RGB_OBJ"===o?"{r:"+a+",g:"+n+",b:"+i+"}":"RGBA_OBJ"===o?"{r:"+a+",g:"+n+",b:"+i+",a:"+r+"}":"HSV_OBJ"===o?"{h:"+s+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===o?"{h:"+s+",s:"+l+",v:"+u+",a:"+r+"}":"unknown format"}var o=Array.prototype.forEach,a=Array.prototype.slice,n={BREAK:{},extend:function(e){return this.each(a.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(o){this.isUndefined(t[o])||(e[o]=t[o])}.bind(this))}),this),e},defaults:function(e){return this.each(a.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(o){this.isUndefined(e[o])&&(e[o]=t[o])}.bind(this))}),this),e},compose:function(){var e=a.call(arguments);return function(){for(var t=a.call(arguments),o=e.length-1;o>=0;o--)t=[e[o].apply(this,t)];return t[0]}},each:function(e,t,a){if(e)if(o&&e.forEach&&e.forEach===o)e.forEach(t,a);else if(e.length===e.length+0){var n,i=void 0;for(i=0,n=e.length;i<n;i++)if(i in e&&t.call(a,e[i],i)===this.BREAK)return}else for(var r in e)if(t.call(a,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,o){var a=void 0;return function(){var n=this,i=arguments;function r(){a=null,o||e.apply(n,i)}var s=o||!a;clearTimeout(a),a=setTimeout(r,t),s&&e.apply(n,i)}},toArray:function(e){return e.toArray?e.toArray():a.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},i=[{litmus:n.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:t},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:t}}},{litmus:n.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:n.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:n.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(n.isNumber(e.r)&&n.isNumber(e.g)&&n.isNumber(e.b)&&n.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(n.isNumber(e.r)&&n.isNumber(e.g)&&n.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(n.isNumber(e.h)&&n.isNumber(e.s)&&n.isNumber(e.v)&&n.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(n.isNumber(e.h)&&n.isNumber(e.s)&&n.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],r=void 0,s=void 0,l=function(){s=!1;var e=arguments.length>1?n.toArray(arguments):arguments[0];return n.each(i,(function(t){if(t.litmus(e))return n.each(t.conversions,(function(t,o){if(r=t.read(e),!1===s&&!1!==r)return s=r,r.conversionName=o,r.conversion=t,n.BREAK})),n.BREAK})),s},u=void 0,c={hsv_to_rgb:function(e,t,o){var a=Math.floor(e/60)%6,n=e/60-Math.floor(e/60),i=o*(1-t),r=o*(1-n*t),s=o*(1-(1-n)*t),l=[[o,s,i],[r,o,i],[i,o,s],[i,r,o],[s,i,o],[o,i,r]][a];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,o){var a=Math.min(e,t,o),n=Math.max(e,t,o),i=n-a,r=void 0;return 0===n?{h:NaN,s:0,v:0}:(r=e===n?(t-o)/i:t===n?2+(o-e)/i:4+(e-t)/i,(r/=6)<0&&(r+=1),{h:360*r,s:i/n,v:n/255})},rgb_to_hex:function(e,t,o){var a=this.hex_with_component(0,2,e);return a=this.hex_with_component(a,1,t),this.hex_with_component(a,0,o)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,o){return o<<(u=8*t)|e&~(255<<u)}},d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,o,a){return o&&e(t.prototype,o),a&&e(t,a),t}}(),f=function e(t,o,a){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,a)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(a):void 0},m=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},g=function(){function e(){if(h(this,e),this.__state=l.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return p(e,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function b(e,t,o){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||g.recalculateRGB(this,t,o),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(g.recalculateRGB(this,t,o),this.__state.space="RGB"),this.__state[t]=e}})}function v(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||g.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(g.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}g.recalculateRGB=function(e,t,o){if("HEX"===e.__state.space)e.__state[t]=c.component_from_hex(e.__state.hex,o);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");n.extend(e.__state,c.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},g.recalculateHSV=function(e){var t=c.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:t.s,v:t.v}),n.isNaN(t.h)?n.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},g.COMPONENTS=["r","g","b","h","s","v","hex","a"],b(g.prototype,"r",2),b(g.prototype,"g",1),b(g.prototype,"b",0),v(g.prototype,"h"),v(g.prototype,"s"),v(g.prototype,"v"),Object.defineProperty(g.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(g.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=c.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var x=function(){function e(t,o){h(this,e),this.initialValue=t[o],this.domElement=document.createElement("div"),this.object=t,this.property=o,this.__onChange=void 0,this.__onFinishChange=void 0}return p(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),T={};n.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){n.each(e,(function(e){T[e]=t}))}));var w=/(\d+(\.\d+)?)px/;function E(e){if("0"===e||n.isUndefined(e))return 0;var t=e.match(w);return n.isNull(t)?0:parseFloat(t[1])}var y={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,o){var a=o,i=t;n.isUndefined(i)&&(i=!0),n.isUndefined(a)&&(a=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),a&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,o,a){var i=o||{},r=T[t];if(!r)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(r);switch(r){case"MouseEvents":var l=i.x||i.clientX||0,u=i.y||i.clientY||0;s.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,l,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;n.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(t,i.bubbles||!1,i.cancelable||!0)}n.defaults(s,a),e.dispatchEvent(s)},bind:function(e,t,o,a){var n=a||!1;return e.addEventListener?e.addEventListener(t,o,n):e.attachEvent&&e.attachEvent("on"+t,o),y},unbind:function(e,t,o,a){var n=a||!1;return e.removeEventListener?e.removeEventListener(t,o,n):e.detachEvent&&e.detachEvent("on"+t,o),y},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var o=e.className.split(/ +/);-1===o.indexOf(t)&&(o.push(t),e.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return y},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var o=e.className.split(/ +/),a=o.indexOf(t);-1!==a&&(o.splice(a,1),e.className=o.join(" "))}else e.className=void 0;return y},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return E(t["border-left-width"])+E(t["border-right-width"])+E(t["padding-left"])+E(t["padding-right"])+E(t.width)},getHeight:function(e){var t=getComputedStyle(e);return E(t["border-top-width"])+E(t["border-bottom-width"])+E(t["padding-top"])+E(t["padding-bottom"])+E(t.height)},getOffset:function(e){var t=e,o={left:0,top:0};if(t.offsetParent)do{o.left+=t.offsetLeft,o.top+=t.offsetTop,t=t.offsetParent}while(t);return o},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},A=function(e){function t(e,o){h(this,t);var a=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),n=a;return a.__prev=a.getValue(),a.__checkbox=document.createElement("input"),a.__checkbox.setAttribute("type","checkbox"),y.bind(a.__checkbox,"change",(function(){n.setValue(!n.__prev)}),!1),a.domElement.appendChild(a.__checkbox),a.updateDisplay(),a}return m(t,e),p(t,[{key:"setValue",value:function(e){var o=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),o}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(x),C=function(e){function t(e,o,a){h(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),r=a,s=i;if(i.__select=document.createElement("select"),n.isArray(r)){var l={};n.each(r,(function(e){l[e]=e})),r=l}return n.each(r,(function(e,t){var o=document.createElement("option");o.innerHTML=t,o.setAttribute("value",e),s.__select.appendChild(o)})),i.updateDisplay(),y.bind(i.__select,"change",(function(){var e=this.options[this.selectedIndex].value;s.setValue(e)})),i.domElement.appendChild(i.__select),i}return m(t,e),p(t,[{key:"setValue",value:function(e){var o=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),o}},{key:"updateDisplay",value:function(){return y.isActive(this.__select)?this:(this.__select.value=this.getValue(),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(x),S=function(e){function t(e,o){h(this,t);var a=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),n=a;function i(){n.setValue(n.__input.value)}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),y.bind(a.__input,"keyup",i),y.bind(a.__input,"change",i),y.bind(a.__input,"blur",(function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())})),y.bind(a.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return m(t,e),p(t,[{key:"updateDisplay",value:function(){return y.isActive(this.__input)||(this.__input.value=this.getValue()),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(x);function M(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var P=function(e){function t(e,o,a){h(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),r=a||{};return i.__min=r.min,i.__max=r.max,i.__step=r.step,n.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=M(i.__impliedStep),i}return m(t,e),p(t,[{key:"setValue",value:function(e){var o=e;return void 0!==this.__min&&o<this.__min?o=this.__min:void 0!==this.__max&&o>this.__max&&(o=this.__max),void 0!==this.__step&&o%this.__step!=0&&(o=Math.round(o/this.__step)*this.__step),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,o)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=M(e),this}}]),t}(x),R=function(e){function t(e,o,a){h(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,a));i.__truncationSuspended=!1;var r=i,s=void 0;function l(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function u(e){var t=s-e.clientY;r.setValue(r.getValue()+t*r.__impliedStep),s=e.clientY}function c(){y.unbind(window,"mousemove",u),y.unbind(window,"mouseup",c),l()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),y.bind(i.__input,"change",(function(){var e=parseFloat(r.__input.value);n.isNaN(e)||r.setValue(e)})),y.bind(i.__input,"blur",(function(){l()})),y.bind(i.__input,"mousedown",(function(e){y.bind(window,"mousemove",u),y.bind(window,"mouseup",c),s=e.clientY})),y.bind(i.__input,"keydown",(function(e){13===e.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,l())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return m(t,e),p(t,[{key:"updateDisplay",value:function(){var e,o,a;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),o=this.__precision,a=Math.pow(10,o),Math.round(e*a)/a),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(P);function I(e,t,o,a,n){return a+(e-t)/(o-t)*(n-a)}var V=function(e){function t(e,o,a,n,i){h(this,t);var r=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,{min:a,max:n,step:i})),s=r;function l(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(I(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function u(){y.unbind(window,"mousemove",l),y.unbind(window,"mouseup",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,o=s.__background.getBoundingClientRect();s.setValue(I(t,o.left,o.right,s.__min,s.__max))}function d(){y.unbind(window,"touchmove",c),y.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return r.__background=document.createElement("div"),r.__foreground=document.createElement("div"),y.bind(r.__background,"mousedown",(function(e){document.activeElement.blur(),y.bind(window,"mousemove",l),y.bind(window,"mouseup",u),l(e)})),y.bind(r.__background,"touchstart",(function(e){1===e.touches.length&&(y.bind(window,"touchmove",c),y.bind(window,"touchend",d),c(e))})),y.addClass(r.__background,"slider"),y.addClass(r.__foreground,"slider-fg"),r.updateDisplay(),r.__background.appendChild(r.__foreground),r.domElement.appendChild(r.__background),r}return m(t,e),p(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(P),k=function(e){function t(e,o,a){h(this,t);var n=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),i=n;return n.__button=document.createElement("div"),n.__button.innerHTML=void 0===a?"Fire":a,y.bind(n.__button,"click",(function(e){return e.preventDefault(),i.fire(),!1})),y.addClass(n.__button,"button"),n.domElement.appendChild(n.__button),n}return m(t,e),p(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(x),O=function(e){function t(e,o){h(this,t);var a=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));a.__color=new g(a.getValue()),a.__temp=new g(0);var i=a;a.domElement=document.createElement("div"),y.makeSelectable(a.domElement,!1),a.__selector=document.createElement("div"),a.__selector.className="selector",a.__saturation_field=document.createElement("div"),a.__saturation_field.className="saturation-field",a.__field_knob=document.createElement("div"),a.__field_knob.className="field-knob",a.__field_knob_border="2px solid ",a.__hue_knob=document.createElement("div"),a.__hue_knob.className="hue-knob",a.__hue_field=document.createElement("div"),a.__hue_field.className="hue-field",a.__input=document.createElement("input"),a.__input.type="text",a.__input_textShadow="0 1px 1px ",y.bind(a.__input,"keydown",(function(e){13===e.keyCode&&f.call(this)})),y.bind(a.__input,"blur",f),y.bind(a.__selector,"mousedown",(function(){y.addClass(this,"drag").bind(window,"mouseup",(function(){y.removeClass(i.__selector,"drag")}))})),y.bind(a.__selector,"touchstart",(function(){y.addClass(this,"drag").bind(window,"touchend",(function(){y.removeClass(i.__selector,"drag")}))}));var r,s=document.createElement("div");function u(e){b(e),y.bind(window,"mousemove",b),y.bind(window,"touchmove",b),y.bind(window,"mouseup",d),y.bind(window,"touchend",d)}function c(e){v(e),y.bind(window,"mousemove",v),y.bind(window,"touchmove",v),y.bind(window,"mouseup",p),y.bind(window,"touchend",p)}function d(){y.unbind(window,"mousemove",b),y.unbind(window,"touchmove",b),y.unbind(window,"mouseup",d),y.unbind(window,"touchend",d),m()}function p(){y.unbind(window,"mousemove",v),y.unbind(window,"touchmove",v),y.unbind(window,"mouseup",p),y.unbind(window,"touchend",p),m()}function f(){var e=l(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function m(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function b(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),o=e.touches&&e.touches[0]||e,a=o.clientX,n=o.clientY,r=(a-t.left)/(t.right-t.left),s=1-(n-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),r>1?r=1:r<0&&(r=0),i.__color.v=s,i.__color.s=r,i.setValue(i.__color.toOriginal()),!1}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),o=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return o>1?o=1:o<0&&(o=0),i.__color.h=360*o,i.setValue(i.__color.toOriginal()),!1}return n.extend(a.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),n.extend(a.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:a.__field_knob_border+(a.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),n.extend(a.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),n.extend(a.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),n.extend(s.style,{width:"100%",height:"100%",background:"none"}),L(s,"top","rgba(0,0,0,0)","#000"),n.extend(a.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=a.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.extend(a.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:a.__input_textShadow+"rgba(0,0,0,0.7)"}),y.bind(a.__saturation_field,"mousedown",u),y.bind(a.__saturation_field,"touchstart",u),y.bind(a.__field_knob,"mousedown",u),y.bind(a.__field_knob,"touchstart",u),y.bind(a.__hue_field,"mousedown",c),y.bind(a.__hue_field,"touchstart",c),a.__saturation_field.appendChild(s),a.__selector.appendChild(a.__field_knob),a.__selector.appendChild(a.__saturation_field),a.__selector.appendChild(a.__hue_field),a.__hue_field.appendChild(a.__hue_knob),a.domElement.appendChild(a.__input),a.domElement.appendChild(a.__selector),a.updateDisplay(),a}return m(t,e),p(t,[{key:"updateDisplay",value:function(){var e=l(this.getValue());if(!1!==e){var t=!1;n.each(g.COMPONENTS,(function(o){if(!n.isUndefined(e[o])&&!n.isUndefined(this.__color.__state[o])&&e[o]!==this.__color.__state[o])return t=!0,{}}),this),t&&n.extend(this.__color.__state,e)}n.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,a=255-o;n.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,L(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),n.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),t}(x),B=["-moz-","-o-","-webkit-","-ms-",""];function L(e,t,o,a){e.style.background="",n.each(B,(function(n){e.style.cssText+="background: "+n+"linear-gradient("+t+", "+o+" 0%, "+a+" 100%); "}))}var N='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',D=function(e,t){var o=e[t];return n.isArray(arguments[2])||n.isObject(arguments[2])?new C(e,t,arguments[2]):n.isNumber(o)?n.isNumber(arguments[2])&&n.isNumber(arguments[3])?n.isNumber(arguments[4])?new V(e,t,arguments[2],arguments[3],arguments[4]):new V(e,t,arguments[2],arguments[3]):n.isNumber(arguments[4])?new R(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new R(e,t,{min:arguments[2],max:arguments[3]}):n.isString(o)?new S(e,t):n.isFunction(o)?new k(e,t,""):n.isBoolean(o)?new A(e,t):null},F=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},z=function(){function e(){h(this,e),this.backgroundElement=document.createElement("div"),n.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),y.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),n.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;y.bind(this.backgroundElement,"click",(function(){t.hide()}))}return p(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),n.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",y.unbind(e.domElement,"webkitTransitionEnd",t),y.unbind(e.domElement,"transitionend",t),y.unbind(e.domElement,"oTransitionEnd",t)};y.bind(this.domElement,"webkitTransitionEnd",t),y.bind(this.domElement,"transitionend",t),y.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-y.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-y.getHeight(this.domElement)/2+"px"}}]),e}();!function(e,t){var o=t||document,a=document.createElement("style");a.type="text/css",a.innerHTML=e;var n=o.getElementsByTagName("head")[0];try{n.appendChild(a)}catch(e){}}(function(e){if("undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var U="Default",j=function(){try{return!!window.localStorage}catch(e){return!1}}(),H=void 0,G=!0,X=void 0,Y=!1,q=[],K=function e(t){var o=this,a=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),y.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=n.defaults(a,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),a=n.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),n.isUndefined(a.load)?a.load={preset:U}:a.preset&&(a.load.preset=a.preset),n.isUndefined(a.parent)&&a.hideable&&q.push(this),a.resizable=n.isUndefined(a.parent)&&a.resizable,a.autoPlace&&n.isUndefined(a.scrollable)&&(a.scrollable=!0);var i,r=j&&"true"===localStorage.getItem(ee(0,"isLocal")),s=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return o.parent?o.getRoot().preset:a.load.preset},set:function(e){o.parent?o.getRoot().preset=e:a.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),o.revert()}},width:{get:function(){return a.width},set:function(e){a.width=e,ie(o,e)}},name:{get:function(){return a.name},set:function(e){a.name=e,l&&(l.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(t){a.closed=t,a.closed?y.addClass(o.__ul,e.CLASS_CLOSED):y.removeClass(o.__ul,e.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return r},set:function(e){j&&(r=e,e?y.bind(window,"unload",s):y.unbind(window,"unload",s),localStorage.setItem(ee(0,"isLocal"),e))}}}),n.isUndefined(a.parent)){if(this.closed=a.closed||!1,y.addClass(this.domElement,e.CLASS_MAIN),y.makeSelectable(this.domElement,!1),j&&r){o.useLocalStorage=!0;var u=localStorage.getItem(ee(0,"gui"));u&&(a.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,y.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),a.closeOnTop?(y.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(y.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),y.bind(this.__closeButton,"click",(function(){o.closed=!o.closed}))}else{void 0===a.closed&&(a.closed=!0);var c=document.createTextNode(a.name);y.addClass(c,"controller-name"),l=Q(o,c),y.addClass(this.__ul,e.CLASS_CLOSED),y.addClass(l,"title"),y.bind(l,"click",(function(e){return e.preventDefault(),o.closed=!o.closed,!1})),a.closed||(this.closed=!1)}a.autoPlace&&(n.isUndefined(a.parent)&&(G&&(X=document.createElement("div"),y.addClass(X,"dg"),y.addClass(X,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(X),G=!1),X.appendChild(this.domElement),y.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ie(o,a.width)),this.__resizeHandler=function(){o.onResizeDebounced()},y.bind(window,"resize",this.__resizeHandler),y.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),y.bind(this.__ul,"transitionend",this.__resizeHandler),y.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),a.resizable&&ne(this),s=function(){j&&"true"===localStorage.getItem(ee(0,"isLocal"))&&localStorage.setItem(ee(0,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=s,a.parent||((i=o.getRoot()).width+=1,n.defer((function(){i.width-=1})))};function Q(e,t,o){var a=document.createElement("li");return t&&a.appendChild(t),o?e.__ul.insertBefore(a,o):e.__ul.appendChild(a),e.onResize(),a}function W(e){y.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&y.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function J(e,t){var o=e.__preset_select[e.__preset_select.selectedIndex];o.innerHTML=t?o.value+"*":o.value}function Z(e,t){var o=e.getRoot(),a=o.__rememberedObjects.indexOf(t.object);if(-1!==a){var n=o.__rememberedObjectIndecesToControllers[a];if(void 0===n&&(n={},o.__rememberedObjectIndecesToControllers[a]=n),n[t.property]=t,o.load&&o.load.remembered){var i=o.load.remembered,r=void 0;if(i[e.preset])r=i[e.preset];else{if(!i.Default)return;r=i.Default}if(r[a]&&void 0!==r[a][t.property]){var s=r[a][t.property];t.initialValue=s,t.setValue(s)}}}}function $(e,t,o,a){if(void 0===t[o])throw new Error('Object "'+t+'" has no property "'+o+'"');var i=void 0;if(a.color)i=new O(t,o);else{var r=[t,o].concat(a.factoryArgs);i=D.apply(e,r)}a.before instanceof x&&(a.before=a.before.__li),Z(e,i),y.addClass(i.domElement,"c");var s=document.createElement("span");y.addClass(s,"property-name"),s.innerHTML=i.property;var l=document.createElement("div");l.appendChild(s),l.appendChild(i.domElement);var u=Q(e,l,a.before);return y.addClass(u,K.CLASS_CONTROLLER_ROW),i instanceof O?y.addClass(u,"color"):y.addClass(u,d(i.getValue())),function(e,t,o){if(o.__li=t,o.__gui=e,n.extend(o,{options:function(t){if(arguments.length>1){var a=o.__li.nextElementSibling;return o.remove(),$(e,o.object,o.property,{before:a,factoryArgs:[n.toArray(arguments)]})}if(n.isArray(t)||n.isObject(t)){var i=o.__li.nextElementSibling;return o.remove(),$(e,o.object,o.property,{before:i,factoryArgs:[t]})}},name:function(e){return o.__li.firstElementChild.firstElementChild.innerHTML=e,o},listen:function(){return o.__gui.listen(o),o},remove:function(){return o.__gui.remove(o),o}}),o instanceof V){var a=new R(o.object,o.property,{min:o.__min,max:o.__max,step:o.__step});n.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=o[e],n=a[e];o[e]=a[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(a,e),t.apply(o,e)}})),y.addClass(t,"has-slider"),o.domElement.insertBefore(a.domElement,o.domElement.firstElementChild)}else if(o instanceof R){var i=function(t){if(n.isNumber(o.__min)&&n.isNumber(o.__max)){var a=o.__li.firstElementChild.firstElementChild.innerHTML,i=o.__gui.__listening.indexOf(o)>-1;o.remove();var r=$(e,o.object,o.property,{before:o.__li.nextElementSibling,factoryArgs:[o.__min,o.__max,o.__step]});return r.name(a),i&&r.listen(),r}return t};o.min=n.compose(i,o.min),o.max=n.compose(i,o.max)}else o instanceof A?(y.bind(t,"click",(function(){y.fakeEvent(o.__checkbox,"click")})),y.bind(o.__checkbox,"click",(function(e){e.stopPropagation()}))):o instanceof k?(y.bind(t,"click",(function(){y.fakeEvent(o.__button,"click")})),y.bind(t,"mouseover",(function(){y.addClass(o.__button,"hover")})),y.bind(t,"mouseout",(function(){y.removeClass(o.__button,"hover")}))):o instanceof O&&(y.addClass(t,"color"),o.updateDisplay=n.compose((function(e){return t.style.borderLeftColor=o.__color.toString(),e}),o.updateDisplay),o.updateDisplay());o.setValue=n.compose((function(t){return e.getRoot().__preset_select&&o.isModified()&&J(e.getRoot(),!0),t}),o.setValue)}(e,u,i),e.__controllers.push(i),i}function ee(e,t){return document.location.href+"."+t}function te(e,t,o){var a=document.createElement("option");a.innerHTML=t,a.value=t,e.__preset_select.appendChild(a),o&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function oe(e,t){t.style.display=e.useLocalStorage?"block":"none"}function ae(e){var t=e.__save_row=document.createElement("li");y.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),y.addClass(t,"save-row");var o=document.createElement("span");o.innerHTML="&nbsp;",y.addClass(o,"button gears");var a=document.createElement("span");a.innerHTML="Save",y.addClass(a,"button"),y.addClass(a,"save");var i=document.createElement("span");i.innerHTML="New",y.addClass(i,"button"),y.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",y.addClass(r,"button"),y.addClass(r,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?n.each(e.load.remembered,(function(t,o){te(e,o,o===e.preset)})):te(e,U,!1),y.bind(s,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(s),t.appendChild(o),t.appendChild(a),t.appendChild(i),t.appendChild(r),j){var l=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ee(0,"isLocal"))&&u.setAttribute("checked","checked"),oe(e,l),y.bind(u,"change",(function(){e.useLocalStorage=!e.useLocalStorage,oe(e,l)}))}var c=document.getElementById("dg-new-constructor");y.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||H.hide()})),y.bind(o,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),H.show(),c.focus(),c.select()})),y.bind(a,"click",(function(){e.save()})),y.bind(i,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),y.bind(r,"click",(function(){e.revert()}))}function ne(e){var t=void 0;function o(o){return o.preventDefault(),e.width+=t-o.clientX,e.onResize(),t=o.clientX,!1}function a(){y.removeClass(e.__closeButton,K.CLASS_DRAG),y.unbind(window,"mousemove",o),y.unbind(window,"mouseup",a)}function i(n){return n.preventDefault(),t=n.clientX,y.addClass(e.__closeButton,K.CLASS_DRAG),y.bind(window,"mousemove",o),y.bind(window,"mouseup",a),!1}e.__resize_handle=document.createElement("div"),n.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),y.bind(e.__resize_handle,"mousedown",i),y.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ie(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function re(e,t){var o={};return n.each(e.__rememberedObjects,(function(a,i){var r={},s=e.__rememberedObjectIndecesToControllers[i];n.each(s,(function(e,o){r[o]=t?e.initialValue:e.getValue()})),o[i]=r})),o}function se(e){0!==e.length&&F.call(window,(function(){se(e)})),n.each(e,(function(e){e.updateDisplay()}))}K.toggleHide=function(){Y=!Y,n.each(q,(function(e){e.domElement.style.display=Y?"none":""}))},K.CLASS_AUTO_PLACE="a",K.CLASS_AUTO_PLACE_CONTAINER="ac",K.CLASS_MAIN="main",K.CLASS_CONTROLLER_ROW="cr",K.CLASS_TOO_TALL="taller-than-window",K.CLASS_CLOSED="closed",K.CLASS_CLOSE_BUTTON="close-button",K.CLASS_CLOSE_TOP="close-top",K.CLASS_CLOSE_BOTTOM="close-bottom",K.CLASS_DRAG="drag",K.DEFAULT_WIDTH=245,K.TEXT_CLOSED="Close Controls",K.TEXT_OPEN="Open Controls",K._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||K.toggleHide()},y.bind(window,"keydown",K._keydownHandler,!1),n.extend(K.prototype,{add:function(e,t){return $(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return $(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;n.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&X.removeChild(this.domElement);var e=this;n.each(this.__folders,(function(t){e.removeFolder(t)})),y.unbind(window,"keydown",K._keydownHandler,!1),W(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var o=new K(t);this.__folders[e]=o;var a=Q(this,o.domElement);return y.addClass(a,"folder"),o},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],W(e);var t=this;n.each(e.__folders,(function(t){e.removeFolder(t)})),n.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=y.getOffset(e.__ul).top,o=0;n.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(o+=y.getHeight(t))})),window.innerHeight-t-20<o?(y.addClass(e.domElement,K.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(y.removeClass(e.domElement,K.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&n.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:n.debounce((function(){this.onResize()}),50),remember:function(){if(n.isUndefined(H)&&((H=new z).domElement.innerHTML=N),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;n.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&ae(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&ie(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=re(this)),e.folders={},n.each(this.__folders,(function(t,o){e.folders[o]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=re(this),J(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=re(this,!0)),this.load.remembered[e]=re(this),this.preset=e,te(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){n.each(this.__controllers,(function(t){this.getRoot().load.remembered?Z(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),n.each(this.__folders,(function(e){e.revert(e)})),e||J(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&se(this.__listening)},updateDisplay:function(){n.each(this.__controllers,(function(e){e.updateDisplay()})),n.each(this.__folders,(function(e){e.updateDisplay()}))}});var le=K,ue="undefined"!=typeof Float32Array?Float32Array:Array;function ce(){var e=new ue(3);return ue!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function de(e,t,o){var a=new ue(3);return a[0]=e,a[1]=t,a[2]=o,a}function he(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function pe(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e}function fe(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e}function me(e,t){var o=t[0],a=t[1],n=t[2],i=o*o+a*a+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function _e(e,t,o){var a=t[0],n=t[1],i=t[2],r=o[0],s=o[1],l=o[2];return e[0]=n*l-i*s,e[1]=i*r-a*l,e[2]=a*s-n*r,e}function ge(e,t,o){var a=t[0],n=t[1],i=t[2],r=o[3]*a+o[7]*n+o[11]*i+o[15];return r=r||1,e[0]=(o[0]*a+o[4]*n+o[8]*i+o[12])/r,e[1]=(o[1]*a+o[5]*n+o[9]*i+o[13])/r,e[2]=(o[2]*a+o[6]*n+o[10]*i+o[14])/r,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),ce();const be={getCanvas:e=>document.getElementById(e)||(console.error(`There is no canvas with id ${e} on this page.`),null),getGLContext:e=>e.getContext("webgl2")||console.error("WebGL2 is not available in your browser."),autoResizeCanvas(e){const t=()=>{e.width=window.innerWidth,e.height=window.innerHeight};t(),window.addEventListener("resize",t)},getShader(e,t){const o=document.getElementById(t);if(!o)return null;const a=o.text.trim();let n;if("x-shader/x-vertex"===o.type)n=e.createShader(e.VERTEX_SHADER);else{if("x-shader/x-fragment"!==o.type)return null;n=e.createShader(e.FRAGMENT_SHADER)}return e.shaderSource(n,a),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.error(e.getShaderInfoLog(n)),null)},normalizeColor:e=>e.map((e=>e/255)),denormalizeColor:e=>e.map((e=>255*e)),configureControls(e,t={width:300}){const o=t.gui||new le(t),a={},n=e=>"function"==typeof e;Object.keys(e).forEach((t=>{const i=e[t];if(n(i))return a[t]=i,o.add(a,t);if(!n(r=i)&&"object"==typeof r&&(null===r.value||void 0===r.value))return be.configureControls(i,{gui:o.addFolder(t)});var r;const{value:s,min:l,max:u,step:c,options:d,onChange:h=(()=>null)}=i;let p;a[t]=s,p=d?o.add(a,t,d):(e=>"string"==typeof e&&~e.indexOf("#")||Array.isArray(e)&&e.length>=3)(s)?o.addColor(a,t):o.add(a,t,l,u,c),p.onChange((e=>h(e,a)))}))},restarVectores(e,t){const o=[];for(let a=0;a<e.length;a++)o.push(e[a]-t[a]);return o},normalizarVector(e){const t=[];let o=0;for(let t=0;t<e.length;t++)o+=e[t]*e[t];o=Math.sqrt(o);for(let a=0;a<e.length;a++)t.push(e[a]/o);return t},calcularNormales(e){const t=[];for(let o=0;o<e.length;o++){const a=e[o];t.push([a[1],-a[0]])}return t},pasarTanAVector3(e){const t=[];for(let o=0;o<e.length;o++)t.push([0,e[o][1],e[o][0]]);return t},productoCruz(e,t){const o=[];return o[0]=e[1]*t[2]-e[2]*t[1],o[1]=e[2]*t[0]-e[0]*t[2],o[2]=e[0]*t[1]-e[1]*t[0],o},calcularVectorBinormal(e,t){const o=[];for(let a=0;a<t.length;a++){const n=t[a],i=this.productoCruz(n,e);o.push(be.normalizarVector(i))}return o},deRadianesAGrados:e=>180*e/Math.PI>360?180*e/Math.PI-360:180*e/Math.PI,crearForma(e,t){const{puntos:o,puntosTangentes:a}=t.extraerPuntos(e),n=be.calcularNormales(a);return o.length!==n.length&&(console.error("Se agrega la normal [1,0] al pt:",o[o.length-1]),n.push([1,0])),{puntos:o,normales:n,tangentes:a}},crearRecorrido(e,t,o=[1,0,0]){const{puntos:a,puntosTangentes:n}=t.extraerPuntos(e),i=be.pasarTanAVector3(n),r=o,s=be.calcularVectorBinormal(r,i);return a.length===n.length&&n.length===s.length||console.error("No coinciden puntos, tangentes y binormales",a.length,n.length,s.length),{puntos:a,tangentes:i,binormales:s,vectorNormal:r}},crearRecorridoCircular(e,t,o){const a=2*Math.PI*t,n=[],i=[],r=[];for(let t=0;t<=o;t++){const s=a*t/o,l=e*Math.cos(s),u=e*Math.sin(s),c=Math.cos(s),d=Math.sin(s),h=-Math.sin(s),p=Math.cos(s);n.push([l,u]),i.push([c,d,0]),r.push([h,p,0])}return{puntos:n,tangentes:r,binormales:i,vectorNormal:[0,0,1]}},nuevasCoordenadas(e,t,o=!1){const a=t.vertices,n=t.normales,i=t.tangentes,r=[],s=[],l=[];let u=0,c=3;for(a.length!==n.length&&console.log("Vertices y normales distinta longitud");c<=a.length;){const t=de(...a.slice(u,c)),d=de(...n.slice(u,c)),h=de(...i.slice(u,c));ge(d,d,e),ge(t,t,e),ge(h,h,e),o?r.unshift(...t):r.push(...t),me(d,d),o?s.unshift(...d):s.push(...d),me(h,h),o?l.unshift(...h):l.push(...h),u+=3,c+=3}return r.length!==s.length&&console.log("Vertices y normales nuevas distinta longitud"),a.length!==r.length&&console.log("Vertices transformados no coinciden en longitud"),n.length!==s.length&&console.log("Normales transformadas no coinciden en longitud"),{vertices:r,normales:s,tangentes:l}},I3(e){for(let t=0;t<e.length;t+=3)console.log(e[t].toFixed(4)+" "+e[t+1].toFixed(4)+" "+e[t+2].toFixed(4))},I2(e){for(let t=0;t<e.length;t+=2)console.log(e[t].toFixed(4)+" "+e[t+1].toFixed(4))}};class ve{constructor(e,t,o){return this.gl=e,this.program=e.createProgram(),t&&o?(e.attachShader(this.program,be.getShader(e,t)),e.attachShader(this.program,be.getShader(e,o)),e.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)?void this.useProgram():console.error("Could not initialize shaders.")):console.error("No shader IDs were provided")}useProgram(){this.gl.useProgram(this.program)}load(e,t){this.useProgram(),this.setAttributeLocations(e),this.setUniformLocations(t)}setAttributeLocations(e){e.forEach((e=>{this[e]=this.gl.getAttribLocation(this.program,e)}))}setUniformLocations(e){e.forEach((e=>{this[e]=this.gl.getUniformLocation(this.program,e)}))}getUniform(e){return this.gl.getUniform(this.program,e)}}class xe{constructor(e,t){this.gl=e,this.glTexture=e.createTexture(),this.image=new Image,this.image.onload=()=>this.handleLoadedTexture(),t&&this.setImage(t)}setImage(e){this.image.src=e}handleLoadedTexture(){const{gl:e,image:t,glTexture:o}=this;e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)}}class Te{constructor(e,t){this.gl=e,this.program=t,this.objects=[]}get(e){return this.objects.find((t=>t.alias===e))}load(e,t,o){return fetch(e).then((e=>e.json())).then((e=>{e.visible=!0,e.alias=t||e.alias,this.add(e,o)})).catch((e=>console.error(e,...arguments)))}loadByParts(e,t,o){for(let a=1;a<=t;a++){const t=`${e}${a}.json`;this.load(t,o)}}add(e,t){const{gl:o,program:a}=this;if(e.diffuse=e.diffuse||[1,1,1,1],e.Kd=e.Kd||e.diffuse.slice(0,3),e.ambient=e.ambient||[.2,.2,.2,1],e.Ka=e.Ka||e.ambient.slice(0,3),e.specular=e.specular||[1,1,1,1],e.Ks=e.Ks||e.specular.slice(0,3),e.specularExponent=e.specularExponent||0,e.Ns=e.Ns||e.specularExponent,e.d=e.d||1,e.transparency=e.transparency||e.d,e.illum=e.illum||1,Object.assign(e,t),e.ibo=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e.ibo),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices),o.STATIC_DRAW),e.vao=o.createVertexArray(),o.bindVertexArray(e.vao),a.aVertexPosition>=0){const t=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e.vertices),o.STATIC_DRAW),o.enableVertexAttribArray(a.aVertexPosition),o.vertexAttribPointer(a.aVertexPosition,3,o.FLOAT,!1,0,0)}if(a.aVertexNormal>=0){const t=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e.normales),o.STATIC_DRAW),o.enableVertexAttribArray(a.aVertexNormal),o.vertexAttribPointer(a.aVertexNormal,3,o.FLOAT,!1,0,0)}if(e.scalars&&a.aVertexColor>=0){const t=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e.scalars),o.STATIC_DRAW),o.enableVertexAttribArray(a.aVertexColor),o.vertexAttribPointer(a.aVertexColor,4,o.FLOAT,!1,0,0)}if(e.textureCoords&&a.aVertexTextureCoords>=0){const t=o.createBuffer();if(o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e.textureCoords),o.STATIC_DRAW),o.enableVertexAttribArray(a.aVertexTextureCoords),o.vertexAttribPointer(a.aVertexTextureCoords,2,o.FLOAT,!1,0,0),a.aVertexTangent>=0){const t=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e.tangentes),o.STATIC_DRAW),o.enableVertexAttribArray(a.aVertexTangent),o.vertexAttribPointer(a.aVertexTangent,3,o.FLOAT,!1,0,0)}}e.image&&(e.texture=new xe(o,e.image)),this.objects.push(e),o.bindVertexArray(null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),o.bindBuffer(o.ARRAY_BUFFER,null)}traverse(e){for(let t=0;t<this.objects.length&&void 0===e(this.objects[t],t);t++);}remove(e){const t=this.get(e),o=this.objects.indexOf(t);this.objects.splice(o,1)}renderFirst(e){const t=this.get(e),o=this.objects.indexOf(t);0!==o&&(this.objects.splice(o,1),this.objects.splice(0,0,t),this.printRenderOrder())}renderLast(e){const t=this.get(e),o=this.objects.indexOf(t);0!==o&&(this.objects.splice(o,1),this.objects.push(t),this.printRenderOrder())}renderSooner(e){const t=this.get(e),o=this.objects.indexOf(t);0!==o&&(this.objects.splice(o,1),this.objects.splice(o-1,0,t),this.printRenderOrder())}renderLater(e){const t=this.get(e),o=this.objects.indexOf(t);o!==this.objects.length-1&&(this.objects.splice(o,1),this.objects.splice(o+1,0,t),this.printRenderOrder())}printRenderOrder(){const e=this.objects.map((e=>e.alias)).join(" > ");console.info("Render Order:",e)}}function we(){var e=new ue(16);return ue!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ee(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ye(e,t,o,a,n,i,r,s,l,u,c,d,h,p,f,m,_){return e[0]=t,e[1]=o,e[2]=a,e[3]=n,e[4]=i,e[5]=r,e[6]=s,e[7]=l,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=p,e[13]=f,e[14]=m,e[15]=_,e}function Ae(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ce(e,t){if(e===t){var o=t[1],a=t[2],n=t[3],i=t[6],r=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=o,e[6]=t[9],e[7]=t[13],e[8]=a,e[9]=i,e[11]=t[14],e[12]=n,e[13]=r,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Se(e,t){var o=t[0],a=t[1],n=t[2],i=t[3],r=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],b=o*s-a*r,v=o*l-n*r,x=o*u-i*r,T=a*l-n*s,w=a*u-i*s,E=n*u-i*l,y=c*m-d*f,A=c*_-h*f,C=c*g-p*f,S=d*_-h*m,M=d*g-p*m,P=h*g-p*_,R=b*P-v*M+x*S+T*C-w*A+E*y;return R?(R=1/R,e[0]=(s*P-l*M+u*S)*R,e[1]=(n*M-a*P-i*S)*R,e[2]=(m*E-_*w+g*T)*R,e[3]=(h*w-d*E-p*T)*R,e[4]=(l*C-r*P-u*A)*R,e[5]=(o*P-n*C+i*A)*R,e[6]=(_*x-f*E-g*v)*R,e[7]=(c*E-h*x+p*v)*R,e[8]=(r*M-s*C+u*y)*R,e[9]=(a*C-o*M-i*y)*R,e[10]=(f*w-m*x+g*b)*R,e[11]=(d*x-c*w-p*b)*R,e[12]=(s*A-r*S-l*y)*R,e[13]=(o*S-a*A+n*y)*R,e[14]=(m*v-f*T-_*b)*R,e[15]=(c*T-d*v+h*b)*R,e):null}function Me(e,t,o){var a=t[0],n=t[1],i=t[2],r=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],f=t[11],m=t[12],_=t[13],g=t[14],b=t[15],v=o[0],x=o[1],T=o[2],w=o[3];return e[0]=v*a+x*s+T*d+w*m,e[1]=v*n+x*l+T*h+w*_,e[2]=v*i+x*u+T*p+w*g,e[3]=v*r+x*c+T*f+w*b,v=o[4],x=o[5],T=o[6],w=o[7],e[4]=v*a+x*s+T*d+w*m,e[5]=v*n+x*l+T*h+w*_,e[6]=v*i+x*u+T*p+w*g,e[7]=v*r+x*c+T*f+w*b,v=o[8],x=o[9],T=o[10],w=o[11],e[8]=v*a+x*s+T*d+w*m,e[9]=v*n+x*l+T*h+w*_,e[10]=v*i+x*u+T*p+w*g,e[11]=v*r+x*c+T*f+w*b,v=o[12],x=o[13],T=o[14],w=o[15],e[12]=v*a+x*s+T*d+w*m,e[13]=v*n+x*l+T*h+w*_,e[14]=v*i+x*u+T*p+w*g,e[15]=v*r+x*c+T*f+w*b,e}function Pe(e,t,o){var a,n,i,r,s,l,u,c,d,h,p,f,m=o[0],_=o[1],g=o[2];return t===e?(e[12]=t[0]*m+t[4]*_+t[8]*g+t[12],e[13]=t[1]*m+t[5]*_+t[9]*g+t[13],e[14]=t[2]*m+t[6]*_+t[10]*g+t[14],e[15]=t[3]*m+t[7]*_+t[11]*g+t[15]):(a=t[0],n=t[1],i=t[2],r=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],f=t[11],e[0]=a,e[1]=n,e[2]=i,e[3]=r,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=d,e[9]=h,e[10]=p,e[11]=f,e[12]=a*m+s*_+d*g+t[12],e[13]=n*m+l*_+h*g+t[13],e[14]=i*m+u*_+p*g+t[14],e[15]=r*m+c*_+f*g+t[15]),e}function Re(e,t,o){var a=o[0],n=o[1],i=o[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ie(e,t,o,a){var n,i,r,s,l,u,c,d,h,p,f,m,_,g,b,v,x,T,w,E,y,A,C,S,M=a[0],P=a[1],R=a[2],I=Math.hypot(M,P,R);return I<1e-6?null:(M*=I=1/I,P*=I,R*=I,n=Math.sin(o),r=1-(i=Math.cos(o)),s=t[0],l=t[1],u=t[2],c=t[3],d=t[4],h=t[5],p=t[6],f=t[7],m=t[8],_=t[9],g=t[10],b=t[11],v=M*M*r+i,x=P*M*r+R*n,T=R*M*r-P*n,w=M*P*r-R*n,E=P*P*r+i,y=R*P*r+M*n,A=M*R*r+P*n,C=P*R*r-M*n,S=R*R*r+i,e[0]=s*v+d*x+m*T,e[1]=l*v+h*x+_*T,e[2]=u*v+p*x+g*T,e[3]=c*v+f*x+b*T,e[4]=s*w+d*E+m*y,e[5]=l*w+h*E+_*y,e[6]=u*w+p*E+g*y,e[7]=c*w+f*E+b*y,e[8]=s*A+d*C+m*S,e[9]=l*A+h*C+_*S,e[10]=u*A+p*C+g*S,e[11]=c*A+f*C+b*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Ve(e,t,o){var a=Math.sin(o),n=Math.cos(o),i=t[4],r=t[5],s=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*n+u*a,e[5]=r*n+c*a,e[6]=s*n+d*a,e[7]=l*n+h*a,e[8]=u*n-i*a,e[9]=c*n-r*a,e[10]=d*n-s*a,e[11]=h*n-l*a,e}function ke(e,t,o){var a=Math.sin(o),n=Math.cos(o),i=t[0],r=t[1],s=t[2],l=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*n-u*a,e[1]=r*n-c*a,e[2]=s*n-d*a,e[3]=l*n-h*a,e[8]=i*a+u*n,e[9]=r*a+c*n,e[10]=s*a+d*n,e[11]=l*a+h*n,e}function Oe(e,t,o){var a=Math.sin(o),n=Math.cos(o),i=t[0],r=t[1],s=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*n+u*a,e[1]=r*n+c*a,e[2]=s*n+d*a,e[3]=l*n+h*a,e[4]=u*n-i*a,e[5]=c*n-r*a,e[6]=d*n-s*a,e[7]=h*n-l*a,e}function Be(){var e=new ue(4);return ue!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Le(e,t,o,a,n){return e[0]=t,e[1]=o,e[2]=a,e[3]=n,e}function Ne(e,t,o){var a=t[0],n=t[1],i=t[2],r=t[3];return e[0]=o[0]*a+o[4]*n+o[8]*i+o[12]*r,e[1]=o[1]*a+o[5]*n+o[9]*i+o[13]*r,e[2]=o[2]*a+o[6]*n+o[10]*i+o[14]*r,e[3]=o[3]*a+o[7]*n+o[11]*i+o[15]*r,e}Be();class De{constructor(e=De.ORBITING_TYPE){this.position=ce(),this.focus=ce(),this.up=ce(),this.right=ce(),this.normal=ce(),this.matrix=we(),this.steps=0,this.azimuth=0,this.elevation=0,this.fov=45,this.minZ=.1,this.maxZ=1e4,this.factorVelocidad=500,this.azimuthActual=0,this.elevationActual=-30,this.timeOutIdPool=[],this.rotationMatrix=null,this.setType(e)}setRotationMatrix(e){this.rotationMatrix=e}isOrbiting(){return this.type===De.ORBITING_TYPE}isTracking(){return this.type===De.TRACKING_TYPE}setType(e){~De.TYPES.indexOf(e)?this.type=e:console.error(`Camera type (${e}) not supported`)}goTo(e=[0,0,0],t=0,o=0,a=[0,0,0]){this.setPosition(e),this.setAzimuth(t),this.setElevation(o),this.setFocus(a)}dolly(e){const t=ce(),o=ce();me(t,this.normal);const a=e-this.steps;this.isTracking()?(o[0]=this.position[0]-a*t[0],o[1]=this.position[1]-a*t[1],o[2]=this.position[2]-a*t[2]):(o[0]=this.position[0],o[1]=this.position[1],o[2]=this.position[2]-a),this.steps=e,this.setPosition(o)}setPosition(e){he(this.position,e),this.update()}setFocus(e){he(this.focus,e),this.update()}colocarPaulatinamenteLaCamaraEn(e,t){const o=this.azimuthActual,a=this.elevationActual,n=(this.elevation-e)/this.factorVelocidad,i=(this.azimuth-t)/this.factorVelocidad;Math.abs(n)>.001||Math.abs(i)>.001?(this.elevation-=n,this.azimuth-=i,this.update(),o===t&&a===e?this.timeOutIdPool.push(setTimeout((()=>{this.colocarPaulatinamenteLaCamaraEn(e,t)}),10)):(this.borrarTimeOutIdPool(),this.azimuthActual=t,this.elevationActual=e)):this.borrarTimeOutIdPool()}borrarTimeOutIdPool(){this.timeOutIdPool.forEach((e=>{clearTimeout(e)})),this.timeOutIdPool=[]}setAzimuth(e){this.changeAzimuth(e-this.azimuth)}changeAzimuth(e){this.azimuth+=e,(this.azimuth>360||this.azimuth<-360)&&(this.azimuth=this.azimuth%360),this.update()}setElevation(e){this.changeElevation(e-this.elevation)}changeElevation(e){this.elevation+=e,(this.elevation>360||this.elevation<-360)&&(this.elevation=this.elevation%360),this.update()}lookAt(){const e=Be();Le(e,0,0,0,1),Ne(e,e,this.matrix);const t=ce();fe(t,e,this.focus),me(t,t);const o=ce();_e(o,this.up,t),me(o,o);const a=ce();_e(a,t,o),me(a,a),Ae(this.matrix),ye(this.matrix,o[0],o[1],o[2],0,a[0],a[1],a[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1)}calculateOrientation(){const e=Be();Le(e,1,0,0,0),Ne(e,e,this.matrix),he(this.right,e);const t=Be();Le(t,0,1,0,0),Ne(t,t,this.matrix),he(this.up,t);const o=Be();Le(o,0,0,1,0),Ne(o,o,this.matrix),he(this.normal,o)}dejarDeSeguirALaCapsula(){this.seguirCapsula=!1}seguirALaCapsula(){this.seguirCapsula=!0}update(){if(Ae(this.matrix),this.isTracking()?(Pe(this.matrix,this.matrix,this.position),ke(this.matrix,this.matrix,this.azimuth*Math.PI/180),Ve(this.matrix,this.matrix,this.elevation*Math.PI/180)):(Pe(this.matrix,this.matrix,this.focus),this.seguirCapsula&&Me(this.matrix,this.matrix,this.rotationMatrix),ke(this.matrix,this.matrix,this.azimuth*Math.PI/180),Ve(this.matrix,this.matrix,this.elevation*Math.PI/180),Pe(this.matrix,this.matrix,this.position)),this.isTracking()){const e=Be();Le(e,0,0,0,1),Ne(e,e,this.matrix),he(this.position,e)}this.calculateOrientation(),this.isOrbiting()&&this.lookAt(),this.logCamera()}logCamera(){console.log(`posCamara: ${this.position[0].toFixed(2)}, ${this.position[1].toFixed(2)}, ${this.position[2].toFixed(2)}`),console.log(`azimuth: ${this.azimuth.toFixed(2)}`),console.log(`elevation: ${this.elevation.toFixed(2)}`)}getViewTransform(){const e=we();return Se(e,this.matrix),e}}De.TYPES=["ORBITING_TYPE","TRACKING_TYPE"],De.TYPES.forEach((e=>De[e]=e));class Fe{constructor(e,t,o){this.camera=e,this.canvas=t,this.droneCam=o,this.picker=null,this.dragging=!1,this.picking=!1,this.ctrl=!1,this.x=0,this.y=0,this.lastX=0,this.lastY=0,this.button=0,this.key=0,this.dloc=0,this.dstep=0,this.motionFactor=10,this.keyIncrement=5,this.focusCamera={Nave:!1,PanelesSolares:!1,Capsula:!1},t.onmousedown=e=>this.onMouseDown(e),t.onmouseup=e=>this.onMouseUp(e),t.onmousemove=e=>this.onMouseMove(e),t.onwheel=e=>this.onMouseWheel(e),window.onkeydown=e=>this.onKeyDown(e),window.onkeyup=e=>this.onKeyUp(e),this.dondeEstoy="Nave",this.Camara={Nave:{position:ce(),azimuth:0,elevation:0,focus:ce()},PanelesSolares:{position:de(0,0,29.5),azimuth:-180,elevation:-30,focus:ce()},Capsula:{position:de(0,0,20),azimuth:0,elevation:-30.8,focus:ce()}}}setFocusCapsula(e){this.Camara.Capsula.focus=e}setFocus(e,t){this.Camara.Nave.focus=e,this.Camara.PanelesSolares.focus=t}setPicker(e){this.picker=e}get2DCoords(e){let t=0,o=0,a=this.canvas;for(;a&&"BODY"!==a.tagName;)t+=a.offsetTop,o+=a.offsetLeft,a=a.offsetParent;return o+=window.pageXOffset,t-=window.pageYOffset,{x:e.clientX-o,y:this.canvas.height-(e.clientY-t)}}onMouseUp(e){this.dragging=!1,!e.shiftKey&&this.picker&&(this.picking=!1,this.picker.stop())}onMouseDown(e){if(this.dragging=!0,this.x=e.clientX,this.y=e.clientY,this.button=e.button,this.dstep=Math.max(this.camera.position[0],this.camera.position[1],this.camera.position[2])/100,!this.picker)return;const t=this.get2DCoords(e);this.picking=this.picker.find(t),this.picking||this.picker.stop()}dollyHelper(e,t=3){for(this.dstep=Math.max(this.camera.position[0],this.camera.position[1],this.camera.position[2])/100;t--;)this.dolly(e)}onMouseWheel(e){const t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));this.dollyHelper(t)}onMouseMove(e){if(this.lastX=this.x,this.lastY=this.y,this.x=e.clientX,this.y=e.clientY,!this.dragging)return;this.ctrl=e.ctrlKey,this.alt=e.altKey;const t=this.x-this.lastX,o=this.y-this.lastY;this.picking&&this.picker.moveCallback?this.picker.moveCallback(t,o):this.button||(this.alt?this.dolly(o):this.rotate(t,o))}configurarCamaraDe(e){he(this.Camara[this.dondeEstoy].position,this.camera.position),this.Camara[this.dondeEstoy].azimuth=this.camera.azimuth,this.Camara[this.dondeEstoy].elevation=this.camera.elevation,this.camera.goTo(this.Camara[e].position,this.Camara[e].azimuth,this.Camara[e].elevation,this.Camara[e].focus),this.dondeEstoy=e,"Nave"===e?(this.focusCamera.PanelesSolares=!1,this.focusCamera.Capsula=!1,this.focusCamera.Nave=!0):"PanelesSolares"===e?(this.focusCamera.Nave=!1,this.focusCamera.Capsula=!1,this.focusCamera.PanelesSolares=!0):"Capsula"===e&&(this.focusCamera.Nave=!1,this.focusCamera.PanelesSolares=!1,this.focusCamera.Capsula=!0)}onKeyDown(e){if(this.key=e.keyCode,this.ctrl=e.ctrlKey,!this.ctrl)switch(this.key){case 49:return this.droneCam.activarControlesTeclado(!1),this.camera.borrarTimeOutIdPool(),this.camera.dejarDeSeguirALaCapsula(),this.configurarCamaraDe("Nave");case 50:return this.droneCam.activarControlesTeclado(!1),this.camera.borrarTimeOutIdPool(),this.camera.dejarDeSeguirALaCapsula(),this.configurarCamaraDe("PanelesSolares");case 51:return this.droneCam.activarControlesTeclado(),this.camera.seguirALaCapsula(),this.configurarCamaraDe("Capsula");case 88:return this.dollyHelper(-1);case 90:return this.dollyHelper(1)}}onKeyUp(e){17===e.keyCode&&(this.ctrl=!1)}dolly(e){e>0?this.dloc+=this.dstep:this.dloc-=this.dstep,this.camera.dolly(this.dloc)}rotate(e,t){const{width:o,height:a}=this.canvas,n=-20/a,i=e*(-20/o)*this.motionFactor,r=t*n*this.motionFactor;this.camera.changeAzimuth(i),this.camera.changeElevation(r)}}class ze{constructor(e,t,o,a){this.stack=[],this.gl=e,this.program=t,this.camera=o,this.canvas=a,this.modelViewMatrix=we(),this.projectionMatrix=we(),this.normalMatrix=we(),this.calculateModelView(),this.updatePerspective(),this.calculateNormal()}calculateModelView(){this.modelViewMatrix=this.camera.getViewTransform()}calculateNormal(){Ee(this.normalMatrix,this.modelViewMatrix),Se(this.normalMatrix,this.normalMatrix),Ce(this.normalMatrix,this.normalMatrix)}updatePerspective(){var e,t,o,a,n,i,r;e=this.projectionMatrix,t=this.camera.fov,o=this.canvas.width/this.canvas.height,a=this.camera.minZ,n=this.camera.maxZ,r=1/Math.tan(t/2),e[0]=r/o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(i=1/(a-n),e[10]=(n+a)*i,e[14]=2*n*a*i):(e[10]=-1,e[14]=-2*a)}setMatrixUniforms(){this.calculateNormal(),this.gl.uniformMatrix4fv(this.program.uModelViewMatrix,!1,this.modelViewMatrix),this.gl.uniformMatrix4fv(this.program.uProjectionMatrix,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.program.uNormalMatrix,!1,this.normalMatrix)}push(){const e=we();return Ee(e,this.modelViewMatrix),this.stack.push(e),e}pop(){return this.stack.length?this.modelViewMatrix=this.stack.pop():null}}const Ue={PanelSolar:[0,40/255,166/255,1],Violeta:[1,0,138/255,1],Pastilla:[169/255,183/255,43/255,1],RojoMetalico:[.71875,0,.1796,1]};class je{constructor(e){this.dimensionesTriangulos=e}construir(e){const t=[],o=[],a=[],n=[];for(let i=0;i<=this.dimensionesTriangulos.filas;i++)for(let r=0;r<=this.dimensionesTriangulos.columnas;r++){let s=r/this.dimensionesTriangulos.columnas,l=i/this.dimensionesTriangulos.filas,u=e.getPosicion(s,l);t.push(u[0]),t.push(u[1]),t.push(u[2]);let c=e.getCoordenadasTextura(s,l);a.push(c[0]),a.push(c[1]);let d=e.getTangente(s,l);n.push(d[0]),n.push(d[1]),n.push(d[2]);let h=e.getNormal(s,l);o.push(h[0]),o.push(h[1]),o.push(h[2])}const i=this.dimensionesTriangulos.columnas+1,r=[];for(let e=0;e<this.dimensionesTriangulos.filas;e++){for(let t=0;t<this.dimensionesTriangulos.columnas+1;t+=2)r.push(e*i+t),r.push((e+1)*i+t),r.push(e*i+t+1),r.push((e+1)*i+t+1);const t=r.length;this.dimensionesTriangulos.columnas%2?(r.push(r[t-1]),r.push((e+1)*i+0)):(r[t-1]=r[t-2],r[t-2]=r[t-3])}return r.pop(),r.pop(),{positionBuffer:t,normalBuffer:o,uvBuffer:a,indexBuffer:r,tangenteBuffer:n}}}class He{constructor(e,t){this.alias=t,this.vertices=[],this.indices=[],this.textureCoords=[],this.normales=[],this.tangentes=[],this.diffuse=Ue.RojoMetalico,this.visible=!0,this.dimensionesTriangulos=e,this.wireframe=!1}superficie(){}construir(){const e=new je(this.dimensionesTriangulos).construir(this.superficie());this.vertices=e.positionBuffer,this.indices=e.indexBuffer,this.normales=e.normalBuffer,this.textureCoords=e.uvBuffer,this.tangentes=e.tangenteBuffer}}class Ge extends He{constructor(e,t,o,a=!1){super(o,e),this.dimensionesCilindro=t,this.invertirNormales=a,this.construir()}superficie(){const e=this.dimensionesCilindro.radioSuperior,t=this.dimensionesCilindro.radioInferior,o=this.dimensionesCilindro.altura,a=(t-e)/o,n=this.invertirNormales;return{getPosicion:function(a,n){const i=n*(e-t)+t,r=2*Math.PI*a;return[i*Math.sin(r),n*o,i*Math.cos(r)]},getNormal:function(e,t){const o=2*Math.PI*e,i=be.normalizarVector([Math.sin(o),a,Math.cos(o)]);return!0===n?i.map((e=>-e)):i},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(a,i){const r=2*Math.PI*a,s=i*(e-t)+t,l=2*Math.PI*s,u=[l*Math.cos(r),0,-l*Math.sin(r)],c=e-t,d=[c*Math.sin(r),o,c*Math.cos(r)],h=u.map(((e,t)=>e+d[t])),p=be.normalizarVector(h);return!0===n?p.map((e=>-e)):p}}}}class Xe extends He{constructor(e,t,o){super(o,e),this.dimensionesTubo=t,this.construir()}superficie(){const e=this.dimensionesTubo.radio,t=this.dimensionesTubo.altura;return{getPosicion:function(o,a){const n=2*Math.PI*o,i=e,r=i*Math.cos(n),s=i*Math.sin(n);return[r,a*t,s]},getNormal:function(e,t){const o=2*Math.PI*e;return[Math.cos(o),0,Math.sin(o)]},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(o,a){const n=2*Math.PI*o,i=2*Math.PI*e;return be.normalizarVector([-i*Math.sin(n),t,i*Math.cos(n)])}}}}class Ye extends He{constructor(e,t,o){super(o,e),this.radio=t,this.construir()}superficie(){const e=this.radio;return{getPosicion:function(t,o){const a=2*Math.PI*t;return[e*o*Math.cos(a),0,e*o*Math.sin(a)]},getNormal:function(e,t){return[0,1,0]},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(t,o){const a=2*Math.PI*e*o,n=2*Math.PI*t,i=[-a*Math.sin(n),0,a*Math.cos(n)],r=[e*Math.cos(n),0,e*Math.sin(n)],s=i.map(((e,t)=>e+r[t]));return be.normalizarVector(s)}}}}class qe extends He{constructor(e,t,o){super(o,e),this.dimensiones=t,this.construir()}superficie(){const e=this.dimensiones.ancho,t=this.dimensiones.largo;return{getPosicion:function(o,a){return[(o-.5)*e,0,(a-.5)*t]},getNormal:function(e,t){return[0,1,0]},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(e,t){return[0,0,0]}}}}class Ke extends He{constructor(e,t=1,o=.4,a,n=2*Math.PI){super(a,e),this.arc=n,this.radius=t,this.tube=o,this.construir()}superficie(){const e=this.arc,t=this.radius,o=this.tube;return{getPosicion:function(a,n){return n=2*Math.PI*n,a*=e,[(t+o*Math.cos(n))*Math.cos(a),(t+o*Math.cos(n))*Math.sin(a),o*Math.sin(n)]},getNormal:function(o,a){const n=this.getPosicion(o,a);o*=e;const i=[],r=[];i[0]=t*Math.cos(o),i[1]=t*Math.sin(o),i[2]=0,r[0]=n[0]-i[0],r[1]=n[1]-i[1],r[2]=n[2]-i[2];const s=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);return r[0]/=s,r[1]/=s,r[2]/=s,[r[0],r[1],r[2]]},getCoordenadasTextura:function(e,t){return[e,t]},getTangente:function(e,t){return[0,0,0]}}}}const Qe={filas:1,columnas:1},We={ancho:.1,largo:6},Je={filas:1,columnas:10},Ze=Je;class $e{constructor(e=300,t){this.velocidadMediaDeGiro=e,this.anguloEnProceso=-5,this.anguloActual=0,this.intervaloEnGrados=t,this.timeOutIdPool=[],this._GIRO={LINEAL:1,LOG:0},this.MODO_GIRO=this._GIRO.LINEAL}empezarEn(e,t){this.panelSolar=t;const o=Math.floor(be.deRadianesAGrados(e));o%this.intervaloEnGrados==0&&o!==this.anguloEnProceso&&(this.anguloEnProceso=o,this.calcularParametrosYAnimar())}dameUnaVelocidadDeGiroRandom(){return Math.floor(this.velocidadMediaDeGiro*(.5+Math.random()))}dameUnNuevoAngulo(){const e=Math.random(),t=Math.random();let o=Math.random()<.5?this.panelSolar.anguloRotacion*(1-e):this.panelSolar.anguloRotacion*(1+t);return o=Math.floor(o>360?o%360:o),o<18&&(o=10*o+1),o}elegirUnGiro(e){Math.random()<e?this.MODO_GIRO=this._GIRO.LINEAL:this.MODO_GIRO=this._GIRO.LOG}calcularParametrosYAnimar(){const e=this.dameUnaVelocidadDeGiroRandom(),t=this.dameUnNuevoAngulo();this.anguloActual=t,this.elegirUnGiro(.6),this.cambiarElAnguloRotacionPanelSolar(t,e)}cambiarElAnguloRotacionPanelSolar(e,t){const o=this.anguloActual,a=this.panelSolar.anguloRotacion-e;let n;0!==t?(n=a/t,Math.abs(n)>.02?(this.panelSolar.anguloRotacion-=n,o===e?this.timeOutIdPool.push(setTimeout((()=>{this.cambiarElAnguloRotacionPanelSolar(e,t-this.MODO_GIRO)}),10)):(this.limpiarElPool(),this.anguloActual=e,this.cambiarElAnguloRotacionPanelSolar(e,t-this.MODO_GIRO))):this.limpiarElPool()):this.limpiarElPool()}limpiarElPool(){this.timeOutIdPool.forEach((e=>clearTimeout(e))),this.timeOutIdPool=[]}}class et{constructor(e){this.scene=e,this.panelesEnEscena=[],this.cantidadDeFilas=4,this.construirComponentes()}construirComponentes(){this.componentes=[];const t=new qe("panelTapaSuperior",e.panelSolar.tapa,Qe);t.diffuse=Ue.PanelSolar,this.componentes.push(t);const o=new qe("panelTapaInferior",e.panelSolar.tapa,Qe);o.diffuse=Ue.PanelSolar,this.componentes.push(o),this.componentes.push(new qe("panelLadoA",e.panelSolar.lado,Qe)),this.componentes.push(new qe("panelLadoA1",e.panelSolar.lado,Qe)),this.componentes.push(new qe("panelLadoB",We,Qe)),this.componentes.push(new qe("panelLadoB1",We,Qe)),this.cambiarAlturaDelTuboPrincipal()}nuevo(e){const t=[];t.push(new He(null,e)),t.push(...this.componentes),this.agregarALaEscena(t),this.panelesEnEscena.push(t)}agregarALaEscena(e){e.forEach((e=>{this.scene.add(e)}))}removerPanelesSolares(){const{scene:e}=this;e.remove("tuboPrincipal"),e.remove("tapaPrincipal");for(let t=0;t<this.cantidadDeFilas;t++)e.remove("tuboSecundario"),e.remove("tapaSecundaria1"),e.remove("tapaSecundaria2"),this.removerParPaneles()}removerParPaneles(e=2){let t=0;if(this.panelesEnEscena.length<e)console.error("No hay mas paneles para remover");else for(;t<e;)this.panelesEnEscena.pop().forEach((e=>{this.scene.remove(e.alias)})),t++}cambiarAlturaDelTuboPrincipal(){e.panelSolar.tuboPrincipal.altura=this.cantidadDeFilas*e.panelSolar.distanciaEntreTubosSecundarios+2.15}cargarPanelesSolares(){const{scene:t}=this;t.add(new Xe("tuboPrincipal",e.panelSolar.tuboPrincipal,Je)),t.add(new Ye("tapaPrincipal",e.panelSolar.tuboPrincipal.radio,Ze));for(let o=0;o<this.cantidadDeFilas;o++)t.add(new Xe("tuboSecundario",e.panelSolar.tuboSecundario,Je)),t.add(new Ye("tapaSecundaria1",e.panelSolar.tuboSecundario.radio,Ze)),t.add(new Ye("tapaSecundaria2",e.panelSolar.tuboSecundario.radio,Ze)),this.nuevo("panelSolar1"),this.nuevo("panelSolar2")}cargarPanelesSolares1(){const{scene:e}=this}}function tt(e,t,o,a,n){return function(e,t){const o=1-e;return o*o*o*t}(e,t)+function(e,t){const o=1-e;return 3*o*o*e*t}(e,o)+function(e,t){return 3*(1-e)*e*e*t}(e,a)+function(e,t){return e*e*e*t}(e,n)}class ot{constructor(e=[0,0],t=[0,0],o=[0,0],a=[0,0]){this.type="CurvaDeBezier",this.v0=e,this.v1=t,this.v2=o,this.v3=a}extraerPuntos(e=5){const t=[],o=[];for(let a=0;a<=e;a++)t.push(this.extraerPunto(a/e)),o.push(this.getTangent(a/e));return{puntos:t,puntosTangentes:o}}extraerPunto(e,t=[0,0]){const o=t,a=this.v0,n=this.v1,i=this.v2,r=this.v3;return o[0]=tt(e,a[0],n[0],i[0],r[0]),o[1]=tt(e,a[1],n[1],i[1],r[1]),o}getTangent(e){const t=1e-4;let o=e-t,a=e+t;o<0&&(o=0),a>1&&(a=1);const n=this.extraerPunto(o),i=this.extraerPunto(a),r=be.restarVectores(i,n);return be.normalizarVector(r)}}class at{constructor(){this.curvas=[],this.puntoActual=[0,0],this.esCurvaCerrada=!1}curvaCerrada(e){this.esCurvaCerrada=e}actualizarPuntoActual(e,t){return this.puntoActual[0]=e,this.puntoActual[1]=t,this}extraerPuntos(e=12){const t=[],o=[];let a;for(let n=0,i=this.curvas;n<i.length;n++){const r=i[n];let s,l;if(r&&"CurvaDeBezier"===r.type){const{puntos:t,puntosTangentes:a}=r.extraerPuntos(e);s=t,l=a,o.push(...l)}else s=r;for(let e=0;e<s.length;e++){const o=s[e];a&&a[0]===o[0]&&a[1]===o[1]||(t.push(o),a=o)}}return!0===this.esCurvaCerrada&&o.push(o[0]),{puntos:t,puntosTangentes:o}}clonarPuntoActual(){return[this.puntoActual[0],this.puntoActual[1]]}CurvaBezierA(e,t,o,a,n,i){const r=new ot(this.clonarPuntoActual(),[e,t],[o,a],[n,i]);return this.curvas.push(r),this.actualizarPuntoActual(n,i),this}iniciarEn(e,t){return this.actualizarPuntoActual(e,t),this}lineaA(e,t){const o=[this.clonarPuntoActual(),[e,t]];return this.curvas.push(o),this.actualizarPuntoActual(e,t),this}}class nt extends He{constructor(e,t,o){super(o,e),this.puntosDeLaForma=t,this.construir()}superficie(){const e=this.puntosDeLaForma;let t,o,a=0;return{getPosicion:function(n,i){t=e[a][0],o=e[a][1];const r=i*e[a][0],s=i*e[a][1];return a++,1===n&&(a=0),[r,0,s]},getNormal:(e,t)=>[0,1,0],getCoordenadasTextura:function(e,t){return[e,1-t]},getTangente:(e,a)=>be.normalizarVector([-o,0,t])}}}class it extends He{constructor(e,t,o,a,n=!1){super(a,e),this.datosDelRecorrido=o,this.datosDeLaForma=t,this.recorridoXY=n,this.construir()}superficie(){let e=0,t=0;const o=this.datosDelRecorrido,a=this.recorridoXY,n=this.datosDeLaForma;let i;return{getPosicion:function(r,s){const[l,u]=n.puntos[e],[c,d]=n.normales[e],h=o.binormales[t],p=o.tangentes[t],f=o.puntos[t],m=o.vectorNormal,_=we();a?ye(_,m[0],h[0],p[0],f[0],m[1],h[1],p[1],f[1],m[2],h[2],p[2],0,0,0,0,1):ye(_,m[0],h[0],p[0],0,m[1],h[1],p[1],f[1],m[2],h[2],p[2],f[0],0,0,0,1),Ce(_,_);const g=Be();Le(g,l,u,0,1),Ne(g,g,_);const b=we();return ye(b,m[0],h[0],p[0],0,m[1],h[1],p[1],0,m[2],h[2],p[2],0,0,0,0,1),Ce(b,b),i=Be(),Le(i,c,d,0,1),Ne(i,i,b),[g[0],g[1],g[2]]},getNormal(o,a){e++,1===o&&(e=0,t++);const n=be.normalizarVector([i[0],i[1],i[2]]);return[n[0],n[1],n[2]]},getCoordenadasTextura:function(e,t){return[e,1-t]},getTangente:(e,t)=>[e,t,e-1]}}}class rt extends He{constructor(e,t,o,a,n=!1){super(a,e),this.datosDelRecorrido=o,this.datosDeLaForma=t,this.recorridoXY=n,this.construir()}superficie(){let e=0,t=0;const o=this.datosDelRecorrido,a=this.recorridoXY,n=this.datosDeLaForma;let i,r;return{getPosicion:function(s,l){const[u,c]=n.puntos[e],[d,h]=n.normales[e],[p,f]=n.tangentes[e],m=o.binormales[t],_=o.tangentes[t],g=o.puntos[t],b=o.vectorNormal,v=we();a?ye(v,b[0],m[0],_[0],g[0],b[1],m[1],_[1],g[1],b[2],m[2],_[2],0,0,0,0,1):ye(v,b[0],m[0],_[0],0,b[1],m[1],_[1],g[1],b[2],m[2],_[2],g[0],0,0,0,1),Ce(v,v);const x=Be();Le(x,u,c,0,1),Ne(x,x,v);const T=we();return ye(T,b[0],m[0],_[0],0,b[1],m[1],_[1],0,b[2],m[2],_[2],0,0,0,0,1),Ce(T,T),i=Be(),Le(i,d,h,0,1),Ne(i,i,T),r=Be(),Le(r,p,f,0,1),Ne(r,r,T),[x[0],x[1],x[2]]},getTangente(e,t){const o=be.normalizarVector([r[0],r[1],r[2]]);return[o[0],o[1],o[2]]},getNormal(o,a){e++,1===o&&(e=0,t++);const n=be.normalizarVector([i[0],i[1],i[2]]);return[n[0],n[1],n[2]]},getCoordenadasTextura:function(e,t){return[t,e]}}}}class st{constructor(e,t,o=st.BLOQUES_8,a=16,n=8){this.scene=t,this.radioDelAnillo=e,this.bloqueActual=null,this.pasoDiscretoRecorrido=a,this.divisionesForma=n,this.dictionary={},st.TYPES.forEach((e=>{this.dictionary[e]=[]})),this.construirBloques()}obtenerNuevasCoordenadasTapaAtras(e,t){const o=Ae(we());Ie(o,o,e,[0,0,1]),Ie(o,o,Math.PI/2,[0,1,0]);const a=Ae(we());Pe(a,a,[15.2*Math.cos(e),15.2*Math.sin(e),0]),Me(a,a,o);const n=be.nuevasCoordenadas(a,t,!1),i=be.nuevasCoordenadas(o,t,!1),r=i.normales,s=i.tangentes;return{vertices:n.vertices,normales:r,tangentes:s}}construirBloques(){const{radioDelAnillo:e,pasoDiscretoRecorrido:t,divisionesForma:o}=this,a=new at;a.iniciarEn(2.2,.6),a.CurvaBezierA(2.2,.8,2,1,1.8,1),a.lineaA(-1.8,1),a.CurvaBezierA(-2,1,-2.2,.8,-2.2,.6),a.lineaA(-2.2,-.6),a.CurvaBezierA(-2.2,-.8,-2,-1,-1.8,-1),a.lineaA(1.8,-1),a.CurvaBezierA(2,-1,2.2,-.8,2.2,-.6),a.lineaA(2.2,.6).curvaCerrada(!0);const n=be.crearForma(o,a);n.puntos.splice(9,0,[0,1]),n.puntos.splice(19,0,[-2.2,0]),n.puntos.splice(29,0,[0,-1]),n.puntos.splice(39,0,[2.2,0]),n.normales.splice(9,0,[0,1]),n.normales.splice(19,0,[-1,0]),n.normales.splice(29,0,[0,-1]),n.normales.splice(39,0,[1,0]),n.tangentes.splice(9,0,[-1,0]),n.tangentes.splice(19,0,[0,-1]),n.tangentes.splice(29,0,[1,0]),n.tangentes.splice(39,0,[0,1]);const i=n.puntos.length-1,r={filas:t,columnas:i},s=new He(null,"bloque"),l=new He(null,"bloque"),u=new He(null,"bloque"),c=new He(null,"bloque"),d=new He(null,"bloque"),h=be.crearRecorridoCircular(e,1/8,r.filas),p=be.crearRecorridoCircular(e,.1,r.filas),f=be.crearRecorridoCircular(e,1/12,r.filas),m=be.crearRecorridoCircular(e,1/14,r.filas),_=be.crearRecorridoCircular(e,1/16,r.filas),g=new rt("bloque4_cuerpo",n,h,r,!0),b=new rt("bloque5_cuerpo",n,p,r,!0),v=new rt("bloque6_cuerpo",n,f,r,!0),x=new rt("bloque7_cuerpo",n,m,r,!0),T=new rt("bloque8_cuerpo",n,_,r,!0),w=new nt("bloque4_tapaAtras",n.puntos,{filas:1,columnas:i}),E=new nt("bloque4_tapaAdelante",n.puntos,{filas:1,columnas:i}),y=Ae(we());Pe(y,y,[15.2,0,0]),Ie(y,y,Math.PI/2,[0,1,0]),Ie(y,y,Math.PI,[1,0,0]);const A=Ae(we());Ie(A,A,Math.PI/2,[0,1,0]),Ie(A,A,Math.PI,[1,0,0]);const C=be.nuevasCoordenadas(A,E,!1),S=be.nuevasCoordenadas(y,E,!1);S.normales=C.normales,S.tangentes=C.tangentes;const M=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/4,w),P=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/5,w),R=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/6,w),I=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/7,w),V=this.obtenerNuevasCoordenadasTapaAtras(Math.PI/8,w);let k=0,O=[],B=[];for(let e=0;e<E.vertices.length;e+=3){const t={x:E.vertices[e],y:E.vertices[e+1],z:E.vertices[e+2]},o={x:E.vertices[(e+3)%E.vertices.length],y:E.vertices[(e+4)%E.vertices.length],z:E.vertices[(e+5)%E.vertices.length]};if(0===t.x&&0===t.y&&0===t.z||0===o.x&&0===o.y&&0===o.z)continue;const a=Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2)+Math.pow(o.z-t.z,2));O.push(a),k+=a}let L=0;B.push(0),O.map((e=>{L+=e,B.push(L/k)}));const N=[];for(let e=0;e<h.puntos.length+4;e++)N.push(e/(h.puntos.length+3));const D=[];for(let e=0;e<N.length;e++)for(let t=0;t<B.length;t++)D.push(1-B[t],N[e]);const F=[];g.indices.forEach((e=>{F.push(e+Math.max(...E.indices)+1)}));const z=[];w.indices.forEach((e=>{z.push(e+Math.max(...F)+1)}));const U=[];U.push(...E.indices,81,82,...F,778,779,...z),s.indices.push(...U),l.indices.push(...U),u.indices.push(...U),c.indices.push(...U),d.indices.push(...U),s.vertices.push(...S.vertices,...g.vertices,...M.vertices),l.vertices.push(...S.vertices,...b.vertices,...P.vertices),u.vertices.push(...S.vertices,...v.vertices,...R.vertices),c.vertices.push(...S.vertices,...x.vertices,...I.vertices),d.vertices.push(...S.vertices,...T.vertices,...V.vertices),s.normales.push(...S.normales,...g.normales,...M.normales),l.normales.push(...S.normales,...b.normales,...P.normales),u.normales.push(...S.normales,...v.normales,...R.normales),c.normales.push(...S.normales,...x.normales,...I.normales),d.normales.push(...S.normales,...T.normales,...V.normales),s.tangentes.push(...S.tangentes,...g.tangentes,...M.tangentes),l.tangentes.push(...S.tangentes,...b.tangentes,...P.tangentes),u.tangentes.push(...S.tangentes,...v.tangentes,...R.tangentes),c.tangentes.push(...S.tangentes,...x.tangentes,...I.tangentes),d.tangentes.push(...S.tangentes,...T.tangentes,...V.tangentes),s.textureCoords.push(...D),l.textureCoords.push(...D),u.textureCoords.push(...D),c.textureCoords.push(...D),d.textureCoords.push(...D);let j=4;for(;j--;)this.dictionary[st.BLOQUES_4].push(s);for(j=5;j--;)this.dictionary[st.BLOQUES_5].push(l);for(j=6;j--;)this.dictionary[st.BLOQUES_6].push(u);for(j=7;j--;)this.dictionary[st.BLOQUES_7].push(c);for(j=8;j--;)this.dictionary[st.BLOQUES_8].push(d)}setType(e){~st.TYPES.indexOf(e)?this.type=e:console.error(`Bloque type (${e}) not supported`),this.removerBloqueActualDeLaEscena(),this.actualizarEscena()}dameElTipoDeBloqueActual(){return this.type}removerBloqueActualDeLaEscena(){null!=this.bloqueActual&&this.bloqueActual.forEach((e=>{this.scene.remove(e.alias)}))}actualizarEscena(){this.dictionary[this.type].forEach((e=>{this.scene.add(e,{diffuse:[1,1,1,1],hasTexture:!0})})),this.bloqueActual=this.dictionary[this.type]}}function lt(e,t){let o=.01,a=.05;e||(e=[0,0,0]);let n=de(e[0],e[1],e[2]),i=ce(),r=we(),s={xVel:0,zVel:0,yVel:0,xVelTarget:0,zVelTarget:0,yVelTarget:0,yRotVelTarget:0,yRotVel:0,zRotVelTarget:0,zRotVel:0,xRotVelTarget:0,xRotVel:0,rightAxisMode:"move"},l=Object.assign({},s);this.listener=function(a){switch(a.key){case"ArrowUp":case"w":t.colocarPaulatinamenteLaCamaraEn(-30,0),l.zVelTarget=.3;break;case"ArrowDown":case"s":t.colocarPaulatinamenteLaCamaraEn(-30,180),l.zVelTarget=-.3;break;case"ArrowLeft":case"a":t.colocarPaulatinamenteLaCamaraEn(-30,90),l.xVelTarget=.3;break;case"ArrowRight":case"d":t.colocarPaulatinamenteLaCamaraEn(-30,-90),l.xVelTarget=-.3;break;case"q":case"PageUp":case" ":t.colocarPaulatinamenteLaCamaraEn(90,0),l.yVelTarget=.3;break;case"e":case"PageDown":t.colocarPaulatinamenteLaCamaraEn(-90,0),l.yVelTarget=-.3;break;case"k":l.xRotVelTarget=o;break;case"i":l.xRotVelTarget=-.01;break;case"j":l.yRotVelTarget=o;break;case"l":l.yRotVelTarget=-.01;break;case"u":l.zRotVelTarget=o;break;case"o":l.zRotVelTarget=-.01;break;case"r":i=ce(),n=de(e[0],e[1],e[2]),l=Object.assign({},s),r=we();break;case"t":i=ce(),l=Object.assign({},s)}},this.activarControlesTeclado=function(e=!0){e?(document.addEventListener("keydown",this.listener),document.addEventListener("keyup",(function(e){switch(e.key){case"ArrowUp":case"w":case"ArrowDown":case"s":l.zVelTarget=0;break;case"ArrowLeft":case"a":case"ArrowRight":case"d":l.xVelTarget=0;break;case"q":case"e":case"PageDown":case"PageUp":case" ":l.yVelTarget=0;break;case"j":case"l":l.yRotVelTarget=0;break;case"i":case"k":l.xRotVelTarget=0;break;case"u":case"o":l.zRotVelTarget=0}}))):document.removeEventListener("keydown",this.listener)},this.update=function(){l.xVel+=(l.xVelTarget-l.xVel)*a,l.yVel+=(l.yVelTarget-l.yVel)*a,l.zVel+=(l.zVelTarget-l.zVel)*a,l.xRotVel+=(l.xRotVelTarget-l.xRotVel)*a,l.yRotVel+=(l.yRotVelTarget-l.yRotVel)*a,l.zRotVel+=(l.zRotVelTarget-l.zRotVel)*a;let e=de(-l.xVel,l.yVel,-l.zVel);return Math.abs(l.xRotVel)>0&&Ie(r,r,l.xRotVel,de(1,0,0)),Math.abs(l.yRotVel)>0&&Ie(r,r,l.yRotVel,de(0,1,0)),Math.abs(l.zRotVel)>0&&Ie(r,r,l.zRotVel,de(0,0,1)),ge(e,e,r),pe(n,n,e),{rotationMatrix:r,position:n}}}st.TYPES=["BLOQUES_8","BLOQUES_7","BLOQUES_6","BLOQUES_5","BLOQUES_4"],st.TYPES.forEach((e=>st[e]=e));const ut={bloqueTransform:null,centrarElBloque:.42,distanciaNucleoDelAnilloYNave:e.NucleoPS.altura+e.CilindroNucleoPS.altura,distanciaModuloVioletaYNave:e.NucleoPS.altura+2*e.CilindroNucleoPS.altura+e.profundidadModuloVioleta,posicionBloque:0},ct={torusTransform:null,distanciaTubosInteriores:e.anillo.radio,sentidoTuboInterior:1,desplazamientoTuboInterior:0,factorDesplazamientoEntreTubosInteriores:3,pastillaTransform:null,alturaTapaSuperior:.9,alturaTapaInferior:.1},dt={nucleoPSTransform:null,nucleoAnilloTransform:null},ht={capsulaTransform:null},pt={naveTransform:null},ft={tuboTransform:null,tuboSecundarioTransform:null,distanciaRelativaConElTuboPrincipal:3.5,distanciaConElNucleo:4.5,panelTransform:null},mt={esferaTransform:null,radio:2,angulo:Math.PI/4,posRelativaALaNave:8.8},_t={transform:null,lado:5},gt={transform:null};class bt{constructor(e,t,o,a,n,i){this.animacion=i,this.bloque=n,this.transforms=e,this.droneCam=t,this.controles=o,this.camera=a,this.paramAnillo={pastillaEnElMedio:1.55,factorDeVelocidad:5},this.panelSolar={anguloRotacion:310,animar:!0},this.posicionAnillo=0,this.cargarParametrosBloques(),this.cuboTransform=e.modelViewMatrix}cargarParametrosBloques(){let e=360,t=8;this.parametrosBloques={},st.TYPES.forEach((o=>{this.parametrosBloques[o]={anguloPosicion:e,anguloTapaAtras:180/t--},e-=45}))}setAlias(e){this.alias=e}capsula(){const{transforms:e,droneCam:t,controles:o,camera:a}=this;if("capsula"===this.alias){ht.capsulaTransform=e.modelViewMatrix;const{rotationMatrix:n,position:i}=t.update();o.setFocusCapsula(i),!0===o.focusCamera.Capsula&&a.setFocus(i),a.setRotationMatrix(n),Pe(ht.capsulaTransform,ht.capsulaTransform,i),Me(ht.capsulaTransform,ht.capsulaTransform,n),Ie(ht.capsulaTransform,ht.capsulaTransform,Math.PI,[1,0,0])}else if("capsulaCuerpoCilindroA"===this.alias){const t=e.modelViewMatrix;Pe(t,ht.capsulaTransform,[0,0,.1]),Ie(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroB"===this.alias){const t=e.modelViewMatrix;Pe(t,ht.capsulaTransform,[0,0,.3]),Ie(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoBezierA"===this.alias)Ie(e.modelViewMatrix,ht.capsulaTransform,Math.PI/2,[0,0,1]);else if("capsulaCuerpoCilindroC"===this.alias){const t=e.modelViewMatrix;Pe(t,ht.capsulaTransform,[0,0,2.51]),Ie(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroD"===this.alias){const t=e.modelViewMatrix;Pe(t,ht.capsulaTransform,[0,0,2.9]),Ie(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCuerpoCilindroE"===this.alias){const t=e.modelViewMatrix;Pe(t,ht.capsulaTransform,[0,0,2.901]),Ie(t,t,-Math.PI/2,[1,0,0])}else if("capsulaCola"===this.alias)Pe(e.modelViewMatrix,ht.capsulaTransform,[0,0,.2]);else if("capsulaFuegoCola"===this.alias){const t=e.modelViewMatrix;Ie(t,ht.capsulaTransform,-Math.PI/2,[0,0,1]),Pe(t,t,[0,0,ht.curvaColav0x+.5+.2]),Ie(t,t,-Math.PI/2,[1,0,0])}else if("capsulaFuegoCuerpo"===this.alias){const t=e.modelViewMatrix;Pe(t,ht.capsulaTransform,[0,0,ht.CilAaltura+ht.FuegoCuerpoAltura]),Ie(t,t,-Math.PI/2,[1,0,0])}}esfera(){const{transforms:e}=this;if("esfera"===this.alias)mt.esferaTransform=e.modelViewMatrix,Pe(mt.esferaTransform,pt.naveTransform,[0,0,-mt.posRelativaALaNave]);else if("esferaTapaAtras"===this.alias){const t=e.modelViewMatrix;Pe(t,mt.esferaTransform,[0,0,mt.radio*Math.cos(mt.angulo)]),Ie(t,t,Math.PI/2,[1,0,0])}else if("esferaTapaAdelante"===this.alias){const t=e.modelViewMatrix;Pe(t,mt.esferaTransform,[0,0,-mt.radio*Math.cos(mt.angulo)]),Ie(t,t,Math.PI/2,[-1,0,0])}}bloques(){const{bloque:e,transforms:t}=this,o=e.dameElTipoDeBloqueActual(),a=this.parametrosBloques[o];if("bloque"===this.alias){ut.bloqueTransform=t.modelViewMatrix;const e=(22.5+90*ut.posicionBloque)*Math.PI/a.anguloPosicion;Ie(ut.bloqueTransform,ct.pastillaTransform,e,[0,1,0]),Pe(ut.bloqueTransform,ut.bloqueTransform,[0,ut.centrarElBloque,0]),Ie(ut.bloqueTransform,ut.bloqueTransform,Math.PI/2,[1,0,0]),ut.posicionBloque++}}modulosVioleta(){const{transforms:e}=this;"moduloVioletaPS"===this.alias?Pe(e.modelViewMatrix,pt.naveTransform,[0,0,0]):"moduloVioletaAnillo"===this.alias&&Pe(e.modelViewMatrix,pt.naveTransform,[0,0,-ut.distanciaModuloVioletaYNave])}nucleoDelPanelSolar(){const{transforms:t}=this,o=e.profundidadModuloVioleta+e.CilindroNucleoPS.altura;"nucleoPS"===this.alias&&(dt.nucleoPSTransform=t.modelViewMatrix,Pe(dt.nucleoPSTransform,pt.naveTransform,[0,0,o]),Ie(dt.nucleoPSTransform,dt.nucleoPSTransform,Math.PI/2,[1,0,0]))}panelesSolares(){const{transforms:t}=this;if("tuboPrincipal"===this.alias)ft.tuboTransform=t.modelViewMatrix,Pe(ft.tuboTransform,dt.nucleoPSTransform,[0,ft.distanciaConElNucleo,0]);else if("tapaPrincipal"===this.alias)Pe(t.modelViewMatrix,ft.tuboTransform,[0,e.panelSolar.tuboPrincipal.altura,0]);else if("tuboSecundario"===this.alias)ft.tuboSecundarioTransform=t.modelViewMatrix,Pe(ft.tuboSecundarioTransform,ft.tuboTransform,[e.panelSolar.tuboSecundario.altura/2,ft.distanciaRelativaConElTuboPrincipal,0]),Oe(ft.tuboSecundarioTransform,ft.tuboSecundarioTransform,Math.PI/2),ft.distanciaRelativaConElTuboPrincipal+=e.panelSolar.distanciaEntreTubosSecundarios;else if("tapaSecundaria1"===this.alias)Pe(t.modelViewMatrix,ft.tuboSecundarioTransform,[0,e.panelSolar.tuboSecundario.altura,0]);else if("tapaSecundaria2"===this.alias){const e=t.modelViewMatrix;Pe(e,ft.tuboSecundarioTransform,[0,0,0]),Ve(e,e,Math.PI)}else if("panelSolar1"===this.alias)ft.panelTransform=t.modelViewMatrix,Pe(ft.panelTransform,ft.tuboSecundarioTransform,[0,-e.panelSolar.tapa.largo/2,0]),Ve(ft.panelTransform,ft.panelTransform,-Math.PI/2),Oe(ft.panelTransform,ft.panelTransform,2*Math.PI*this.panelSolar.anguloRotacion/360);else if("panelSolar2"===this.alias)ft.panelTransform=t.modelViewMatrix,Pe(ft.panelTransform,ft.tuboSecundarioTransform,[0,e.panelSolar.tuboSecundario.altura+e.panelSolar.tapa.largo/2,0]),Ve(ft.panelTransform,ft.panelTransform,-Math.PI/2),Oe(ft.panelTransform,ft.panelTransform,2*Math.PI*this.panelSolar.anguloRotacion/360);else if("panelTapaSuperior"===this.alias)Pe(t.modelViewMatrix,ft.panelTransform,[0,e.panelSolar.lado.ancho,0]);else if("panelTapaInferior"===this.alias)Ie(t.modelViewMatrix,ft.panelTransform,Math.PI,[1,0,0]);else if("panelLadoA"===this.alias){const o=t.modelViewMatrix;Pe(o,ft.panelTransform,[0,e.panelSolar.lado.ancho/2,e.panelSolar.tapa.largo/2]),Ie(o,o,Math.PI/2,[0,0,1]),Ie(o,o,Math.PI,[0,1,1])}else if("panelLadoA1"===this.alias){const o=t.modelViewMatrix;Pe(o,ft.panelTransform,[0,e.panelSolar.lado.ancho/2,-e.panelSolar.tapa.largo/2]),Ie(o,o,Math.PI/2,[1,0,0]),Ie(o,o,-Math.PI,[1,0,1])}else if("panelLadoB"===this.alias){const o=t.modelViewMatrix;Pe(o,ft.panelTransform,[e.panelSolar.lado.largo/2,e.panelSolar.lado.ancho/2,0]),Ie(o,o,Math.PI,[1,1,0])}else if("panelLadoB1"===this.alias){const o=t.modelViewMatrix;Pe(o,ft.panelTransform,[-e.panelSolar.lado.largo/2,e.panelSolar.lado.ancho/2,0]),Ie(o,o,-Math.PI,[0,0,1]),Ie(o,o,-Math.PI,[1,1,0])}}nucleoDelAnillo(){const{transforms:e}=this;"nucleoAnillo"===this.alias&&(dt.nucleoAnilloTransform=e.modelViewMatrix,Pe(dt.nucleoAnilloTransform,pt.naveTransform,[0,0,-ut.distanciaNucleoDelAnilloYNave]),Ie(dt.nucleoAnilloTransform,dt.nucleoAnilloTransform,Math.PI/2,[1,0,0]))}animarAnillo(e){this.posicionAnillo+=e}anillo(){const{transforms:t,posicionAnillo:o,animacion:a}=this;if("pastillaCuerpo"===this.alias){ct.pastillaTransform=t.modelViewMatrix;const e=o/this.paramAnillo.factorDeVelocidad;Ie(ct.pastillaTransform,dt.nucleoAnilloTransform,e,[0,1,0]),Pe(ct.pastillaTransform,ct.pastillaTransform,[0,this.paramAnillo.pastillaEnElMedio,0]),this.panelSolar.animar&&a.empezarEn(e,this.panelSolar)}else if("pastillaCilindroSup"===this.alias){const o=t.modelViewMatrix;Ie(o,ct.pastillaTransform,Math.PI/2,[0,1,0]),Pe(o,o,[0,e.pastillas.cuerpo.altura,0])}else if("pastillaCilindroInf"===this.alias){const e=t.modelViewMatrix;Ie(e,ct.pastillaTransform,-Math.PI,[1,0,0]),Ie(e,e,Math.PI/2,[0,1,0])}else if("pastillaTapaSup"===this.alias){const e=t.modelViewMatrix;Ie(e,ct.pastillaTransform,0,[1,0,0]),Pe(e,e,[0,ct.alturaTapaSuperior,0])}else if("pastillaTapaInf"===this.alias){const e=t.modelViewMatrix;Ie(e,ct.pastillaTransform,-Math.PI,[1,0,0]),Pe(e,e,[0,ct.alturaTapaInferior,0])}else if("torus"===this.alias)ct.torusTransform=t.modelViewMatrix,Pe(ct.torusTransform,ct.pastillaTransform,[0,e.pastillas.cuerpo.altura/2,0]),Ie(ct.torusTransform,ct.torusTransform,Math.PI/2,[1,0,0]);else if("anillo_tuboH1"===this.alias)Pe(t.modelViewMatrix,ct.torusTransform,[-e.anillo.distanciaEntreTubos,-e.anillo.tubo.altura/2,0]);else if("anillo_tuboH2"===this.alias)Pe(t.modelViewMatrix,ct.torusTransform,[e.anillo.distanciaEntreTubos,-e.anillo.tubo.altura/2,0]);else if("anillo_tuboV1"===this.alias){const o=t.modelViewMatrix;Pe(o,ct.torusTransform,[e.anillo.tubo.altura/2,e.anillo.distanciaEntreTubos,0]),Ie(o,o,Math.PI/2,[0,0,1])}else if("anillo_tuboV2"===this.alias){const o=t.modelViewMatrix;Pe(o,ct.torusTransform,[e.anillo.tubo.altura/2,-e.anillo.distanciaEntreTubos,0]),Ie(o,o,Math.PI/2,[0,0,1])}else if("anillo_tuboInterior"===this.alias){const o=t.modelViewMatrix;ct.desplazamientoTuboInterior<e.anillo.tubo.altura?Pe(o,ct.torusTransform,[0,ct.distanciaTubosInteriores-ct.desplazamientoTuboInterior,0]):Pe(o,ct.torusTransform,[ct.factorDesplazamientoEntreTubosInteriores*ct.distanciaTubosInteriores-ct.desplazamientoTuboInterior,0,0]),Ie(o,o,ct.sentidoTuboInterior*Math.PI/4,[0,0,1]),Pe(o,o,[0,-e.anillo.tuboInterior.altura/2,0]),ct.sentidoTuboInterior*=-1,ct.desplazamientoTuboInterior+=2*e.anillo.distanciaEntreTubos}}luna(){const{transforms:e}=this;if("luna"===this.alias){const t=e.modelViewMatrix;Pe(t,t,[0,0,0])}}translate(e,t,o){Pe(e,e,[t,0,-o])}rotate(e,t){Ie(e,e,t*Math.PI/180,[0,1,0])}scale(e,t,o){Re(e,e,[t,0,o])}test(){const{transforms:e}=this;if("test"===this.alias){const t=e.modelViewMatrix;this.translate(t,-4,-6),this.translate(t,4,0),this.scale(t,2,2),this.rotate(t,45),this.translate(t,2,0),this.translate(t,2,-.5)}}cubo(){const{transforms:e}=this;if("cubo"===this.alias)_t.transform=e.modelViewMatrix;else if("cubo_lado1"===this.alias){const t=e.modelViewMatrix;Pe(t,_t.transform,[0,0,_t.lado/2]),Ie(t,t,Math.PI/2,[1,0,0])}else if("cubo_lado2"===this.alias){const t=e.modelViewMatrix;Pe(t,_t.transform,[0,0,-_t.lado/2]),Ie(t,t,Math.PI/2,[-1,0,0])}else if("cubo_lado3"===this.alias){const t=e.modelViewMatrix;Ie(t,_t.transform,Math.PI/2,[0,1,0]),Pe(t,t,[0,0,-_t.lado/2]),Ie(t,t,Math.PI/2,[-1,0,0])}else if("cubo_lado4"===this.alias){const t=e.modelViewMatrix;Ie(t,_t.transform,-Math.PI/2,[0,1,0]),Pe(t,t,[0,0,-_t.lado/2]),Ie(t,t,Math.PI/2,[-1,0,0])}else if("cubo_lado5"===this.alias)Pe(e.modelViewMatrix,_t.transform,[0,_t.lado/2,0]);else if("cubo_lado6"===this.alias){const t=e.modelViewMatrix;Pe(t,_t.transform,[0,-_t.lado/2,0]),Ie(t,t,Math.PI,[1,0,0])}}teatro(){const{transforms:e}=this;if("teatro"===this.alias)gt.transform=e.modelViewMatrix;else if("teatro_lado1"===this.alias)e.modelViewMatrix;else if("teatro_lado2"===this.alias){const t=e.modelViewMatrix;Pe(t,gt.transform,[0,2,-2]),Ie(t,t,Math.PI/2,[1,0,0])}else if("teatro_lado3"===this.alias){const t=e.modelViewMatrix;Ie(t,gt.transform,Math.PI/2,[0,1,0]),Pe(t,t,[0,2,-2]),Ie(t,t,Math.PI/2,[1,0,0])}}complexCube(){const{transforms:e}=this;if("complexCube"===this.alias){const t=e.modelViewMatrix;Re(t,t,[5,5,5])}}}let vt,xt,Tt,wt,Et,yt,At,Ct,St,Mt,Pt,Rt,It,Vt,kt,Ot,Bt,Lt,Nt=!0,Dt=!0,Ft=!1,zt=[20,20,20];const Ut=Ue.RojoMetalico;function jt(e,t,o,a){const n=new Image;n.src=a,n.onload=()=>{e.bindTexture(e.TEXTURE_CUBE_MAP,o),e.texImage2D(t,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_CUBE_MAP,null)}}function Ht(e,t,o=!1){const a=t.vertices,n=t.normales,i=t.tangentes,r=[],s=[],l=[];let u=0,c=3;for(a.length!==n.length&&console.log("Vertices y normales distinta longitud");c<=a.length;){const t=de(...a.slice(u,c)),d=de(...n.slice(u,c)),h=de(...i.slice(u,c));ge(d,d,e),ge(t,t,e),ge(h,h,e),o?r.unshift(...t):r.push(...t),me(d,d),o?s.unshift(...d):s.push(...d),me(h,h),o?l.unshift(...h):l.push(...h),u+=3,c+=3}return r.length!==s.length&&console.log("Vertices y normales nuevas distinta longitud"),a.length!==r.length&&console.log("Vertices transformados no coinciden en longitud"),n.length!==s.length&&console.log("Normales transformadas no coinciden en longitud"),{vertices:r,normales:s,tangentes:l}}function Gt(){vt.viewport(0,0,vt.canvas.width,vt.canvas.height),vt.clear(vt.COLOR_BUFFER_BIT|vt.DEPTH_BUFFER_BIT),Et.updatePerspective();try{vt.uniform1i(Tt.uUpdateLight,Nt),xt.traverse((e=>{if(!e.hidden){if(Et.calculateModelView(),Et.push(),"cubeMap"===e.alias){const e=Et.modelViewMatrix,t=2048,{rotationMatrix:o,position:a}=Mt.update();Pe(e,ht.capsulaTransform,a),Me(e,e,o),Re(e,e,[t,t,t])}if("light"===e.alias){const e=Et.modelViewMatrix;Pe(e,e,Tt.getUniform(Tt.uLightPosition)),Re(e,e,[.5,.5,.5])}"floor"!==e.alias&&"axis"!==e.alias&&(e.wireframe=Ft),yt.setAlias(e.alias),"nave"===e.alias&&(pt.naveTransform=Et.modelViewMatrix,Pt=[0,0,0],Rt=[0,0,15.5],St.setFocus(Pt,Rt),!0===St.focusCamera.Nave?wt.setFocus(Pt):!0===St.focusCamera.PanelesSolares&&wt.setFocus(Rt)),yt.complexCube(),yt.teatro(),yt.cubo(),yt.luna(),yt.nucleoDelPanelSolar(),yt.panelesSolares(),yt.nucleoDelAnillo(),yt.anillo(),yt.bloques(),yt.modulosVioleta(),yt.esfera(),yt.capsula(),Et.setMatrixUniforms(),Et.pop(),function(e){if(vt.uniform4fv(Tt.uMaterialDiffuse,e.diffuse),vt.uniform4fv(Tt.uMaterialSpecular,e.specular),vt.uniform4fv(Tt.uMaterialAmbient,e.ambient),vt.uniform1i(Tt.uWireframe,e.wireframe),vt.bindVertexArray(e.vao),vt.bindBuffer(vt.ELEMENT_ARRAY_BUFFER,e.ibo),"cubeMap"===e.alias?(vt.uniform1i(Tt.uHasTexture,!1),vt.uniform1i(Tt.uIsTheCubeMapShader,!0),vt.activeTexture(vt.TEXTURE0),vt.bindTexture(vt.TEXTURE_CUBE_MAP,Bt),vt.uniform1i(Tt.uCubeSampler,0)):e.hasTexture?(vt.uniform1i(Tt.uIsTheCubeMapShader,!1),vt.uniform1i(Tt.uHasTexture,!0),vt.activeTexture(vt.TEXTURE1),vt.bindTexture(vt.TEXTURE_2D,kt.glTexture),vt.uniform1i(Tt.uSampler,1),vt.activeTexture(vt.TEXTURE2),vt.bindTexture(vt.TEXTURE_2D,Ot.glTexture),vt.uniform1i(Tt.uNormalSampler,2)):(vt.uniform1i(Tt.uIsTheCubeMapShader,!1),vt.uniform1i(Tt.uHasTexture,!1)),e.wireframe)"floor"===e.alias||"axis"===e.alias?vt.drawElements(vt.LINES,e.indices.length,vt.UNSIGNED_SHORT,0):(vt.uniform4fv(Tt.uMaterialDiffuse,Ue.RojoMetalico),vt.drawElements(vt.LINE_STRIP,e.indices.length,vt.UNSIGNED_SHORT,0));else{const t=Dt?vt.TRIANGLE_STRIP:vt.TRIANGLES;"cubeMap"===e.alias?vt.drawElements(vt.TRIANGLES,e.indices.length,vt.UNSIGNED_SHORT,0):vt.drawElements(t,e.indices.length,vt.UNSIGNED_SHORT,0)}vt.bindVertexArray(null),vt.bindBuffer(vt.ARRAY_BUFFER,null),vt.bindBuffer(vt.ELEMENT_ARRAY_BUFFER,null)}(e)}})),ut.posicionBloque=0,ft.distanciaRelativaConElTuboPrincipal=3.5,ct.sentidoTuboInterior=1,ct.desplazamientoTuboInterior=0}catch(e){console.error(e)}}function Xt(){if(It=(new Date).getTime()-Vt,It<30)return;let e=Math.floor(It/30);for(;e>0;)yt.animarAnillo(.01),Gt(),e-=1;Vt=(new Date).getTime()}Lt=30,window.onload=function(){!function(){const t=be.getCanvas("webgl-canvas");be.autoResizeCanvas(t),vt=be.getGLContext(t),vt.clearColor(.9,.9,.9,1),vt.clearDepth(100),vt.enable(vt.DEPTH_TEST),vt.depthFunc(vt.LEQUAL),Tt=new ve(vt,"vertex-shader","fragment-shader"),Tt.load(["aVertexPosition","aVertexNormal","aVertexTangent","aVertexColor","aVertexTextureCoords"],["uProjectionMatrix","uModelViewMatrix","uNormalMatrix","uMaterialDiffuse","uMaterialAmbient","uMaterialSpecular","uLightAmbient","uLightDiffuse","uLightSpecular","uLightPosition","uShininess","uUpdateLight","uWireframe","uAjuste","uHasTexture","uIsTheCubeMapShader","uSampler","uNormalSampler","uCubeSampler"]),xt=new Te(vt,Tt),wt=new De(De.ORBITING_TYPE,70,0),wt.goTo([0,0,50],0,-60,[0,0,0]),Mt=new lt([0,0,-10],wt),St=new Fe(wt,t,Mt),Et=new ze(vt,Tt,wt,t),vt.uniform3fv(Tt.uLightPosition,zt),vt.uniform4fv(Tt.uLightAmbient,[.2,.2,.2,1]),vt.uniform4fv(Tt.uLightDiffuse,[1,1,1,1]),vt.uniform4fv(Tt.uLightSpecular,[1,1,1,1]),vt.uniform1f(Tt.uShininess,230),At=new st(e.anillo.radio,xt),yt=new bt(Et,Mt,St,wt,At,new $e(300,30));const o=["Left_1K_TEX.png","Right_1K_TEX.png","Up_1K_TEX.png","Down_1K_TEX.png","Front_1K_TEX.png","Back_1K_TEX.png"],a=[[],[],[]];for(let e=0;e<3;e++)for(let t=0;t<6;t++)a[e].push("/skyBox/"+(e+1).toString()+`/${o[t]}`);Bt=vt.createTexture(),vt.bindTexture(vt.TEXTURE_CUBE_MAP,Bt),vt.texParameteri(vt.TEXTURE_CUBE_MAP,vt.TEXTURE_MAG_FILTER,vt.LINEAR),vt.texParameteri(vt.TEXTURE_CUBE_MAP,vt.TEXTURE_MIN_FILTER,vt.LINEAR);let n=Math.floor(3*Math.random());jt(vt,vt.TEXTURE_CUBE_MAP_POSITIVE_X,Bt,a[n][0]),jt(vt,vt.TEXTURE_CUBE_MAP_NEGATIVE_X,Bt,a[n][1]),jt(vt,vt.TEXTURE_CUBE_MAP_POSITIVE_Y,Bt,a[n][2]),jt(vt,vt.TEXTURE_CUBE_MAP_NEGATIVE_Y,Bt,a[n][3]),jt(vt,vt.TEXTURE_CUBE_MAP_POSITIVE_Z,Bt,a[n][4]),jt(vt,vt.TEXTURE_CUBE_MAP_NEGATIVE_Z,Bt,a[n][5]),kt=new xe(vt,"UV.jpg"),Ot=new xe(vt,"UV_normal.jpg")}(),function(){xt.load("/geometries/cube-texture.json","cubeMap"),xt.load("/sphere.json","light");const t=new He(null,"nave");xt.add(t),function(){const t={filas:1,columnas:30},o=new He(null,"nucleoPS"),a=new Xe("nucleoPS_tubo",e.NucleoPS,t),n=new Ge("nucleoPS_cilindroSup",e.CilindroNucleoPS,t),i=new Ge("nucleoPS_cilindroInf",e.CilindroNucleoPS,t),r=new Ye("nucleoPS_tapaSup",e.CilindroNucleoPS.radioSuperior,t),s=new Ye("nucleoPS_tapaInf",e.CilindroNucleoPS.radioSuperior,t),l=e.CilindroNucleoPS.radioSuperior,u=e.CilindroNucleoPS.radioInferior-e.CilindroNucleoPS.radioSuperior,c=e.CilindroNucleoPS.altura,d=Math.sqrt(u*u+c*c),h=e.NucleoPS.altura,p=l+d+h+d+l,f=[];f.push(0,l/p,l/p,(l+d)/p,(l+d)/p,(l+d+h)/p,(l+d+h)/p,(l+d+h+d)/p,(l+d+h+d)/p,(l+d+h+d+l)/p);const m=[];for(let e=0;e<=t.columnas;e++)m.unshift(e/t.columnas);const _=[];for(let e=0;e<f.length;e++)for(let t=0;t<m.length;t++)4===e||5===e?_.push(1-m[t],f[e]):_.push(m[t],f[e]);const g=Ae(we());Ie(g,g,Math.PI/2,[0,1,0]),Pe(g,g,[0,e.NucleoPS.altura,0]);const b=Ae(we());Ie(b,b,Math.PI/2,[0,1,0]);const v=Ae(we());Pe(v,v,[0,e.NucleoPS.altura+e.CilindroNucleoPS.altura,0]);const x=Ae(we());Ie(x,x,-Math.PI/2,[0,1,0]),Ie(x,x,-Math.PI,[1,0,0]);const T=Ae(we());Ie(T,T,Math.PI,[1,0,0]),Pe(T,T,[0,e.CilindroNucleoPS.altura,0]);const w=Ae(we());Ie(w,w,Math.PI,[1,0,0]);const E=Ht(Ae(we()),a,!0),y=Ht(g,n,!0),A=Ht(b,n,!0);y.normales=A.normales,y.tangentes=A.tangentes;const C=Ht(v,r),S=Ht(x,i),M=Ht(T,s,!0),P=Ht(w,s,!0);M.normales=P.normales,M.tangentes=P.tangentes;const R=[];r.indices.forEach((e=>{R.push(e)}));const I=[];n.indices.forEach((e=>{I.push(e+R.length)}));const V=[];a.indices.forEach((e=>{V.push(e+I.length+R.length)}));const k=[];i.indices.forEach((e=>{k.push(e+V.length+I.length+R.length)}));const O=[];s.indices.forEach((e=>{O.push(e+k.length+V.length+I.length+R.length)})),o.indices.push(...R,61,62,...I,123,124,...V,185,186,...k,247,248,...O),o.vertices.push(...C.vertices,...y.vertices,...E.vertices,...S.vertices,...M.vertices),o.normales.push(...r.normales,...y.normales,...E.normales,...S.normales,...M.normales),o.tangentes.push(...r.tangentes,...y.tangentes,...E.tangentes,...S.tangentes,...M.tangentes),o.textureCoords.push(..._),function(e){const t=e.vertices,o=e.textureCoords,a=e.indices,n=[];for(let e=0;e<t.length/3;e++)n[e]=[0,0,0];let i=[0,0,0],r=[0,0,0],s=[0,0,0];for(let e=0;e<a.length-2;e++){const l=a[e],u=a[e+1],c=a[e+2];if(l===u||l===c||u===c)continue;const d=[t[3*l],t[3*l+1],t[3*l+2]],h=[t[3*u],t[3*u+1],t[3*u+2]],p=[t[3*c],t[3*c+1],t[3*c+2]],f=[o[2*l],o[2*l+1]],m=[o[2*u],o[2*u+1]],_=[o[2*c],o[2*c+1]];fe(i,h,d),fe(r,p,d);const g=m[1]-f[1],b=_[0]-f[1];s=[b*i[0]-g*r[0],b*i[1]-g*r[1],b*i[2]-g*r[2]],pe(n[l],n[l],s),pe(n[u],n[u],s),pe(n[c],n[c],s)}const l=[];n.forEach((e=>{me(e,e),l.push(e[0]),l.push(e[1]),l.push(e[2])}))}(o),o.diffuse=[.9,.9,.9,1],o.hasTexture=!0;const B=Object.assign({},o);B.alias="nucleoAnillo",xt.add(o),xt.add(B)}(),Ct=new et(xt),Ct.cargarPanelesSolares(),Ct.cargarPanelesSolares1(),function(){const t=2*Math.PI,o={filas:1,columnas:8},a={radioSuperior:2.3,radioInferior:e.pastillas.cuerpo.radio,altura:.1},n={filas:1,columnas:30};xt.add(new Xe("pastillaCuerpo",e.pastillas.cuerpo,n),{diffuse:Ue.Pastilla}),xt.add(new Ge("pastillaCilindroSup",a,n),{diffuse:Ue.Pastilla}),xt.add(new Ge("pastillaCilindroInf",a,n),{diffuse:Ue.Pastilla}),xt.add(new Ye("pastillaTapaSup",a.radioSuperior,n),{diffuse:Ue.Pastilla}),xt.add(new Ye("pastillaTapaInf",a.radioSuperior,n),{diffuse:Ue.Pastilla}),xt.add(new Ke("torus",e.anillo.radio,e.anillo.radioInterior,{filas:20,columnas:80},t)),xt.add(new Xe("anillo_tuboH1",e.anillo.tubo,o)),xt.add(new Xe("anillo_tuboH2",e.anillo.tubo,o)),xt.add(new Xe("anillo_tuboV1",e.anillo.tubo,o)),xt.add(new Xe("anillo_tuboV2",e.anillo.tubo,o));const i=2*Math.ceil(e.anillo.tubo.altura/(2*e.anillo.distanciaEntreTubos));for(let t=0;t<i;t++)xt.add(new Xe("anillo_tuboInterior",e.anillo.tuboInterior,o))}(),At.setType(st.BLOQUES_4),function(){const t=new ot([0,0],[.666,0],[1.333,0],[e.profundidadModuloVioleta,0]),o=new at;o.iniciarEn(1,.5).CurvaBezierA(1,.8,.8,1,.5,1).lineaA(-.5,1).CurvaBezierA(-.8,1,-1,.8,-1,.5).lineaA(-1,-.5).CurvaBezierA(-1,-.8,-.8,-1,-.5,-1).lineaA(.5,-1).CurvaBezierA(.8,-1,1,-.8,1,-.5).lineaA(1,.5).curvaCerrada(!0);const a=be.crearRecorrido(1,t),n=be.crearForma(8,o),i={filas:1,columnas:n.puntos.length-1};xt.add(new it("moduloVioletaPS",n,a,i),{diffuse:Ue.Violeta}),xt.add(new it("moduloVioletaAnillo",n,a,i),{diffuse:Ue.Violeta})}(),function(){const e=mt.radio,t=be.crearRecorridoCircular(e,2/8,20),o=mt.angulo,a={puntos:t.puntos.map((e=>[e[0]*Math.cos(o)-e[1]*Math.sin(o),e[0]*Math.sin(o)+e[1]*Math.cos(o)])),normales:t.binormales.map((e=>[e[0]*Math.cos(o)-e[1]*Math.sin(o),e[0]*Math.sin(o)+e[1]*Math.cos(o)]))},n={filas:30,columnas:a.puntos.length-1},i=be.crearRecorridoCircular(0,1,n.filas),r=new it("esfera",a,i,n,!0);xt.add(r),xt.add(new Ye("esferaTapaAtras",e*Math.sin(o),{filas:1,columnas:30}),{diffuse:Ut}),xt.add(new Ye("esferaTapaAdelante",e*Math.sin(o),{filas:1,columnas:30}),{diffuse:Ut})}(),function(){const e=[[247,144/255,0,1],[247,90/255,0,1],[247,19/255,0,1]],t={filas:1,columnas:30},o=new He(null,"capsula");xt.add(o),ht.curvaColav0x=-1.99;const a=new ot([ht.curvaColav0x,.78],[-1.2,.785],[-.66,.52],[-.14,.18]).extraerPuntos(10),n={puntos:a.puntos,normales:a.puntosTangentes.map((e=>[-e[1],e[0]]))},i={filas:30,columnas:n.puntos.length-1},r=be.crearRecorridoCircular(0,1,i.filas),s=new it("capsulaCola",n,r,i,!0);xt.add(s,{diffuse:e[1]});const l=new Ge("capsulaFuegoCola",{radioSuperior:.78,radioInferior:.05,altura:.5},t,!0);xt.add(l,{diffuse:e[2]});const u=new ot([.3,1.5],[1.185,1.44],[1.844,1.185],[2.5,.7]).extraerPuntos(10),c={puntos:u.puntos,normales:u.puntosTangentes.map((e=>[-e[1],e[0]]))},d=c.puntos.length-1,h=new it("capsulaCuerpoBezierA",c,r,{filas:30,columnas:d},!0);xt.add(h),ht.CilAaltura=.1;const p=new Ge("capsulaCuerpoCilindroA",{radioSuperior:.4,radioInferior:1.2,altura:ht.CilAaltura},t);xt.add(p);const f=new Ge("capsulaCuerpoCilindroB",{radioSuperior:1.2,radioInferior:1.5,altura:.2},t);xt.add(f);const m=new Ge("capsulaCuerpoCilindroC",{radioSuperior:.7,radioInferior:.6,altura:.01},t);xt.add(m);const _=new Ge("capsulaCuerpoCilindroD",{radioSuperior:.6,radioInferior:.4,altura:2.9-2.51},t);xt.add(_,{diffuse:Ut});const g=new Ge("capsulaCuerpoCilindroE",{radioSuperior:.4,radioInferior:0,altura:.001},t);xt.add(g),ht.FuegoCuerpoAltura=.5;const b=new Ge("capsulaFuegoCuerpo",{radioSuperior:1.2,radioInferior:.05,altura:ht.FuegoCuerpoAltura},t,!0);xt.add(b,{diffuse:e[0]})}()}(),Vt=(new Date).getTime(),setInterval(Xt,.03),be.configureControls({PanelesSolares:{Filas:{value:Ct.cantidadDeFilas,min:1,max:10,step:1,onChange:e=>{Ct.removerPanelesSolares(),Ct.cantidadDeFilas=e,Ct.cambiarAlturaDelTuboPrincipal(),Ct.cargarPanelesSolares()}},Angulo:{value:yt.panelSolar.anguloRotacion,min:0,max:360,step:1,onChange:e=>yt.panelSolar.anguloRotacion=e},AnimarPaneles:{value:yt.panelSolar.animar,onChange:e=>yt.panelSolar.animar=e}},...["Translate X","Translate Y","Translate Z"].reduce(((e,t,o)=>(e[t]={value:zt[o],min:-20,max:20,step:.1,onChange(e,t){vt.uniform3fv(Tt.uLightPosition,[t["Translate X"],t["Translate Y"],t["Translate Z"]])}},e)),{}),Bloques:{value:At.type,options:[st.BLOQUES_4,st.BLOQUES_5,st.BLOQUES_6,st.BLOQUES_7,st.BLOQUES_8],onChange:e=>{At.setType(e)}},"Static Light Position":{value:Nt,onChange:e=>Nt=e},Ajuste:{value:8,min:-2,max:2,step:.1,onChange:e=>vt.uniform1f(Tt.uAjuste,e)},Wireframe:()=>{Ft=!Ft},"Triangle Strip":{value:Dt,onChange:e=>Dt=e}},{closed:!1})}})();
//# sourceMappingURL=bundle.d684a91ecd22ffde72c2.js.map